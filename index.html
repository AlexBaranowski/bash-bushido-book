<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Alex Baranowski" />
  <title>Bash Bushido</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Bash Bushido</h1>
<p class="author">Alex Baranowski</p>
<p class="date">20-01-2018</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#bash-bushido---become-the-command-line-master.">Bash Bushido - become the command line master.</a>
<ul>
<li><a href="#trademarks">Trademarks</a></li>
<li><a href="#about-the-author.">About the Author.</a></li>
<li><a href="#erratum">Erratum</a></li>
<li><a href="#preface">Preface</a></li>
<li><a href="#our-bushido.">Our Bushido.</a></li>
<li><a href="#installation-problems">Installation problems</a></li>
</ul></li>
<li><a href="#let-keyboard-become-your-very-best-friend.">Let Keyboard Become Your Very Best Friend.</a></li>
<li><a href="#essential-bash-shortcuts">Essential Bash Shortcuts</a>
<ul>
<li><a href="#gnu-readline">GNU Readline</a></li>
<li><a href="#previous-and-next-command.-and-.">Previous and next command. ↑ and ↓.</a></li>
<li><a href="#character-forward-and-backwards.-and-arrows.">Character forward and backwards. → and ← arrows.</a></li>
<li><a href="#home-and-end-keys"><code>home</code> and <code>end</code> keys</a></li>
<li><a href="#delete-and-backspace"><code>Delete</code> and <code>backspace</code></a></li>
<li><a href="#different-ways-to-enter">Different ways to <code>Enter</code>!</a></li>
<li><a href="#one-word-forward-and-backward.">One word forward and backward.</a></li>
<li><a href="#remove-from-the-cursor-position-to-the-end-of-the-word.">Remove from the cursor position to the end of the word.</a></li>
<li><a href="#remove-from-the-cursor-to-the-start-end-of-command-line">Remove from the cursor to the {start, end} of command line</a></li>
<li><a href="#how-to-practise-it">How to practise it?</a></li>
</ul></li>
<li><a href="#extra-cool-keyboard-shortcuts-in-bash">Extra cool keyboard shortcuts in Bash:</a>
<ul>
<li><a href="#clear-the-screen">Clear the screen</a></li>
<li><a href="#history-search">History search</a></li>
<li><a href="#get-current-bash-version">Get current Bash version</a></li>
<li><a href="#undo-in-bash">UNDO in Bash</a></li>
<li><a href="#invoke-your-favourite-editor.">Invoke your favourite $EDITOR.</a></li>
<li><a href="#shell-expand-line">shell-expand-line</a></li>
<li><a href="#glob-expansion">glob-expansion</a></li>
<li><a href="#is-that-all">Is that all?</a></li>
</ul></li>
<li><a href="#vim-me-like-you-do-vim-me-like-you-do">VIM me like you do VIM me like you do</a>
<ul>
<li><a href="#what-about-the-bash-readlines-vim-mode">What about the Bash readline’s vi(m) mode?</a></li>
<li><a href="#best-30-minute-investment---vimtutor.">Best 30 minute investment - vimtutor.</a></li>
<li><a href="#i-dont-need-vim---i-have-my-powerful-ide.">I don’t need vim - I have my powerful IDE.</a></li>
<li><a href="#edit-file-over-ssh-http-ftp-and-more-with-vim.">Edit file over ssh, HTTP, FTP and more with Vim.</a></li>
<li><a href="#further-reading-about-vim">Further reading about vim</a></li>
</ul></li>
<li><a href="#calendars">Calendars</a>
<ul>
<li><a href="#basic-calendar">Basic calendar</a></li>
<li><a href="#manage-google-calendar-from-the-command-line">Manage Google Calendar from the command line</a></li>
<li><a href="#other-projects">Other projects</a></li>
</ul></li>
<li><a href="#configure-bash">Configure BASH</a>
<ul>
<li><a href="#change-your-prompt">Change Your prompt</a></li>
<li><a href="#executing-the-chosen-commands-before-the-prompt.">Executing the chosen commands before the prompt.</a></li>
<li><a href="#are-clear-and-ctrl-l-the-same">Are Clear and <code>ctrl</code> + <code>l</code> the same?</a></li>
<li><a href="#making-your-own-command-line-shortcut">Making your own command line shortcut</a></li>
<li><a href="#make-our-key-bindings-persistent.">Make our key bindings persistent.</a></li>
<li><a href="#meta-esc-a-useless-but-interesting-thing.">Meta == ESC a useless but interesting thing.</a></li>
<li><a href="#change-directory-to-the-previous-one.">Change directory to the previous one.</a></li>
<li><a href="#pushd-and-popd-friends-of-mine">Pushd and popd friends of mine</a></li>
<li><a href="#shopts-and-autocd">shopts and autocd</a></li>
<li><a href="#bashrc-generator">bashrc generator</a></li>
</ul></li>
<li><a href="#bash-history">Bash History</a>
<ul>
<li><a href="#where-does-the-history-go">Where does the History go?</a></li>
<li><a href="#getting-the-10-most-popular-commands.">Getting the 10 most popular commands.</a></li>
<li><a href="#lets-erase-our-history">Let’s erase our history!</a></li>
<li><a href="#saving-and-sharing-history-in-real-time">Saving and sharing history in real time?</a></li>
<li><a href="#history-with-date-and-time.">History with date and time.</a></li>
<li><a href="#controlling-what-the-history-should-forget">Controlling what the history should forget</a></li>
<li><a href="#how-deep-is-your-love-history">How deep is your <del>love</del> history?</a></li>
<li><a href="#ignoring-particular-commands.">Ignoring particular commands.</a></li>
</ul></li>
<li><a href="#event-designator-word-designator-modifiers.">Event designator, word designator, modifiers.</a>
<ul>
<li><a href="#what-does-mean-in-bash">What does <code>!</code> mean in Bash?</a></li>
<li><a href="#sudo-friends-4-eveer1">sudo + !! = fRiends 4 EVEER!!!1</a></li>
<li><a href="#invoking-a-command-by-number-in-the-history.">Invoking a command by number in the history.</a></li>
<li><a href="#invoking-a-command-starting-with-a-string.">Invoking a command starting with a string.</a></li>
<li><a href="#invoking-a-command-containing-the-chosen-string.">Invoking a command containing the chosen string.</a></li>
<li><a href="#word-designator">Word Designator</a></li>
<li><a href="#modifiers---additional-operations-on-word-designators">Modifiers - additional operations on word designator/s</a></li>
<li><a href="#fast-substitution-in-the-previous-command.">Fast substitution in the previous command.</a></li>
<li><a href="#histchars-lets-control-the-history-characters-.">histchars – let’s control the history characters :).</a></li>
<li><a href="#disable-event-designator.">Disable ! (event designator).</a></li>
<li><a href="#so-what-is-really-useful">So, what is really useful?</a></li>
</ul></li>
<li><a href="#aliases">Aliases</a>
<ul>
<li><a href="#bash-aliases">Bash aliases</a></li>
<li><a href="#my-favourite-git-aliases">My favourite Git aliases</a></li>
<li><a href="#dotfiles">dotfiles</a></li>
<li><a href="#check-what-command-is---type.">Check what command is - type.</a></li>
<li><a href="#check-if-the-command-is-aliased.">Check if the command is aliased.</a></li>
<li><a href="#invoke-not-aliased-version-of-a-command">Invoke NOT aliased version of a command</a></li>
</ul></li>
<li><a href="#top-and-htop">Top and HTOP</a>
<ul>
<li><a href="#top---top-tier-serious-process-monitor.">top - top tier serious process monitor.</a></li>
<li><a href="#top-output-step-by-step">Top output step by step</a></li>
<li><a href="#customizing-the-top">Customizing the TOP</a></li>
<li><a href="#practical-top-usage.">Practical Top usage.</a></li>
<li><a href="#htop---top-on-steroids.">htop - top on steroids.</a></li>
<li><a href="#summary">Summary</a></li>
</ul></li>
<li><a href="#print-to-console-like-a-hacker-or-a-script-kiddie.">Print to console like a hacker (or a script kiddie).</a>
<ul>
<li><a href="#banner">banner</a></li>
<li><a href="#figlet">FIGlet</a></li>
<li><a href="#cowsay">cowsay</a></li>
<li><a href="#lolcat">lolcat</a></li>
<li><a href="#nms">nms</a></li>
<li><a href="#fortune-teller">Fortune teller</a></li>
</ul></li>
<li><a href="#network">Network</a>
<ul>
<li><a href="#sshfs---ssh-file-system">SSHFS - SSH File System</a></li>
<li><a href="#ssh-with-the-x-server">SSH with the X server</a></li>
<li><a href="#port-forwarding-with-ssh">Port forwarding with ssh</a></li>
<li><a href="#add-ssh-host-key-to-.sshknown_host-if-they-dont-exist">Add SSH host key to .ssh/known_host if they don’t exist</a></li>
<li><a href="#instant-directory-content-sharing-with-python.">Instant directory content sharing with Python.</a></li>
<li><a href="#scan-ports-with-nmap">Scan ports with Nmap</a></li>
<li><a href="#monitor-traffic-with-traf-ng">Monitor traffic with traf-ng</a></li>
<li><a href="#network-load---nload">Network LOAD - nload</a></li>
<li><a href="#ss---another-utility-to-investigate-sockets">ss - another utility to investigate sockets</a></li>
<li><a href="#ncat-netcat">Ncat (Netcat)</a></li>
<li><a href="#telnet-check-if-port-works">Telnet check if port works</a></li>
<li><a href="#telnet-star-wars">telnet Star Wars</a></li>
</ul></li>
<li><a href="#miscellaneous-scripting-topics">Miscellaneous scripting topics</a>
<ul>
<li><a href="#repeat-until-success.">Repeat until success.</a></li>
<li><a href="#print-lines-based-on-the-lines-number.">Print lines based on the lines number.</a></li>
<li><a href="#tail-on-changes">Tail on changes</a></li>
<li><a href="#substitute-the-string-in-a-file.">Substitute the string in a file.</a></li>
<li><a href="#remove-selected-linelines-from-a-file.">Remove selected line/lines from a file.</a></li>
<li><a href="#change-the-file-with-sed-in-place">Change the file with sed in place</a></li>
<li><a href="#make-the-script-exit-on-the-first-error">Make the script exit on the first error</a></li>
<li><a href="#more-safety-features-in-bash-scripts">More safety features in bash scripts</a></li>
<li><a href="#echo-to-stderr">echo to stderr</a></li>
<li><a href="#debug-bash-script">Debug bash script!</a></li>
<li><a href="#shellcheck---write-better-bash-scripts">Shellcheck - write better bash scripts!</a></li>
<li><a href="#at-execute-command-at-a-given-time.">At execute command at a given time.</a></li>
<li><a href="#awk-print-selected-words.">AWK print selected words.</a></li>
<li><a href="#awk-getting-selected-line-range.">AWK getting selected line range.</a></li>
<li><a href="#getting-pid-of-the-current-bash-shell.">Getting PID of the current Bash shell.</a></li>
<li><a href="#dos2unix-unix2dos">dos2unix unix2dos</a></li>
<li><a href="#get-ascii-asap">Get ASCII ASAP</a></li>
<li><a href="#set-bash-auto-log-out">Set Bash auto log out</a></li>
<li><a href="#timeout-process">Timeout process</a></li>
<li><a href="#getting-my-current-ip">Getting my current IP</a></li>
<li><a href="#audible-ping">Audible ping</a></li>
<li><a href="#prettyping">PrettyPING</a></li>
<li><a href="#multitail">multitail</a></li>
<li><a href="#quis-custodiet-ipsos-custodes">Quis custodiet ipsos custodes?</a></li>
<li><a href="#print-process-tree">Print Process tree</a></li>
<li><a href="#imagemagick---convert-image">ImageMagick - convert image</a></li>
<li><a href="#merge-multiple-pdfs-into-one.">Merge multiple pdfs into one.</a></li>
<li><a href="#cp-bak-and-mv-.new">cp {,bak} and mv {,.new}</a></li>
<li><a href="#du-and-ncdu">du and ncdu</a></li>
<li><a href="#pv---pipe-viewer.">pv - Pipe Viewer.</a></li>
<li><a href="#what-is-happening-why-does-it-take-so-long-what-is-progress">What is happening? Why does it take so long? What is PROGRESS?</a></li>
<li><a href="#control-sound-system-from-cli">Control sound system from CLI</a></li>
<li><a href="#mailing-from-a-script">Mailing from a script</a></li>
<li><a href="#generate-random-passwords-with-openssl">Generate random passwords with OpenSSL</a></li>
<li><a href="#lsof">lsof</a></li>
<li><a href="#yes">YES!</a></li>
<li><a href="#tee---split-the-output.">Tee - split the output.</a></li>
<li><a href="#script-save-the-output-of-the-terminal-session."><code>Script</code> save the output of the terminal session.</a></li>
<li><a href="#cat-as-a-simple-text-editor">Cat as a simple text editor?</a></li>
<li><a href="#reset-your-terminal">Reset your terminal</a></li>
<li><a href="#resolve-symbolic-links">Resolve symbolic links</a></li>
<li><a href="#batch">batch</a></li>
<li><a href="#why-some-linuxunix-programs-have-strange-names">Why some Linux/UNIX programs have strange names?</a></li>
</ul></li>
<li><a href="#terminals-emulator">Terminals emulator</a>
<ul>
<li><a href="#short-history-of-dropdown-terminals">Short history of dropdown terminals</a></li>
<li><a href="#guake---gnome-drop-down-terminal">Guake - Gnome Drop Down Terminal</a></li>
<li><a href="#yakuake---kde-dropdown-terminal">Yakuake - KDE Dropdown Terminal</a></li>
<li><a href="#terminator-make-terminal-grid-again">TERMINATOR make terminal grid again!</a></li>
<li><a href="#terminal-detaching-with-screen">Terminal detaching with screen</a></li>
<li><a href="#cool-retro-term.">Cool-retro-term.</a></li>
</ul></li>
<li><a href="#this-is-the-end">This is the end</a>
<ul>
<li><a href="#errata">Errata</a></li>
</ul></li>
</ul>
</nav>
<h1 id="bash-bushido---become-the-command-line-master.">Bash Bushido - become the command line master.</h1>
<p>THIS BOOK MAY CONTAIN EXPLICIT LANGUAGE AND MEMES, READ AT YOUR OWN RISK !!!11</p>
<h2 id="trademarks">Trademarks</h2>
<p>Firefox is a registered trademark of the Mozilla Foundation.<br />
ImageMagick is a registered trademark of ImageMagick Studio LLC.<br />
Linux® is a registered trademark of Linus Torvalds in the U.S. and other countries.<br />
Mac and OS X are trademarks of Apple Inc., registered in the U.S. and other countries.<br />
Open Source is a registered certification mark of the Open Source Initiative.<br />
Oracle and Oracle Linux are trademarks or registered trademarks of Oracle Corporation and/or its affiliates in the United States and other countries.<br />
UNIX is a registered trademark of The Open Group.<br />
Windows is a registered trademark of Microsoft Corporation in the United States and other countries.<br />
JetBrains, PyCharm is a registered trademark of JetBrains.<br />
EuroLinux is a registered trademark of EuroLinux.<br />
All other product names mentioned herein are trademarks of their respective owners.</p>
<h2 id="about-the-author.">About the Author.</h2>
<p>I’ve written this book, so inserting “Abouth the Author” fell a little - well..</p>
<p>I’m a Linux guy, Red Hat Engineer with a bachelor’s degree in Computer Science currently working at EuroLinux, which is a small, self-funded company that surprisingly (look at the name again) makes Linux-related stuff. As a freelancer, I’ve worked for multiple smaller but also a few more prominent companies. When it comes to teaching/tutoring, I had the pleasure to work for a company that is making programming/testing bootstrap courses. I also worked as the instructor for some of the EuroLinux courses. The current state of my career (do not waste your time looking it up, it’s boring) can be found on my LinkedIn profile - linkedin.com/in/alex-baranowski/ .</p>
<h2 id="erratum">Erratum</h2>
<p>Any problems, suggestions and <del>bugs</del> errata are welcome at errata repository https://github.com/AlexBaranowski/bash-bushido-errata, on LinkedIn messages or my e-mail aleksander . baranowski at yahoo dot pl</p>
<p>All accepted errata will be published and free to download for everyone (GitHub repository).</p>
<h2 id="preface">Preface</h2>
<p>I had the pleasure to write technical blog posts as part of EuroLinux’s marketing strategy. That is when I found out that our subscribers and visitors love shorter forms with lots of titbits. After some practice, I started to produce quite clickable and (what is even more important) readable articles.</p>
<p>Inspired by the Command Line Kung-Fu book, I decided to write a Bash Bushido - a series of articles about Bash. To be honest, we planned that after 2 or 3 articles, the series will end. However, as it was quite successful and there was rich material to explore, we kept going. Unfortunately for international audiences, the series was written in Polish. If you are still interested, you can find all the articles on EuroLinux blog https://pl.euro-linux.com.</p>
<p>Then, one of my friends asked me if I could make a video course with him and publish it on some popular e-learning platforms. I decided to make the pilot project “Bash Bushido Video Course”. After some time, many mistakes, and awful videos, we realized that making a video course without a good script is a horrible idea. The book that you are reading was initially made for the video course :) and ended up as a standalone creation. If this book gains some popularity (at least 1000 sold copies in the first year :), I will make the said video course. Otherwise, it’s probably not worth the only resource that I don’t have a surplus of - time.</p>
<p>I would like to stress that some chapters have a lot of my personal <strong>opinions</strong>. Don’t treat them as a source of absolute truth. For example, the first thing that I wrote about is touch-typing, that by far (<strong>typical opinion</strong>) is one of the most important skills for any proficient computer user. I tried to put some humour in this book some of which is sarcastic and might offended you. If you are offended don’t worry - this is natural and should not interfere with your life functions. In the case of emergency, you can delete, burn or depending on the buying platform even return the book (please don’t, I need the monies).</p>
<figure>
<img src="images/00/susan.png" alt="" /><figcaption>Meme1 </figcaption>
</figure>
<p>Now let me introduce the minimalistic glossary that will be used throughout the book:</p>
<ul>
<li><code>command line</code>, <code>terminal</code>, <code>console</code> are used interchangeably - because you can type the command in the terminal, to the console or on the command line.</li>
<li>The same goes for <code>argument</code>, <code>flag</code>, <code>option</code>. Technically there is little difference (flags are booleans, the options might take one or multiple variables) - but who cares?</li>
</ul>
<p>Bash Bushido is my first (self-published, but still) book. I want to dedicate it to someone who was always there for me – my Mom.</p>
<h2 id="our-bushido.">Our Bushido.</h2>
<p>Well, I’m not a Japanese expert (watching <del>chinese</del> cartoons won’t make you one :)), but according to one of the most trusted sources on Internet (Wikipedia)[yeah teachers, I wrote the book, and I am saying that Wikipedia might be a good source!], Bushido means <em>Way of the warrior</em>. In times of rockstar developers and ninja testers, being just a regular warrior might seem a little boring. But I see it quite differently - administration, automation, keeping infrastructure safe and up-to-date is hard work that requires a lot of talent. Sometimes little tweaks in Linux kernel options can save thousands of dollars, one wrong config that gives too broad access might make a company go bankrupt and put users/clients data at risk. In case of infrastructure, you need a warrior, someone who can spend countless hours debugging, testing, tweaking and automating. Lastly, Bash Bushido sounds excellent is meaningful and original.</p>
<figure>
<img src="images/00/rockstar.jpg" alt="" /><figcaption>Meme2 </figcaption>
</figure>
<h2 id="installation-problems">Installation problems</h2>
<p>Well, there are a lot of Linux distributions. You know, like, about few hundreds at the least. From the top of my head, I can list more than 10 package managers, plus one that’s a must for Apple users. The installation steps for each of the popular system/package managers sometimes would be longer than actual trick or tip discussed.</p>
<p>Because of that, I only present the installation procedure for Enterprise Linux version 7.X (CentOS, RHEL, Scientific Linux, Oracle, EuroLinux) these distributions have a long lifespan and won’t be obsolete in next 2 or 3 years.</p>
<h1 id="let-keyboard-become-your-very-best-friend.">Let Keyboard Become Your Very Best Friend.</h1>
<p>In countless texts, articles and how-tos we read about a better, faster, or shorter way to do something on the computer. The most prominent example is coping and pasting. Nearly all computer users know that <code>ctrl + c</code> and <code>ctrl + v</code> are the best <del>homework and essay generators</del> friends. Another great example is the <code>ctrl</code> + <code>alt</code> + <code>delete</code> key combination - the must-know for all Windows users.</p>
<p>However, a lot of these tricks, tips and shortcuts are not very handy unless you are touch-typist. Why? Because a lot of them take advantage of typical hands positions on the keyboard during typing. For example, the whole <code>vim</code> navigation was made to use the home row. To get the right position and become the power user, you really should learn how to touch type.</p>
<p>Some readers might not know what touch typing is. Fortunately, there is an excellent definition of touch typing on Wikipedia. To sum it up - touch typing is the ability to use (type on) the keyboard without looking at it.</p>
<h3 id="reasons-to-learn-touch-typing.">Reasons to learn touch typing.</h3>
<ul>
<li>Average typing speed is about 40 WPM (word per minute), people who type without looking at the keyboard can type twice as fast on average. Note that the average typing speed includes the group of touch-typers :).</li>
<li>You can get more things done.</li>
<li>So, you have more time for <del>work</del> coffee and social activities.</li>
<li>You see <del>yru</del> your typos as you type (you are looking at the monitor, not the keyboard). So, there is higher chance of catching and correcting them.</li>
<li>When you compose an email, you don’t look like tech Amish.</li>
<li>From my point of view, the most advantageous fact is that there is no barrier between my mind and the code (texts) that I’m writing. The keyboard it the “extension” of my body. Writing programs is not easy, and it’s easy to lose focus when you are “fighting” with the keyboard.</li>
</ul>
<h3 id="reasons-not-to-learn-touch-typing.">Reasons not to learn touch typing.</h3>
<ul>
<li>When you are working for a corporation, where you have plenty of time and saying that work is done is more important than actually doing it, then touch typing might improve your work performance what is not preferred.</li>
<li><strong>404</strong> - any real acceptable argument <strong>not found</strong>.</li>
</ul>
<h3 id="what-is-needed-to-learn-touch-typing">What is needed to learn touch typing?</h3>
<p>About 15 minutes per day for 2-3 months at maximum, I saw my ex-girlfriend learn that in less than a month. OK, you’ve got me - I’ve never had a girlfriend, the distant friend of my friend (my friends also never had girlfriends) told that story to me.</p>
<h3 id="learn-how-to-touch-type-in-the-linux-terminal.">Learn how to touch type in the Linux terminal.</h3>
<p>This book is committed to the command line and terminal program/stuff. But it’s only fair to say that there are great programs like “klavaro” or “ktouch”, with their fancy GUIs and all necessary lessons, great statistics showing your progress, interfaces, etc.</p>
<p>When it comes to the console, there is one minimalistic program that I can honestly recommend - <code>gtypist</code>. <code>gtypist</code> is ncurses-based, so it’s minimal, yet powerful.</p>
<p>It’s so niched that it’s unavailable in many distributions (like EL). So you have to compile it by yourself. It requires basic ncurser development libraries and C language compiler. In the case of Enterprise Linux, you can simply install <strong><span class="citation" data-cites="development">@development</span></strong> package group that have a lot of development packages and ncurses-devel package.</p>
<pre><code>sudo yum install -y @development ncurses-devel</code></pre>
<p>After installation completes:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">wget</span> https://ftp.gnu.org/gnu/gtypist/gtypist-2.9.5.tar.xz</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">tar</span> xvf gtypist-2.9.5.tar.xz</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="bu">cd</span> gtypist-2.9.5/</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="ex">./configure</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="fu">make</span> </span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="fu">sudo</span> make install</span></code></pre></div>
<p>This will compile gtypist and copy it to the <code>/usr/local/bin</code> directory. Depending on your <code>$PATH</code> environment variable, it should be executable right away.</p>
<figure>
<img src="images/01-touchtyping/1.png" alt="" /><figcaption>GNU Typist - gtypist. </figcaption>
</figure>
<p>The program is self-explanatory, there is small help section that you can read, but it is as minimalistic as the program itself. For touch typing newcomers, I endorse the T series, as it’s easier than the Q series. It introduces each key slowly and has extensive exercise patterns, that helps to build the foundation for touch typing.</p>
<p>When it comes to practice time, multiple studies about learning proved that <strong>daily</strong> short practice sessions are way more effective than long sessions that are not regular. Another important consideration is how to replace the old routine. If you learn how to type a letter correctly, always do it the right way. It’s crucial to replace the old typing habits with the new ones. Because learning takes time at first, you might type slower, but after some time, your speed will increase dramatically.</p>
<p>The default gtypist color scheme might be unreadable on some terminal emulators and color scheme combinations. Luckily, you can experiment and change it.</p>
<ul>
<li><code>-c</code> or <code>--colors</code>- set the main colors of the program.</li>
<li><code>--banner-colors</code> - allows setting up all colors used by gtypist. You can choose colors from numbers 0-7, what gives us 64 combinations for foreground and background colors.</li>
</ul>
<p>Sample gtypist invocationwith changed color schemes:</p>
<pre><code>gtypist -c=0,2
gtypist --banner-colors=0,2,3,2 </code></pre>
<p>The <code>typefortune</code> is a neat gtypist utility that uses <code>fortune</code> command output and invokes gtypist on it. Because <code>typefortune</code> is written in Perl it requires working interpreter.</p>
<h1 id="essential-bash-shortcuts">Essential Bash Shortcuts</h1>
<p>Some inexperienced Linux users use arrows to navigate the command line. You can use up and down arrows to change the current position in the history (previously executed commands) and left or right arrow to change the current position of the cursor. It is simple, intuitive and ssssllloooooowww.</p>
<p>When I see a Linux administrator/developer/power user using the arrows to navigate on the command line, something breaks inside of me as this is one of the saddest view in the world. People who operate one of the greatest achievements of humankind (Unix/Linux Operating System) don’t use the console properly! How someone for whom command line is bread and butter for more than ten years might not know <strong>the basic</strong> key bindings? Well, the answer is obvious - they never read “Bash Bushido”, Bash Manual or info pages about the GNU Readline!</p>
<h2 id="gnu-readline">GNU Readline</h2>
<p>Bash, like most software, uses the external/shared libraries to implement the functionalities. When it comes to reading and manipulating the user input, Bash uses the popular GNU Readline library. One of its core features is the control of the line you are currently typing. This lib (it’s common to use the abbreviation for library) is as old as <del>the Universe</del> Bash. So, it has an extremely stable and mature interface. Actually, lots of software working in the REPL (Read-Eval-Print Loop) manner uses GNU Readline as the input library or readline-like shortcuts to navigate/control the line. Some of the examples are <code>python</code>, <code>perl</code> or <code>psql</code> - the PostgreSQL interactive terminal.</p>
<p>To get the current Readline configuration, you can use bash built-in <code>bind</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ bind -P </span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="ex">abort</span> can be found on <span class="st">&quot;\C-g&quot;</span>, <span class="st">&quot;\C-x\C-g&quot;</span>, <span class="st">&quot;\e\C-g&quot;</span>.</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="ex">accept-line</span> can be found on <span class="st">&quot;\C-j&quot;</span>, <span class="st">&quot;\C-m&quot;</span>.</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="ex">alias-expand-line</span> is not bound to any keys</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="ex">arrow-key-prefix</span> is not bound to any keys</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="ex">...</span> (output truncated)</span></code></pre></div>
<p>There is a ton of commands there! Don’t panic! Throughout this book, you will read about the most important ones.</p>
<h2 id="previous-and-next-command.-and-.">Previous and next command. ↑ and ↓.</h2>
<p>The <code>ctrl</code> + <code>p</code> shortcut works like the arrow up (which asks Bash history about the previous command). The opposite is <code>ctrl</code> + <code>n</code> (which asks the bash for the next command in the history). With these two shortcuts, you don’t have to move your right hand to the arrow area to go through the Bash history.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo 1</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="ex">1</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo 2</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="ex">2</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo 3</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="ex">3</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo 3 <span class="co"># After ctrl+p</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo 2 <span class="co"># After ctrl+p</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo 3 <span class="co"># After ctrl+n</span></span></code></pre></div>
<p>Mnemonics:</p>
<ul>
<li><code>ctrl</code> + <code>p</code>revious command</li>
<li><code>ctrl</code> + <code>n</code>ext command</li>
</ul>
<h2 id="character-forward-and-backwards.-and-arrows.">Character forward and backwards. → and ← arrows.</h2>
<p>To move forward by one character, use <code>ctrl</code> + <code>f</code>, and to move the cursor backward by one character, use <code>ctrl</code> + <code>b</code>. After remembering these and previous shortcuts, the arrows become obsolete :).</p>
<p>Mnemonics:</p>
<ul>
<li><code>ctrl</code> + <code>f</code>orward</li>
<li><code>ctrl</code> + <code>b</code>ackward</li>
</ul>
<h2 id="home-and-end-keys"><code>home</code> and <code>end</code> keys</h2>
<p>Instead of using <code>home</code> key (moves the cursor to the beginning of the current line) and <code>end</code> key (moves the cursor to the end of the current line), which, by the way, is not that bad (it at least shows that someone can read what is written on the keyboard that she/he/they is sitting in front of for YEARS or even decades of life). You can use <code>ctrl</code>+<code>e</code> key combination that works like the <code>end</code> key and <code>ctrl</code> + <code>a</code> key combination that works like the <code>home</code> key.</p>
<p>Mnemonics:</p>
<ul>
<li><code>ctrl</code> + <code>e</code>nd</li>
<li><code>ctrl</code> + <code>a</code>ppend to the beginning</li>
</ul>
<p>You might ask yourself if it’s really that better than <code>home</code> and <code>end</code> keys. Well, yes! Even if you have to move your left hand a little bit to hit <code>ctrl</code> , the movement is by far shorter than the right hand leaving the typing area to get to the navigation keys area.</p>
<h2 id="delete-and-backspace"><code>Delete</code> and <code>backspace</code></h2>
<p>Surprisingly, many people don’t know the difference between <code>backspace</code> and <code>delete</code> keys. The <code>backspace</code> key removes the character <strong>before the cursor</strong>, while <code>delete</code> key removes the character <strong>under the cursor</strong>.</p>
<p>Armed with this theoretically obvious knowledge, you can learn two different shortcuts. <code>ctrl</code> + <code>d</code> removes the character under the cursor. <code>ctrl</code> + <code>h</code> removes the character before the cursor. I hope that you didn’t think there will be an actual shortcut for the <code>backspace</code> key :).</p>
<p>Mnemonics:</p>
<ul>
<li><code>ctrl</code> + <code>d</code>elete</li>
<li><code>ctrl</code> + <code>h</code>rHrHrHrHr - sound that cat a makes when it wants to remove the character before the cursor.</li>
</ul>
<h2 id="different-ways-to-enter">Different ways to <code>Enter</code>!</h2>
<p>This one is quite useless because the <code>enter</code> key is exceptionally close to your right-hand’s little finger, but if you want, you can use <code>ctrl</code> + <code>j</code> or <code>ctrl</code> + <code>m</code> instead of the regular boring <code>enter</code> key. Both of those shortcuts are bound to the <code>accept-line</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ bind -P <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&#39;C-m&#39;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="ex">accept-line</span> can be found on <span class="st">&quot;\C-j&quot;</span>, <span class="st">&quot;\C-m&quot;</span>.</span></code></pre></div>
<h2 id="one-word-forward-and-backward.">One word forward and backward.</h2>
<p>Up until this moment, you have learned a bunch of useful shortcuts, but each of them can be replaced with a single key-stroke. The really powerful shortcuts are those which are not represented by a single keyboard key - the first one that you will learn is moving forwards and backwards but by the distance of whole words instead of one pitiful character. The <code>alt</code> + <code>f</code> and <code>alt</code> + <code>b</code> key combinations, move the cursor forwards and backwards by one word, respectively.</p>
<p>Mnemonics:</p>
<ul>
<li><code>alt</code> + <code>f</code>orward</li>
<li><code>alt</code> + <code>b</code>ackward</li>
</ul>
<h2 id="remove-from-the-cursor-position-to-the-end-of-the-word.">Remove from the cursor position to the end of the word.</h2>
<p>You might already notice that some shortcuts have a more <strong>powerful</strong> version when you hit <code>alt</code> key instead of <code>ctrl</code> key. <code>ctrl</code> + <code>d</code> removes one character when <code>alt</code> +<code>d</code> removes the whole word.</p>
<p>Note: There is group of shortcuts that uses both <code>alt</code> and <code>ctrl</code> in most cases the version with <code>alt</code> is way more powerful.</p>
<p>Mnemonics: - <code>alt</code> + <code>d</code>elete</p>
<h2 id="remove-from-the-cursor-to-the-start-end-of-command-line">Remove from the cursor to the {start, end} of command line</h2>
<p>To remove all text from the current cursor position to the end of the line use <code>ctrl</code>+<code>k</code>. In order to remove all text from the current cursor position to the start of the line use <code>ctrl</code>+<code>u</code>.</p>
<p>For example, when the cursor is set on the first b letter (shown with the <code>|</code> character):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a>$ <span class="ex">aaa</span> <span class="kw">|</span><span class="ex">bbb</span> ccc</span>
<span id="cb7-2"><a href="#cb7-2"></a>$ <span class="ex">aaa</span>  <span class="co"># After `ctrl` +k</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>$ <span class="ex">aaa</span> <span class="kw">|</span><span class="ex">bbb</span> ccc</span>
<span id="cb7-4"><a href="#cb7-4"></a>$ <span class="ex">bbb</span> ccc  <span class="co"># After `ctrl` + u</span></span></code></pre></div>
<p>Mnemonics:</p>
<ul>
<li><code>ctrl</code> + <code>k</code>ill everything</li>
<li><code>ctrl</code> + <code>u</code>proot everything</li>
</ul>
<h2 id="how-to-practise-it">How to practise it?</h2>
<p>Well, there is a little repository I made at https://github.com/AlexBaranowski/bash-shortcuts-teacher. It aims to help you learn the most important Bash shortcuts. Whenever you use arrows, home or end keys, it prints a message that there are shortcuts for that, it is a simple penalty mechanism - you have to remove this message :).</p>
<h1 id="extra-cool-keyboard-shortcuts-in-bash">Extra cool keyboard shortcuts in Bash:</h1>
<p>In the previous chapter, we looked into the basic shortcuts that help edit the current line. In this chapter, we are going to look into shortcuts that will boost your performance.</p>
<h2 id="clear-the-screen">Clear the screen</h2>
<p><code>ctrl</code> + <code>l</code> is the one <strong>ESSENTIAL</strong> shortcut for all power users - it clears the screen, just like the <code>clear</code> command. However, to keep even a simple <code>clear</code> command faithful to the spirit of Bash Bushido, I encourage readers to check what happens when we put <code>clear</code> in a Bash script, then invoke it. You can try it on different terminal emulators to determine if this behaviour is terminal emulator dependent.</p>
<h2 id="history-search">History search</h2>
<p>Edit note: If your knowledge about the bash history mechanism is near zero, you might read the <a href="#bash-history">Bash History</a> chapter first.</p>
<p>To search the Bash history the from current position in the history (most likely the end), use <code>ctrl</code> + <code>r</code>. This key combination is bind to <strong>reverse-search-history</strong> function. Then type-in the beginning of the command you want to find. Let’s assume that your previous commands look like that:</p>
<pre><code>1 echo &quot;first on history&quot;
...
150 banner &quot;I like this&quot;
...
250 banner2 &quot;I love this&quot;
..
500 echo &quot;I&#39;m last&quot;</code></pre>
<p>We also assume here that both banner and banner2 are unique throughout the whole history file. So, after invoking the reverse-search-history and typing “bann” you might get</p>
<pre><code>(reverse-i-search)`bann&#39;: banner2 &quot;I love this&quot;</code></pre>
<p>After invoking a command, you always arrive at the end of the history. However, if you press <code>esc</code> during the reverse history search, your current position in the history is going to be set to the position of currently found match. In our example with <code>bann</code>, it will be 250. Therefore, a subsequent reverse search will search lines from 250 to 1. So, the next reverse search for “bann” will return the command <code>banner "I like this"</code>.</p>
<p>To get back to the end of history, you can use a <strong>smooth</strong> trick - hit enter with the empty prompt. The other fancier solution is to use <code>end-of-history</code> Readline function that is bound to the <code>alt</code> + <code>&gt;</code> key combination.</p>
<p>The second less-known history search type the is <strong>forward-search-history</strong> that is bound to <code>ctrl</code> + <code>s</code>. Because in most cases your current position is at the end of the history, it’s not as well known and to be honest - not frequently used. Let’s use our imaginary history file (the one presented above) once again. Firstly, you might use the <code>beginning-of-history</code> Readline function bound to the <code>alt</code> + <code>&lt;</code> key combination, then invoke the forward search and type ‘bann’:</p>
<pre><code>(i-search)`banner&#39;: banner &quot;I like this&quot;</code></pre>
<p>Mnemonics:</p>
<ul>
<li><code>alt</code> + <code>&lt;</code> - start of some section (<code>&lt;</code>) in multiple languages (ex. HTML, XML, C/C++(include, templates, etc.))</li>
<li><code>alt</code> + <code>&gt;</code> end of some section (<code>&gt;</code>) in multiple languages (ex. HTML, XML, C/C++(include, templates, etc))</li>
<li><code>ctrl</code> + <code>r</code>everse - search from the current position in REVERSE mode</li>
<li><code>ctrl</code> + <code>s</code>tart - search from the START</li>
</ul>
<h2 id="get-current-bash-version">Get current Bash version</h2>
<p><code>ctrl</code>+<code>x</code> then <code>ctrl</code> + <code>v</code> prints the Bash version. If bash is not in 4+ or 5+ version, it means that you are working on a legacy system or Apple MacOS. Apple won’t update bash to 4.X because of the license change to GPL v3+. To be fair, in most cases it’s not a big deal, but if a script uses some newer features (e.g. using associative arrays introduced in Bash 4.0) it can become quite a problem. In the beginning of 2019, version 5.0 was released. I highly recommend reading its release notes.</p>
<p>Mnemonics:</p>
<ul>
<li><code>ctrl</code>+<code>x</code> then <code>ctrl</code> + <code>v</code>ersion.</li>
<li>My mnemonics for <code>ctrl</code>+<code>x</code> - <code>ctrl</code>+e<code>x</code>pert :)</li>
</ul>
<h2 id="undo-in-bash">UNDO in Bash</h2>
<p>Sometimes when editing a crazy-long line, you might make some mistakes. Then the <code>ctrl</code> + <code>_</code> can be used to undo the <del>damage</del> change. The same effect can be achieved with <code>ctrl</code> + <code>7</code>. Both <code>ctrl</code>+<code>_</code> (note that <code>_</code> requires the <code>shift</code> key), and <code>ctrl</code> + <code>7</code> send the same input to Bash. You can check it with <strong>quoted-insert</strong> that is described in <a href="#making-your-own-command-line-shortcut">Making your own command line shortcut</a>.</p>
<p>Mnemonics:</p>
<ul>
<li><code>ctrl</code>+<code>x</code> then <code>ctrl</code> + <code>u</code>ndo.</li>
</ul>
<h2 id="invoke-your-favourite-editor.">Invoke your favourite $EDITOR.</h2>
<p>Sometimes there is a need to type a longer script ad-hoc. It’s more convenient to use the favourite text editor than to type the script line by line. For this use-case, there is a great <strong>edit-and-execute-command</strong> function, that is a bind to the <code>ctrl</code> + <code>x</code> then <code>ctrl</code> + <code>e</code> key combo.</p>
<p>According to bash source code (file <code>bashline.c</code>), the function responsible for this behaviour is actually named <code>edit_and_execute_command</code>. For the default (emacs) key bindings, the command invoked is <code>fc -e \"${VISUAL:-${EDITOR:-emacs}}</code>, which means that the first variable that will be used is VISUAL, then EDITOR (if VISUAL is not set), lastly if none of them worked, <code>emacs</code> will be used. Emacs used to be a popular text editor (I personally know only a few people that use it on a regular basis, but some of the most famous programmers like the great Linus Torvalds [Original creator and Lead of Linux development] love it) made by Richard Stallman (the guy who started the free/libre software movement). A side note, the default Readline bindings are emacs-like :).</p>
<p>To set your favourite editor, you can add the following to your <code>~/.bashrc</code> file:</p>
<pre><code>EDITOR=vim</code></pre>
<p>Lastly, because Richard Stallman is in my opinion a very serious figure, here is a not-so-serious Richard Stallman picture. Kawaii-Stallman the guru of 4chan’s /g/ board.</p>
<figure>
<img src="images/03-cool-shortcuts/stallman-kawaii.png" alt="" /><figcaption>Stallman Kawaii </figcaption>
</figure>
<h2 id="shell-expand-line">shell-expand-line</h2>
<p><code>ctrl</code> + <code>alt</code> + <code>e</code> is one of my favourite bash shortcuts. This function can be used to check if a command is aliased, expand a subshell and make a history expansion. There are also other expansions, but they are not as popular as this one. You can find them with <code>bind -P | grep expand</code>.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ mkdir <span class="dt">{1,2,3}{a,b,c}</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ echo <span class="va">$(</span><span class="fu">ls</span> -d 1*<span class="va">)</span> <span class="co"># # `ctrl`+`alt`+`e`</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co"># Changes into</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ echo 1a 1b 1c</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ grep <span class="co"># `ctrl`+`alt`+`e`</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co"># Changes into </span></span>
<span id="cb13-3"><a href="#cb13-3"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ grep --color=auto</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ history <span class="kw">|</span> <span class="fu">head</span> -3</span>
<span id="cb14-2"><a href="#cb14-2"></a>    <span class="ex">1</span>  vim ~/.bashrc </span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="ex">2</span>  vim ~/.bashrc </span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="ex">3</span>  bash</span>
<span id="cb14-5"><a href="#cb14-5"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$  !2 <span class="co"># `ctrl`+`alt`+`e`</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co"># Changes into</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ vim ~/.bashrc </span></code></pre></div>
<p>Unfortunately <code>shell-expand-line</code> function won’t expand globs.</p>
<h2 id="glob-expansion">glob-expansion</h2>
<p>Because <code>glob</code> might be a new word for some people, here is a minimalistic definition - globs are patterns that specify the pathname. I highly recommend reading the <code>glob(7)</code> manual page. The key biding for <code>glob-expansion</code> is <code>ctrl</code> + <code>x</code> then <code>*</code>. To understand globs let’s look at the following example.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># This shell expansion makes directory a/a a/b and a/c</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ mkdir -p a/<span class="dt">{a,b,c}</span>/ </span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co"># This shell expansion makes three empty files with song.mp3 name</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ touch a/<span class="dt">{a,b,c}</span>/song.mp3</span>
<span id="cb15-5"><a href="#cb15-5"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ ls a/*/*mp3 </span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co"># After hitting glob-expand-word.</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ ls a/a/song.mp3 a/b/song.mp3 a/c/song.mp3 </span></code></pre></div>
<p>Another example:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1"></a><span class="ex">Alex@Normandy</span>:~/$ ls -1 /etc/[d]*</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co"># After hitting glob-expand-word.</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="ex">Alex@Normandy</span>:~/$ ll -d /etc/dbus-1 /etc/dconf /etc/default <span class="co">#... output truncated</span></span></code></pre></div>
<p>Mnemonics:</p>
<ul>
<li><code>ctrl</code> + <code>x</code> then <code>*</code>. The <code>*</code> is a wildcard in the most popular regular expression.</li>
</ul>
<h2 id="is-that-all">Is that all?</h2>
<p>NOOO! There are many more functions implemented in Bash and Readline library. So many that some of them aren’t even bound out of box to any shortcut. To list all of them in a nice format with a name, use the previously introduced <code>bind -P</code> command.</p>
<h1 id="vim-me-like-you-do-vim-me-like-you-do">VIM me like you do VIM me like you do</h1>
<p>The title of this chapter is inspired by the song ‘Love Me Like You Do’. Unfortunately, this song was used (or even made for, I don’t care) in 50 shades of Grey movie (I read about 25% of the first book, it was enough to make me temporary blind). As DevOps/admin/whatever-I-am-even-doing I simply love Vim.</p>
<h2 id="what-about-the-bash-readlines-vim-mode">What about the Bash readline’s vi(m) mode?</h2>
<p>Well, the vi(m) mode sucks. Really. The reason why it sucks is quite easy to explain - the readline (emacs like) configuration is perfect for editing a single line. The strongest features of vim. like home row navigation and the ability to repeat something multiple times are not very useful when you edit a single line. There is also a problem with the fact that Bash does not show the current vim mode (FISH shell for example does) out of the box. What it’s even more irritating is that some of the most useful shortcuts, like <code>ctrl</code> + <code>l</code>, won’t work. Aaaand finally, even with the vi mode enabled you still have to use the subset of commands from emacs mode.</p>
<p>It’s a free country, though, so if you really want to use bash in vi mode, you can enable it with <code>set -o vi</code>.</p>
<p>As a self-proclaimed <code>vim</code> lover, I recommend staying with the <code>emacs</code> shortcuts.</p>
<figure>
<img src="images/04-about-vim/treason.jpg" alt="" /><figcaption>Even prequels are better than the new films. </figcaption>
</figure>
<h2 id="best-30-minute-investment---vimtutor.">Best 30 minute investment - vimtutor.</h2>
<p>Well, there are three types of people in the Linux world. The first group are those old enough to use a pretty good operating system that includes: mailer, news reader, web browser, directory editor, CVS interface and a finally text editor - <code>emacs</code>. The second group are people who acknowledge that in nearly all distributions, on all servers, there is a minimalistic program called <code>vi</code>. Ahhh, and the last group are normies.</p>
<p>Vim is an abbreviation of Vi IMproved :). You can think about the <code>vi</code> program as a subset of <code>vim</code> functionalities. So, when you dig into the basics of “real” <code>vim</code>, you also learn <code>vi</code>.</p>
<p>Some benefits of using vim:</p>
<ul>
<li>It exists on all kinds and flavours of Unix, and all “worth your time” Linux platforms (in most cases in a minimal install) - the coverage alone is enough of a reason to learn it.</li>
<li>Home-row navigation. No, you don’t have to use cursor (arrow) keys - it’s much faster to stay in the home-row.</li>
<li>Home-row centric, so you rarely move your fingers from the home row.</li>
<li>Nearly every repetitive task has a shortcut - everyone loves shortcuts.</li>
<li>Vim conserves keystrokes if you want to delete 100 lines, you just type <code>100dd</code>.</li>
<li>Easy to learn bookmarks.</li>
<li>Every worthy IDE has vim-like key bindings. Even some more exotic ones like RStudio or Haroopad (markdown Editor) do.</li>
<li>S***LOAD of plugins.</li>
<li>Did I mention home row?</li>
</ul>
<p>Some additional tips:</p>
<ul>
<li>Switching ECS with CAPS LOCK FTW! Remember that this might be irritating when using someone else’s computer.</li>
</ul>
<figure>
<img src="images/04-about-vim/developer_tweet.png" alt="" /><figcaption>TwEeT sCreEnShOtS aRe NoT mEmEs </figcaption>
</figure>
<p>To learn the basics of vim:</p>
<ol type="1">
<li>Install vim: <code>sudo yum install -y vim</code>.</li>
<li>Invoke <code>vimtutor</code>.</li>
</ol>
<p>Vimtutor should take you about 25-30 minutes, and it’s worth every second of your time.</p>
<p>To make vim your default editor, you can use the following code:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$  { grep -q <span class="st">&quot;EDITOR=vim&quot;</span> .bashrc <span class="kw">&amp;&amp;</span>  <span class="bu">echo</span> <span class="st">&quot;EDITOR=vim is already set&quot;</span> <span class="kw">;</span> } <span class="kw">||</span> <span class="bu">echo</span> <span class="st">&quot;export EDITOR=vim&quot;</span> <span class="op">&gt;&gt;</span> ~/.bashrc</span></code></pre></div>
<h2 id="i-dont-need-vim---i-have-my-powerful-ide.">I don’t need vim - I have my powerful IDE.</h2>
<p>Well, it’s true - vim is small, even with the best plugins, most popular IDEs will probably in many aspects surpass it. However, as said before, nearly all IDEs have the vim plugin. With this approach, you can get the best of two worlds. A lot of my “serious” development is done with JetBrains IDE’s. Fortunately, the IdeaVim plugin supports all of the most popular operations.</p>
<h2 id="edit-file-over-ssh-http-ftp-and-more-with-vim.">Edit file over ssh, HTTP, FTP and more with Vim.</h2>
<p>As console warriors, sometimes we must edit remote files. We usually log into a machine and then open our editor of choice. The second option is to copy the file, edit it on our machine then overwrite it on the target machine.</p>
<p>In the first solution, the editor of our choice must be present on the machine (don’t expect <code>vim</code>, but <code>vi</code> will be on 99.9% systems). Even if we had the editor of our choice: we lose the whole (amazing) configuration, favourite plugins and custom key bindings.</p>
<p>The second solution requires three steps (copy, edit, push into the host) - so it might be too long (it’s easy to script though).</p>
<p>Fortunately, there is also another vim specific solution that is way cooler! You can ask vim politely to edit a remote file.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1"></a><span class="co">#vim PROTOCOL://USER@HOST//PATH</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="ex">vim</span> scp://alex@jumphost:/etc/ssh/sshd_config</span></code></pre></div>
<p>Supported protocols include: - ftp - http - rcp - scp</p>
<h2 id="further-reading-about-vim">Further reading about vim</h2>
<p>The best way to start a journey with <code>vim</code> is to use the <code>vimtutor</code>. Other resources that I can recommend are <code>:help</code> that is built in vim, <strong>vim.org</strong> and <strong>vim.fandom</strong> websites.</p>
<h1 id="calendars">Calendars</h1>
<p>In this chapter, we discuss an exceptionally lightweight topic - how to use calendars from the command line. Calendars are ultra-important tools to keep track of the upcoming events (like birthdays of loved ones or your favourite conferences). According to some productivity practices, you should keep your schedule as full as possible. And in that case, a good calendar client is a must-have.</p>
<h2 id="basic-calendar">Basic calendar</h2>
<p>The most basic calendar in the command line environment is the <code>cal</code>endar. The <code>cal</code> program is a part of the <code>util-linux</code> package. In most Linux distros, it’s installed even on the most minimalistic (cloud) images. Invoking <code>cal</code> without an argument prints the current month layout.</p>
<pre><code>[Alex@localhost ~]$  cal
      July 2017     
Su Mo Tu We Th Fr Sa
 1  2  3  4  5  6  7
 8  9 10 11 12 13 14
15 16 17 18 19 20 21
22 23 24 25 26 27 28
29 30 31</code></pre>
<p><code>Cal</code> can also be asked about a particular date, in this case my friend’s birthday.</p>
<pre><code>[Alex@localhost ~]$ cal 13 5 1994
      July 1994     
Su Mo Tu We Th Fr Sa
                1  2
 3  4  5  6  7  8  9
10 11 12 13 14 15 16
17 18 19 20 21 22 23
24 25 26 27 28 29 30
31</code></pre>
<p>There is also a useful option <code>-3</code> that will print the previous, the current and the next month’s dates.</p>
<pre><code>[Alex@localhost ~]$ cal -3
      July 2018 
Su Mo Tu We Th Fr Sa
 1  2  3  4  5  6  7 
 8  9 10 11 12 13 14 
15 16 17 18 19 20 21 
22 23 24 25 26 27 28 
29 30 31 
      August 2018 
Su Mo Tu We Th Fr Sa  
          1  2  3  4  
 5  6  7  8  9 10 11 
12 13 14 15 16 17 18  
19 20 21 22 23 24 25  
26 27 28 29 30 31

September 2018    
... (output truncated)</code></pre>
<p>This option can be combined with any given date.</p>
<pre><code>[Alex@localhost ~]$ cal -3 1 7 1994
      June 1994
Su Mo Tu We Th Fr Sa
          1  2  3  4
 5  6  7  8  9 10 11
12 13 14 15 16 17 18
19 20 21 22 23 24 25
26 27 28 29 30

      July 1994               
Su Mo Tu We Th Fr Sa
                1  2
 3  4  5  6  7  8  9
10 11 12 13 14 15 16
17 18 19 20 21 22 23
24 25 26 27 28 29 30
31

August 1994 
... (output truncated)</code></pre>
<p>To print the whole year, type it as the first and only argument.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1"></a>[<span class="ex">Alex@Normandy</span> ~]$ cal 2020</span>
<span id="cb23-2"><a href="#cb23-2"></a>                               <span class="ex">2020</span>                               </span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a>       <span class="ex">January</span>       </span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="ex">Su</span> Mo Tu We Th Fr Sa </span>
<span id="cb23-6"><a href="#cb23-6"></a>          <span class="ex">1</span>  2  3  4 </span>
<span id="cb23-7"><a href="#cb23-7"></a> <span class="ex">5</span>  6  7  8  9 10 11 </span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="ex">12</span> 13 14 15 16 17 18 </span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="ex">19</span> 20 21 22 23 24 25 </span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="ex">26</span> 27 28 29 30 31    </span>
<span id="cb23-11"><a href="#cb23-11"></a><span class="ex">...</span> (output truncated)</span></code></pre></div>
<p>Note: United States <del>of the LULZ</del> decided that it’s a good idea to use imperial units, “logical” date format (see picture below) and what is annoying in our case - have a week start set to Sunday. To overcome this cringe use this alias:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$  echo <span class="st">&quot;alias cal=&quot;</span>cal -m<span class="st">&quot; &gt;&gt; ~/.bashrc</span></span></code></pre></div>
<figure>
<img src="images/05-calendars/usa-vs-europe.jpg" alt="" /><figcaption>USA vs Europe date format logic </figcaption>
</figure>
<h2 id="manage-google-calendar-from-the-command-line">Manage Google Calendar from the command line</h2>
<p>One of the most popular Internet calendar services is the one provided by Google with the extremely creative name - Google Calendar. By the way, when the company image is failing, names like “$COMPANY_NAME $PRODUCT” also start to sound bad. But I digress, you can view, edit, delete, and even import events from other sources without leaving the command line! All of this is possible with the <code>gcalcli</code> program. The name is easy to remember <code>Google CALendar Command Line Interface</code> - <code>gcalcli</code>.</p>
<p>Github project page: https://github.com/insanum/gcalcli</p>
<p>To install it you need the <code>pip</code> - the Python package manager. In case of Enterprise Linux it can be be installed from the EPEL repository.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">sudo</span> pip install gcalcli vobject parsedatetime</span></code></pre></div>
<p>After installation, the <code>gcalcli</code> can be invoked with <code>list</code> argument (a subcommand). If calendar is not configured, it will start the browser to configure access to a Google calendar.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1"></a>[<span class="ex">Alex@SpaceShip</span> el7]$ gcalcli list</span></code></pre></div>
<p>After this straightforward procedure, the <code>list</code> should list an actual calendar.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1"></a>[<span class="ex">Alex@SpaceShip</span> el7]$ gcalcli list</span>
<span id="cb27-2"><a href="#cb27-2"></a> <span class="ex">Access</span>  Title</span>
<span id="cb27-3"><a href="#cb27-3"></a> <span class="ex">------</span>  -----</span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="ex">owner</span>  my.gmail.mail@gmail.com</span>
<span id="cb27-5"><a href="#cb27-5"></a> <span class="ex">reader</span>  Contacts</span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="ex">...</span></span></code></pre></div>
<p>To list all calendar events for the week:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1"></a>[<span class="ex">Alex@SpaceShip</span> el7]$ gcalcli calw </span></code></pre></div>
<p>To list the week for the particular calendar (my.gmail.mail@gmail.com) combine <code>calw</code> with <code>--calendar</code> option.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1"></a>[<span class="ex">Alex@SpaceShip</span> el7]$ gcalcli calw --calendar my.gmail.mail@gmail.com</span></code></pre></div>
<p>To list the whole month, replace <code>w</code>eek with <code>m</code>onth in <code>cal</code> subcommand (I feel relaxed looking at the output of this command)</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1"></a>[<span class="ex">Alex@SpaceShip</span> el7]$ gcalcli calm </span></code></pre></div>
<p>To list holidays, you might use the Holidays calendar.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1"></a>[<span class="ex">Alex@SpaceShip</span> el7]$ gcalcli calm --calendar Holidays</span></code></pre></div>
<p>Making an event is dead simple because it is an interactive form :).</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1"></a>[<span class="ex">Alex@SpaceShip</span> el7]$ gcalcli add </span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="ex">Title</span>: Bash Bushido Grammarly check</span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="ex">Location</span>: Cracow</span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="ex">When</span>: 10/10/2018 18:00</span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="ex">Duration</span> (mins)<span class="bu">:</span> 120</span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="ex">Description</span>: BB check</span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="ex">Enter</span> a valid reminder or <span class="st">&#39;.&#39;</span> to end: 30</span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="ex">Enter</span> a valid reminder or <span class="st">&#39;.&#39;</span> to end: .</span></code></pre></div>
<p>With a lot of events in the calendar, you might want to search for the chosen event with the <code>search</code> subcommand.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1"></a>[<span class="ex">Alex@SpaceShip</span> el7_builder]$ gcalcli search bash</span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="ex">2018-10-10</span>   6:00pm  Bash Bushido Grammarly check</span></code></pre></div>
<p>The event deletion functionality searches for matching events first and then asks for removal confirmation.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1"></a>[<span class="ex">Alex@SpaceShip</span> el7_builder]$ gcalcli delete bash</span>
<span id="cb34-2"><a href="#cb34-2"></a></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="ex">2018-10-10</span>   6:00pm  Bash Bushido Grammarly check</span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="ex">Delete?</span> [N]o [y]es [q]uit: y</span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="ex">Deleted</span>!</span></code></pre></div>
<p><code>gcali</code> has embedded help invoked with <code>-h</code> or <code>--help</code> parameter. By the way, any option that starts with <code>h</code> will work, so <code>--hasjxcvzvwW</code> also yields a help message. The official GitHub repository’s README.md is also a good source of information about this great program.</p>
<h2 id="other-projects">Other projects</h2>
<p>The other projects that can be used to manage calendars that support the CalDAV protocol are:</p>
<ul>
<li><code>khal</code> - The Khal project requires <code>vdirsyncer</code> to sync the calendars. Because of that, the setup might be tedious (<code>vdirsyncer</code> is a vast project with an extensive documentation).</li>
<li><code>calendar-cli</code> - this one is much easier to setup.</li>
</ul>
<p>Unfortunately, because your calendar provider might implement CalDAV the “right” (bite my shiny metal ass) way, these projects might not work correctly with all calendar services/providers. It happened in my case. Therefore, I would love to say that there are projects that allow manipulating calendars with an excellent command-line interface. However, I won’t recommend and elaborate on any of them as they didn’t work as expected with my “enterprise” Indie calendar provider.</p>
<figure>
<img src="images/05-calendars/first_world_problem_meme.jpg" alt="" /><figcaption>Struggle is real </figcaption>
</figure>
<h1 id="configure-bash">Configure BASH</h1>
<p>This chapter is dedicated to various Bash configuration options. When Bash starts as interactive shell, the following configuration files are read:</p>
<ol type="1">
<li>/etc/profile</li>
<li>~/.bash_profile</li>
<li>~/.bash_login</li>
<li>~/.profile</li>
<li>~/.bashrc</li>
<li>~/.bash_logout</li>
<li>/etc/bash.bash_logout</li>
</ol>
<p>To keep things simple (KISS principle), most Linux users put their configuration into just one file - ‘~/.bashrc’.</p>
<h2 id="change-your-prompt">Change Your prompt</h2>
<p>Default <code>bash.rc</code> configuration that the user gets by default (at least in most of the distributions) is located in <code>/etc/skel/.bashrc</code> (the content of /etc/skel is copied to the home directory during user creation). In many cases, this <code>.bashrc</code> reads <code>/etc/bashrc</code> that sets the PS1 environmental variable to something like <code>PS1="[\u@\h \W]\\$ "</code></p>
<p>This prompt translates to <code>[USER@HOST WORKING_DIRECTORY]$</code>. This is a reasonable default configuration for a prompt, that might be enough. However, if you want a colourful, more customized prompt, you can use one of the websites that help you build one (they are amazing and handy). Alternatively, read the PROMPTING section in <code>man bash</code>, and make your own.</p>
<p>My favourite website to make a custom prompt is http://ezprompt.net/ . You can generate your nice colourful, customised prompt there, then copy it to your <code>~/.bashrc</code>. If this is not enough, you can read about setting up a prompt, how to enable a particular color on text, then make something even more suited to your tastes. This might be particularly useful when your terminal supports True Colour (16 million colours in the terminal instead of 256). There is excellent GitHub gist describing it. It is the first result in the DuckDuckGo search engine (that search engine does not personalise output, so it’s much more reliable than Google). The query that I used is “terminal true colour support”. In the case that this little recommendation doesn’t convince you, here is the link - https://gist.github.com/XVilka/8346728 .</p>
<h2 id="executing-the-chosen-commands-before-the-prompt.">Executing the chosen commands before the prompt.</h2>
<p>Bash has a special variable <code>PROMPT_COMMAND</code>. According to the Bash documentation:</p>
<pre><code>If set, the value is executed as a command before issuing each primary prompt</code></pre>
<p>Example:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ export PROMPT_COMMAND=<span class="st">&#39;date +%F-%T |tr -d &quot;\n&quot;&#39;</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="ex">2018-08-20-22</span>:58:22[Alex@SpaceShip ~]$ <span class="co"># Enter</span></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="ex">2018-08-20-22</span>:58:23[Alex@SpaceShip ~]$ <span class="co"># Enter </span></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="ex">2018-08-20-22</span>:58:26[Alex@SpaceShip ~]$ <span class="co"># Enter</span></span></code></pre></div>
<h3 id="is-this-out-of-season-aprils-fool-joke">Is this out-of-season April’s Fool Joke?</h3>
<p>Because literally no one knows about the <code>PROMPT_COMMAND</code>, you can make a little out of season April fool joke. It’s gonna be definitely better than the Diablo Immortal announcement.</p>
<p>For your safety remember if your colleague tries to kill you after doing that, just say</p>
<pre><code>IT&#39;S A PRANK
IT&#39;S JUST A PRANK BRO 
 -- Anonymous before getting shot.</code></pre>
<p>Ok so let’s get to the code</p>
<pre><code>export PROMPT_COMMAND=&#39;python -c &quot;import random; import time; time.sleep(random.random()*5)&quot;&#39;</code></pre>
<p>Python random.random() will return value [0, 1) (uniform distribution). So, in the worst case scenario, you have to wait 5 seconds for your prompt :). Another thing worth pointing out is that this command works with both Python 2 and 3.</p>
<p>Now you can add it to /etc/.bashrc.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1"></a><span class="bu">echo</span> <span class="st">&quot;export PROMPT_COMMAND=&#39;python -c </span><span class="dt">\&quot;</span><span class="st">import random; import time; time.sleep(random.random()*5)</span><span class="dt">\&quot;</span><span class="st">&#39;&quot;</span> <span class="kw">|</span> <span class="fu">sudo</span> tee -a /etc/bashrc</span></code></pre></div>
<p>Note that, as according to the documentation PROMPT_COMMAND is invoked only for the interactive session. It might be an <strong>IDIOTIC</strong> joke (production, critical, non-standard configured hosts, services that start in an interactive session [you shouldn’t do that anyway], etc).</p>
<h2 id="are-clear-and-ctrl-l-the-same">Are Clear and <code>ctrl</code> + <code>l</code> the same?</h2>
<p>The last thing that I would like to show about the <code>PROMPT_COMMAND</code> is, that there is a difference between <code>clear</code> and <code>ctrl</code> + <code>l</code>. You can export our “prank code”, and check that after the <code>clear</code> command you have to wait for your prompt, but when you use <code>ctrl</code> + <code>l</code>, you get the same cleared screen without waiting. It’s because after <code>ctrl</code>+<code>l</code>, the <code>PROMPT_COMMAND</code> is not invoked.</p>
<h2 id="making-your-own-command-line-shortcut">Making your own command line shortcut</h2>
<p>As you know from the previous chapters, the library responsible for binding shortcuts is GNU Readline. This excellent library allows us to make our own shortcuts with the <code>bind</code> command.</p>
<p>However, before you bind the key to a custom command, you should know the real key code that is sent to the terminal. In the case of <code>ctrl-v</code> the codes are obvious, but what about special keys? For example the <code>F9</code> key is encoded as <code>^[[20~</code>. How do I know that? I used the following combination: <code>ctrl-v</code>, then <code>F9</code>. To get information about what function is bound to <code>ctrl</code> + <code>v</code>, invoke:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ bind -P <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&#39;\C-v&#39;</span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="ex">display-shell-version</span> can be found on <span class="st">&quot;\C-x\C-v&quot;</span>.</span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="ex">quoted-insert</span> can be found on <span class="st">&quot;\C-q&quot;</span>, <span class="st">&quot;\C-v&quot;</span>, <span class="st">&quot;\e[2~&quot;</span>.</span></code></pre></div>
<p>From the following output, it’s obvious that <code>ctrl</code>+<code>v</code> invokes quoted-insert. Quoted-insert is the mode in which the next key combination is displayed in verbatim (key code).</p>
<p>After this short off topic, you can make your own shortcut.In the following example, we bind the <code>F9</code> key with the <code>date</code> command.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ <span class="co"># ^[[20~ - F9 found in quoted mode</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ bind <span class="st">&#39;&quot;\e[20~&quot;:&quot;date\n&quot;&#39;</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ date <span class="co"># F9</span></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="ex">Sun</span> Sep 23 13:43:21 CEST 2018</span></code></pre></div>
<p>The <code>bind</code> command has the following format <code>bind '"Key/s-code/s":"string that will be inserted"'</code>. Note that there is <code>\n</code> after <code>date</code>, so <code>date</code> the command is instantly executed. Another thing that is worth mentioning (we will discuss it later) is that there is a “translation” from <code>^[</code> to <code>\e</code>.</p>
<p>Another example will be <code>ctrl</code> + <code>q</code> bound to <code>date</code> and <code>whoami</code> commands. Some readers might notice that by default <code>ctrl</code> + <code>q</code> it redundantly bound to <code>quoted-insert</code>.</p>
<pre><code>[Alex@SpaceShip BashBushido]$ # ^Q - ctrl-q found in quoted-insert
[Alex@SpaceShip BashBushido]$ bind &#39;&quot;\C-q&quot;:&quot;whoami\n&quot;&#39; # ctrl-q
[Alex@SpaceShip BashBushido]$ whoami
Alex</code></pre>
<p><em>The exercise for reader</em> - does using <code>C-Q</code> instead of <code>C-q</code> change anything? Note that currently our bindings are not persistent, so to “unbind” just start the new terminal/session.</p>
<p>The next example is <code>alt</code>+<code>q</code> that will be bound to the <code>uptime</code> command.</p>
<pre><code>[Alex@SpaceShip BashBushido]$ # ^[q - alt-q found in quoted insert
[Alex@SpaceShip BashBushido]$ bind &#39;&quot;\eq&quot;:&quot;uptime\n&quot;&#39;
[Alex@SpaceShip BashBushido]$ uptime # alt-q
 14:00:52 up  1:38,  4 users,  load average: 0.08, 0.07, 0.21</code></pre>
<p>As previously recognized, the bound command won’t work with the direct output of the quoted mode (for example “^[q”). We have to make a little change to the quoted mode format or the output will not be understandable for readline library. For example <code>atl</code>+<code>q</code> verbatim is <code>^[q</code> that was changed into readline-understandable <code>\eq</code>. The following table shows the simple rules of conversion/translation from one notation to another.</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Notation</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>\e</code></td>
<td>The escape key. Used also for another binding such as special characters (for example, F9) or connected with meta key. Meta key on most keyboards is known as <code>alt</code>. Used when the prefix is <code>^[</code></td>
</tr>
<tr class="even">
<td><code>\C-</code></td>
<td>Represents the held <code>ctrl</code> key. Used when there is <code>^</code> before the key code.</td>
</tr>
</tbody>
</table>
<p><em>Exercise for reader</em> get <code>ESC</code> key in the quoted-insert mode.</p>
<h2 id="make-our-key-bindings-persistent.">Make our key bindings persistent.</h2>
<p>One of the most important lessons that every SysAdmins/DevOps/ConfigManager(WhatEverNameTheyWantToCallThem) has to go through is that to make a configuration and to make a persistent configuration are two separate activities. In the previous chapter, we made a configuration that will work in the interactive shell and will be forgotten/die with it. Now we will make the configuration persistent. There are two fundamental ways to achieve it.</p>
<p>First, and in my opinion the better way is it to put the <code>bind</code> commands in <code>.bashrc</code>. As said before use KISS - Keep It Simple Stupid principle. Keeping everything in a single rc file is good idea.</p>
<p>Below is a fragment that you can write to your <code>.bashrc</code>.</p>
<pre><code>## Custom key bindings.
bind &#39;&quot;\eq&quot;:&quot;uptime\n&quot;&#39;
bind &#39;&quot;\C-q&quot;:&quot;date\nwhoami\n&quot;&#39;
bind &#39;&quot;\e[20~&quot;:&quot;date\n&quot;&#39;</code></pre>
<p>The second one (and by the way more by the book ) - is the use of the configuration file of the readline library (can be overridden with the <code>INPUTRC</code> variable) the <code>$HOME/.inputrc</code> file.</p>
<p>Sample <code>.inputrc</code> file:</p>
<pre><code>&quot;\eq&quot;:&quot;uptime\n&quot;
&quot;\C-q&quot;:&quot;whoami\n&quot;
&quot;\e[20~&quot;:&quot;date\n&quot;</code></pre>
<p>As most of readers will quickly notice, the .inputrc has the same format as arguments passed to the <code>bind</code> command. As there is <code>/etc/bashrc</code> there is also the <code>/etc/inputrc</code> file that is a global start-up file used by the Readline library. The inputrc supports comments (“lines started with #”), conditional settings and including other files. For example, in Enterprise Linux distributions (ver 7) the <code>/etc/inputrc</code> has conditional statements like</p>
<pre><code>$if mode=emacs
# for linux console and RH/Debian xterm
&quot;\e[1~&quot;: beginning-of-line
&quot;\e[4~&quot;: end-of-line
...
...
$endif</code></pre>
<p>More information about inputrc and readline library can be found in the <code>man bash</code> - <code>readline</code> section and the info pages <code>pinfo rluserman</code>.</p>
<p>I would like to notice that there is also an important difference between putting custom bindings into the <code>.bashrc</code> and the <code>.inputrc</code> files. This difference is scope. The bindings from <code>.bashrc</code> works only for the Bash shell, when the biddings from <code>.inputrc</code> are used by <strong>any</strong> programs that use readline library to get the user input. These programs are mostly interactive shells like <code>python</code>, <code>perl</code> or <code>psql</code>. That is the second reason why I highly recommend putting the bindings into the <code>.bashrc</code> file.</p>
<h2 id="meta-esc-a-useless-but-interesting-thing.">Meta == ESC a useless but interesting thing.</h2>
<p>In the previous chapter, I challenged the reader to find how the <code>Escape</code> key is encoded.</p>
<pre><code>[Alex@SpaceShip BashBushido]$ # ^[ - escape
[Alex@SpaceShip BashBushido]$ # ^[q - atl+q</code></pre>
<p>With the previous <code>bind '"\eq":"uptime\n"'</code>, there is a possibility to invoke this binding with the following combination <code>esc</code> then <code>q</code>. But there a is huge distinction between the <code>alt</code>+<code>q</code> and the <code>Esc</code> then <code>q</code> combination. Escape will put the <code>^[</code> character only once. So, keeping the <code>Esc</code>+<code>q</code> pressed will write <code>uptime\n</code> once, then continue to put the <code>q</code> on your command line. While <code>alt</code>+<code>q</code> will repeatedly write <code>uptime\n</code> as long as the keys are pressed.</p>
<h2 id="change-directory-to-the-previous-one.">Change directory to the previous one.</h2>
<p>To change directory to the previous one just use <code>cd -</code></p>
<p>This trick works because Bash has the OLDPWD variable set by <code>cd</code>. How can we be sure about that? Well, this time we won’t look into the source code :). Just start a new session and try to use this trick.</p>
<pre><code>[Alex@SpaceShip BashBushido]$ bash
[Alex@SpaceShip BashBushido]$ cd -
bash: cd: OLDPWD not set</code></pre>
<p>You can read more about it in the manual. I highly recommend also checking what <code>cd</code> is really in your shell. Just invoke <code>which cd</code> then <code>type cd</code>. Depending on your Bash version there might be the <code>/usr/bin/cd</code>. But when you try to invoke it it doesn’t work as expected.</p>
<p>Look at the following example:</p>
<pre><code>[Alex@SpaceStation ~]$ pwd
/home/Alex
[Alex@SpaceStation ~]$ /usr/bin/cd /home  # it won&#39;t work
[Alex@SpaceStation ~]$ pwd  # RLY
/home/Alex
[Alex@SpaceStation ~]$ cd /home/
[Alex@SpaceStation home]$ rpm -qf /usr/bin/cd # check which package own the file
bash-4.2.46-31.el7.x86_64
[Alex@SpaceStation home]$ file /usr/bin/cd
/usr/bin/cd: POSIX shell script, ASCII text executable
[Alex@SpaceStation home]$ cat /usr/bin/cd
#!/bin/sh
builtin cd &quot;$@&quot;
[Alex@SpaceStation home]$ builtin cd /home/Alex # builtin work as expected
[Alex@SpaceStation ~]$ pwd
/home/Alex</code></pre>
<p>Can you indicate why this didn’t work?</p>
<figure>
<img src="images/06-configure-bash/spongebob_magic.jpg" alt="" /><figcaption>Maybe because you started another process? </figcaption>
</figure>
<h2 id="pushd-and-popd-friends-of-mine">Pushd and popd friends of mine</h2>
<p>A short story of everyday console user: You are making changes in one directory, then cd to another, then once more to another, then to another. Then you would like to go “back” to the previous one. So, you use <code>cd -</code>, but then you cannot go any further. Your directory “browsing” history is like, well - a single directory. What is even more embarrassing is the fact that in most cases it’s enough - maybe being a Linux power user is not as hard as most people tend to believe ;)?</p>
<p>Nevertheless, there is nice a solution to this situation, the <code>popd</code> and <code>pushd</code> commands. There is also a third command, one called <code>dirs</code>. The <code>pushd</code> changes directory and pushes it to the directory stack, popd pop the directory from the stack and change the directory to the poped value (ofc as long as the stack is not empty). The <code>dirs</code> command prints the current directory stack. The sample usage looks like this.</p>
<pre><code>[Alex@garrus ~]$ pushd /usr/share/
/usr/share ~
[Alex@garrus share]$ dirs
/usr/share ~
[Alex@garrus share]$ pushd ~/workspace/
~/workspace /usr/share ~
[Alex@garrus workspace]$ pushd /etc/sysconfig/
/etc/sysconfig ~/workspace /usr/share ~
[Alex@garrus sysconfig]$ dirs
/etc/sysconfig ~/workspace /usr/share ~
[Alex@garrus sysconfig]$ popd
~/workspace /usr/share ~
[Alex@garrus workspace]$ popd
/usr/share ~
[Alex@garrus share]$ popd
~
[Alex@garrus ~]$ popd
-bash: popd: directory stack empty</code></pre>
<p>However, this is BashBushido - we can do it a little bit better and maybe smarter :)! I enjoyed switching from <code>cd</code> to something that better suits me -&gt; pushd with popd.</p>
<p>To do so, I added the following to my .bashrc. I would like to note that this solution is loosely based on “Jonathan M Davis” Unix and Linux Stack Exchange https://unix.stackexchange.com/a/4291/183070</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1"></a><span class="bu">alias</span> cd=<span class="st">&#39;pushd&#39;</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="bu">alias</span> back=<span class="st">&#39;popd&#39;</span></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="fu">popd()</span></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="kw">{</span></span>
<span id="cb51-5"><a href="#cb51-5"></a>  <span class="bu">builtin</span> popd <span class="op">&gt;</span> /dev/null</span>
<span id="cb51-6"><a href="#cb51-6"></a><span class="kw">}</span></span>
<span id="cb51-7"><a href="#cb51-7"></a><span class="fu">pushd()</span></span>
<span id="cb51-8"><a href="#cb51-8"></a><span class="kw">{</span></span>
<span id="cb51-9"><a href="#cb51-9"></a>  <span class="kw">if</span><span class="bu"> [</span> <span class="va">$#</span> <span class="ot">-eq</span> 0<span class="bu"> ]</span>; <span class="kw">then</span></span>
<span id="cb51-10"><a href="#cb51-10"></a>    <span class="bu">builtin</span> pushd <span class="st">&quot;</span><span class="va">${HOME}</span><span class="st">&quot;</span> <span class="op">&gt;</span> /dev/null</span>
<span id="cb51-11"><a href="#cb51-11"></a>  <span class="kw">elif</span><span class="bu"> [</span> <span class="va">$1</span> <span class="ot">==</span> <span class="st">&quot;-&quot;</span><span class="bu"> ]</span>; <span class="kw">then</span></span>
<span id="cb51-12"><a href="#cb51-12"></a>      <span class="bu">builtin</span> popd <span class="op">&gt;</span> /dev/null</span>
<span id="cb51-13"><a href="#cb51-13"></a>  <span class="kw">else</span></span>
<span id="cb51-14"><a href="#cb51-14"></a>    <span class="bu">builtin</span> pushd <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span> <span class="op">&gt;</span> /dev/null</span>
<span id="cb51-15"><a href="#cb51-15"></a>  <span class="kw">fi</span></span>
<span id="cb51-16"><a href="#cb51-16"></a><span class="kw">}</span></span></code></pre></div>
<p>Please note that this solution works well with the default workflow of most Linux users. There is no need to switch the from well-known (even automatic) <code>cd</code> to <code>pushd</code>.</p>
<pre><code>[Alex@garrus ~]$ cd /usr/share/
[Alex@garrus share]$ dirs
/usr/share ~
[Alex@garrus share]$ cd ~/workspace/
[Alex@garrus workspace]$ cd /etc/sysconfig/
[Alex@garrus sysconfig]$ dirs
/etc/sysconfig ~/workspace /usr/share ~
[Alex@garrus sysconfig]$ back
[Alex@garrus workspace]$ dirs
~/workspace /usr/share ~
[Alex@garrus workspace]$ cd -
[Alex@garrus share]$ dirs
/usr/share ~
[Alex@garrus share]$ popd 
[Alex@garrus ~]$ dirs
~
[Alex@garrus ~]$ cd -
-bash: popd: directory stack empty
[Alex@garrus ~]$</code></pre>
<p>Another nice thing about this solution is that it works as expected with both <code>cd -</code> and empty <code>cd</code> :).</p>
<p>The pushd and popd can also be used in scripts. I personally used them when:</p>
<ol type="1">
<li>You have to change the specific directory (that is unknown before running, so it can’t be hardcoded).</li>
<li>Saving some information (in the most cases path) that is <strong>relative</strong> to this directory.</li>
<li>Use Popd and/or pushd directory to another.</li>
<li>Reconstruct the <strong>relative</strong> information, then popd.</li>
</ol>
<p>It might look like an overkill but sometimes it’s the simplest solution. In my case, the other solutions used a try-and-error method to reconstruct the data placement.</p>
<h2 id="shopts-and-autocd">shopts and autocd</h2>
<p><code>shopt</code> - is a little shell built-in that can enable some additional shell behaviour. To get a list of options that it can enable, invoke <code>shopt</code> without any argument. One of my favourite options that I used to turn on is <code>autocd</code>. If the first argument (normally the command) is a directory, Bash invokes <code>cd</code> that changes our location to it.</p>
<p>To get what I’m talking about look at the following example:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1"></a>[<span class="ex">Alex@Normandy</span>: BashBushido]$ shopt -s autocd</span>
<span id="cb53-2"><a href="#cb53-2"></a>[<span class="ex">Alex@Normandy</span>: BashBushido]$ /home</span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="bu">cd</span> /home</span>
<span id="cb53-4"><a href="#cb53-4"></a>[<span class="ex">Alex@Normandy</span>: home]$ /home/Alex</span>
<span id="cb53-5"><a href="#cb53-5"></a><span class="bu">cd</span> /home/Alex</span>
<span id="cb53-6"><a href="#cb53-6"></a>[<span class="ex">Alex@Normandy</span>: ~]$ echo <span class="va">$OLDPWD</span></span>
<span id="cb53-7"><a href="#cb53-7"></a><span class="ex">/home</span></span>
<span id="cb53-8"><a href="#cb53-8"></a>[<span class="ex">Alex@Normandy</span>: ~]$ shopt -u autocd</span>
<span id="cb53-9"><a href="#cb53-9"></a>[<span class="ex">Alex@Normandy</span>: ~]$ /home</span>
<span id="cb53-10"><a href="#cb53-10"></a><span class="ex">bash</span>: /home: Is a directory</span></code></pre></div>
<p>As you can deduce <code>shopt -s autocd</code> enables (sets) and <code>shopt -u</code> disables (unsets) the option. The minor inconvenience is that the directory changed this way won’t use our aliased <code>cd</code> command that leverage the <code>pushd</code> and <code>popd</code> (described in the previous chapter). This is the reason why I decided not to use it anymore. On the other hand, it correctly set the <code>OLDPWD</code> variable, what, as said before, is enough for most users.</p>
<h2 id="bashrc-generator">bashrc generator</h2>
<p>Because I can and had some free time, I decided to make a simple GitHub website that allows you to generate the .bashrc with options presented through this chapter and many more! You can find it here: <a href="https://alexbaranowski.github.io/bash-rc-generator/">https://alexbaranowski.github.io/bash-rc-generator/</a></p>
<h1 id="bash-history">Bash History</h1>
<p>Fortunately, we will not concern ourselves with hard to tell, morally ambiguous, and incarnate humans/nations histories. We will talk about the GNU History library that saves and manages the previously typed lines. The chapter will focus on controlling the history behaviour through environment variables, practical tricks and mostly unknown usage. In theory, the Bash history is just simple files that store the previously invoked commands, but as always there is quite a lot to discover! For example, it can save the timestamps or even be shared between concurrent sessions! After this short introduction - Hey HO, Let’s Go!</p>
<h2 id="where-does-the-history-go">Where does the History go?</h2>
<p>Down the toilet (like most of my education) ^^. As said before, the Bash history (like nearly everything in Unix) is a file. In this case, it’s a simple text file where each line represents one command.</p>
<p>Let’s look at the following examples:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1"></a><span class="ex">Alex@Normandy</span>$ echo <span class="st">&quot;I love rock \</span></span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="st">&gt; and roll&quot;</span></span>
<span id="cb54-3"><a href="#cb54-3"></a><span class="ex">I</span> love rock and roll</span>
<span id="cb54-4"><a href="#cb54-4"></a><span class="ex">Alex@Normandy</span>$ echo I love\</span>
<span id="cb54-5"><a href="#cb54-5"></a><span class="op">&gt;</span>  rock and roll</span>
<span id="cb54-6"><a href="#cb54-6"></a><span class="ex">I</span> love rock and roll</span>
<span id="cb54-7"><a href="#cb54-7"></a><span class="ex">Alex@Normandy</span>$ for i in <span class="dt">{1..3}</span><span class="kw">;</span></span>
<span id="cb54-8"><a href="#cb54-8"></a><span class="op">&gt;</span> <span class="kw">do</span></span>
<span id="cb54-9"><a href="#cb54-9"></a><span class="op">&gt;</span> <span class="bu">echo</span> <span class="va">$i</span></span>
<span id="cb54-10"><a href="#cb54-10"></a><span class="op">&gt;</span> <span class="kw">done</span></span>
<span id="cb54-11"><a href="#cb54-11"></a><span class="ex">1</span></span>
<span id="cb54-12"><a href="#cb54-12"></a><span class="ex">2</span></span>
<span id="cb54-13"><a href="#cb54-13"></a><span class="ex">3</span></span>
<span id="cb54-14"><a href="#cb54-14"></a><span class="ex">Alex@Normandy</span>$ history <span class="kw">|</span> <span class="fu">tail</span> -7</span>
<span id="cb54-15"><a href="#cb54-15"></a><span class="ex">...</span>(some commands)</span>
<span id="cb54-16"><a href="#cb54-16"></a>  <span class="ex">495</span>  echo <span class="st">&quot;I love rock \</span></span>
<span id="cb54-17"><a href="#cb54-17"></a><span class="st">and roll&quot;</span></span>
<span id="cb54-18"><a href="#cb54-18"></a>  <span class="ex">496</span>  echo I love rock and roll</span>
<span id="cb54-19"><a href="#cb54-19"></a>  <span class="ex">497</span>  for i in <span class="dt">{1..3}</span><span class="kw">;</span> <span class="kw">do</span> <span class="bu">echo</span> <span class="va">$i</span><span class="kw">;</span> <span class="kw">done</span></span>
<span id="cb54-20"><a href="#cb54-20"></a>  <span class="ex">498</span>  history <span class="kw">|</span> <span class="fu">tail</span> -7</span></code></pre></div>
<p>As you can see, Bash is quite smart and squash longer “blocks” like loops or long commands that are split with <code>\</code> into a single one.</p>
<p>The file where history is/will be saved is defined by environment variable <code>HISTFILE</code>. <code>HISTFILE</code> has default value set to <code>~/.bash_history</code></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo <span class="va">$HISTFILE</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="ex">/home/Alex/.bash_history</span></span></code></pre></div>
<p>You can change the variable and save history to the new file. Look at the following listening.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ bash <span class="co"># Invoking the second bash</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ export HISTFILE=~/REMOVE_ME_TEST</span>
<span id="cb56-3"><a href="#cb56-3"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo <span class="st">&quot;NEW HISTORY&quot;</span></span>
<span id="cb56-4"><a href="#cb56-4"></a><span class="ex">NEW</span> HISTORY</span>
<span id="cb56-5"><a href="#cb56-5"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ exit <span class="co"># exit the subshell</span></span>
<span id="cb56-6"><a href="#cb56-6"></a><span class="bu">exit</span></span>
<span id="cb56-7"><a href="#cb56-7"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ cat ~/REMOVE_ME_TEST</span>
<span id="cb56-8"><a href="#cb56-8"></a><span class="bu">export</span> <span class="va">HISTFILE=</span>~/REMOVE_ME_TEST</span>
<span id="cb56-9"><a href="#cb56-9"></a><span class="bu">echo</span> <span class="st">&quot;NEW HISTORY&quot;</span></span>
<span id="cb56-10"><a href="#cb56-10"></a><span class="bu">exit</span></span></code></pre></div>
<h2 id="getting-the-10-most-popular-commands.">Getting the 10 most popular commands.</h2>
<p>To get the 10 most frequently used commands you can use the following one-liner.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1"></a><span class="bu">history</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $2}&#39;</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">|</span> <span class="fu">uniq</span> -c <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&quot;s/^[ \t]*//&quot;</span> <span class="kw">|</span> <span class="fu">sort</span> -nr <span class="kw">|</span> <span class="fu">head</span> -10</span></code></pre></div>
<p>For example</p>
<pre><code>[Alex@SpaceShip ~]$ history | awk &#39;{print $2}&#39; | sort | uniq -c | sed &quot;s/^[ \t]*//&quot; | sort -nr | head -10
62 bind
51 ls
47 echo
27 git
26 cd
19 vim
17 history</code></pre>
<p>As you can see, before writing this text, I experimented a lot with the <code>bind</code> command.</p>
<h2 id="lets-erase-our-history">Let’s erase our history!</h2>
<p>There are multiple reasons why one would want to delete the history:</p>
<ul>
<li>History can be not set properly, so, it is storing sensitive data like “export MY_UNIQUE_BANK_PASSWORD=‘MAMA_JUST_KILLED_A_MAN’”.</li>
<li>You just got fired, so, in little exchange you make a little d*** move and delete the history. That makes the new admin’s life a little bit harder. (BTW that is one from a thousand reasons why you should use automation platforms like Puppet, Salt or Ansible. It’s also quite likely that fully a backed up server [like a snapshot] can easily recover this file).</li>
<li>If you are a little freak, you can set HISTFILE to <code>/dev/null</code> and HISTSIZE to 0.</li>
</ul>
<p>You can clear your history with <code>history -c</code>.</p>
<pre><code>[vagrant@localhost ~]$ history
    1  w
    2  df ­h
    3  uname ­a
    ...
    70 history
[vagrant@localhost ~]$ history ­-c
[vagrant@localhost ~]$ history
    1  history
[vagrant@localhost ~]$</code></pre>
<p>It’s worth to mention that after using <code>history -c</code>, the history file is still intact (you might lose the newest part of the history, more about it in the succeeding subparagraphs). It’s because out-of-box history is saved when you end the session.</p>
<p>We can recover <strong>freshly (not removed)</strong> cleared history with <code>history -r</code>.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1"></a>[<span class="ex">root@kojinew</span> ~]# history</span>
<span id="cb60-2"><a href="#cb60-2"></a>    <span class="ex">1</span>  cd /etc/pki/some_service/</span>
<span id="cb60-3"><a href="#cb60-3"></a>    <span class="ex">2</span>  ls</span>
<span id="cb60-4"><a href="#cb60-4"></a>    <span class="ex">3</span>  ./certgen.sh nothing</span>
<span id="cb60-5"><a href="#cb60-5"></a>    <span class="ex">...</span> </span>
<span id="cb60-6"><a href="#cb60-6"></a>    <span class="ex">116</span>  ./certgen.sh </span>
<span id="cb60-7"><a href="#cb60-7"></a>[<span class="ex">root@kojinew</span> ~]# history -c</span>
<span id="cb60-8"><a href="#cb60-8"></a>[<span class="ex">root@kojinew</span> ~]# history -r</span>
<span id="cb60-9"><a href="#cb60-9"></a>[<span class="ex">root@kojinew</span> ~]# history</span>
<span id="cb60-10"><a href="#cb60-10"></a>    <span class="ex">1</span>  history -r</span>
<span id="cb60-11"><a href="#cb60-11"></a>    <span class="co"># ... rest of the history file</span></span></code></pre></div>
<p>Mnemonics:</p>
<ul>
<li><code>history -c</code>lear</li>
<li><code>history -r</code>ead</li>
</ul>
<h2 id="saving-and-sharing-history-in-real-time">Saving and sharing history in real time?</h2>
<p>History lib is excellent, but it might be annoying when working with multiple terminals (sessions) at the same server at once. They share the starting state of history, then overwrite it. What is also even more frustrating is that this sessions don’t share invoked commands as long as our console session doesn’t end (but then each session overwrites the previous one!). So ideally the following criteria should be met.</p>
<ol type="1">
<li>History saves after each command.</li>
<li>History is read after each command.</li>
</ol>
<p>You can achieve it with the previously introduced <code>PROMPT_COMMAND</code>.</p>
<pre><code>shopt -s histappend # Set appending to history
# PROMPT_COMMAND was introduced in prevoius chapter
export PROMPT_COMMAND=&quot;history -a; history -c; history -r; $PROMPT_COMMAND&quot;</code></pre>
<p>History <code>a</code>ppend lines from current session to history file, then <code>c</code>lear it then <code>r</code>ead it.</p>
<p>If you can’t read an important command that was just invoked in another session (terminal), just hit enter with an empty command line. It triggers the PROMPT_COMMAND execution, so that the history resyncs.</p>
<p>The best thing about this solution is also the worst. Imagine that you have separate sessions where you are using quite similar commands. The “collision” with commands from other terminals might be dreadful. Still, it’s one of my favourite bash tricks.</p>
<h2 id="history-with-date-and-time.">History with date and time.</h2>
<p>Bash has another variable called <code>HISTTIMEFORMAT</code>. This variable is responsible for the format in which time that the command execution happened is saved/presented. To start fun with the timed history, set it to something meaningful, then export it.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1"></a><span class="bu">export</span> <span class="va">HISTTIMEFORMAT=</span><span class="st">&quot;%Y-%m-%d %T &quot;</span></span></code></pre></div>
<p>Please note that there is a space after <code>%T</code>. Without it, the commands blend with time. Another thing that is worth noting is that the old history entries (not presented in the current session) are timestamped to the moment when the current session started.</p>
<p>Look at following example:</p>
<pre><code>[root@localhost ~]# su - test_user
Last login: Sun Oct  7 18:32:02 UTC 2018 on pts/0
[test_user@localhost ~]$ export HISTTIMEFORMAT=&quot;%Y-%m-%d %T &quot;
[test_user@localhost ~]$ echo &#39;export HISTTIMEFORMAT=&quot;%Y-%m-%d %T &quot;&#39; &gt;&gt; .bashrc
[test_user@localhost ~]$ history
    1  2018-10-07 18:32:21 echo &quot;this is test&quot;
    2  2018-10-07 18:32:21 echo &quot;This commands are from previous session/s&quot;
    3  2018-10-07 18:32:34 export HISTTIMEFORMAT=&quot;%Y-%m-%d %T &quot;
    4  2018-10-07 18:32:41 echo &#39;export HISTTIMEFORMAT=&quot;%Y-%m-%d %T &quot;&#39; &gt;&gt; .bashrc
    5  2018-10-07 18:32:45 history
[test_user@localhost ~]$ </code></pre>
<p>And here is where things get even more interesting. Analyse this next example:</p>
<pre><code>[test_user@localhost ~]$ logout
[root@localhost ~]# su - test_user
[test_user@localhost ~]$ echo &quot;After logout&quot;
After logout
[test_user@localhost ~]$ history
    1  2018-10-07 18:35:37 echo &quot;this is test&quot;
    2  2018-10-07 18:35:37 echo &quot;This commands are from previous session/s&quot;
    3  2018-10-07 18:32:34 export HISTTIMEFORMAT=&quot;%Y-%m-%d %T &quot;
    4  2018-10-07 18:32:41 echo &#39;export HISTTIMEFORMAT=&quot;%Y-%m-%d %T &quot;&#39; &gt;&gt; .bashrc
    5  2018-10-07 18:32:45 history
    6  2018-10-07 18:35:44 echo &quot;After logout&quot;
    7  2018-10-07 18:35:48 history
[test_user@localhost ~]$ </code></pre>
<p>So, the previous commands (1,2) have a newer date than the latter (3,4)? BUT WHY? THOUSAND QUESTIONS WITHOUT AN ANSWER? So, let’s log out, then look at our history from another perspective.</p>
<pre><code>[test_user@localhost ~]$ logout
[root@localhost ~]# cat /home/test_user/.bash_history 
echo &quot;this is test&quot;
echo &quot;This commands are from previous session/s&quot;
#1538937154
export HISTTIMEFORMAT=&quot;%Y-%m-%d %T &quot;
#1538937161
echo &#39;export HISTTIMEFORMAT=&quot;%Y-%m-%d %T &quot;&#39; &gt;&gt; .bashrc
#1538937165
history
#1538937344
echo &quot;After logout&quot;
#1538937348
history
[root@localhost ~]#</code></pre>
<p>As you can see, there is a special “#NUMBER”, and this number is a Unix timestamp also called UNIX Epoch time, Unix time or just Epoch. This number represents the number of seconds that passed from 00:00:00 1 January 1970. This is an elegant solution for storing a date with time with 1-second precision. So, the, commands (1,2) have no timestamp; therefore, their execution date and time is set to the start of the shell process.</p>
<h2 id="controlling-what-the-history-should-forget">Controlling what the history should forget</h2>
<p>There is a possibility not to save an executed command. To do so, the space must be the first character. You probably already guessed that there is a particular Bash variable that is responsible for it - and you are right (I love IT because of smart people like YOU!). The <code>HISTCONTROL</code> is the <del>droid</del> variable we are looking for.</p>
<p><code>HISTCONTROL</code> might be set to the following.</p>
<ol type="1">
<li>Not set or set to an invalid value.</li>
<li>ignorespace - lines that begin with a space character are not saved.</li>
<li>ignoredups - ignores lines matching the previous history entry.</li>
<li>erasedups - all previous lines matching the current line are removed from the history.</li>
<li>ignoreboth - ignorespace + ignoredups</li>
</ol>
<p>Which one is the most popular? Well, it’s quite easy to check with the GitHub search.</p>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 10%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="header">
<th>TYPE</th>
<th>NUMBER</th>
<th>GitHub Query Link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ignorespace</td>
<td>8,657</td>
<td>github.com/search?l=Shell&amp;q=HISTCONTROL%3Dignorespace&amp;type=Code</td>
</tr>
<tr class="even">
<td>ignoredups</td>
<td>15.234</td>
<td>github.com/search?l=Shell&amp;q=HISTCONTROL%3Dignoredups&amp;type=Code</td>
</tr>
<tr class="odd">
<td>erasedups</td>
<td>5,745</td>
<td>github.com/search?l=Shell&amp;q=HISTCONTROL%3Derasedups&amp;type=Code</td>
</tr>
<tr class="even">
<td>ignoreboth</td>
<td>29,907</td>
<td>github.com/search?l=Shell&amp;q=HISTCONTROL%3Dignoreboth&amp;type=Code</td>
</tr>
</tbody>
</table>
<p>The ignoreboth is definitely the winner. This phase is more popular than all competitors combined :). Another thing worth mentioning is that because HISTCONTORL is a colon-separated list, there is a possibility to get <code>ignoreboth</code> with <code>ignorespace:ignoredups</code>.</p>
<p>Now, with all this theory, you might want to look at the following example:</p>
<pre><code>[root@localhost ~]# echo &quot;my_new_pass&quot; | passwd --stdin root
Changing password for user root.
passwd: all authentication tokens updated successfully.
[root@localhost ~]#  echo &quot;my_new_pass2&quot; | passwd --stdin root
Changing password for user root.
passwd: all authentication tokens updated successfully.
[root@localhost ~]# history
    1  2018-07-31 11:25:55 echo &quot;my_new_pass&quot; | passwd --stdin root
    2  2018-07-31 11:26:04  echo &quot;my_new_pass2&quot; | passwd --stdin root
    3  2018-07-31 11:26:08 history
[root@localhost ~]# echo &quot;export HISTCONTROL=ignoreboth&quot; &gt;&gt; .bashrc
[root@localhost ~]# . .bashrc
[root@localhost ~]#  echo &quot;my_new_pass3&quot; | passwd --stdin root
Changing password for user root.
passwd: all authentication tokens updated successfully.
[root@localhost ~]# history
    1  2018-07-31 11:25:55 echo &quot;my_new_pass&quot; | passwd --stdin root
    2  2018-07-31 11:26:04  echo &quot;my_new_pass2&quot; | passwd --stdin root
    3  2018-07-31 11:26:08 history
    4  2018-07-31 11:26:36 echo &quot;export HISTCONTROL=ignoreboth&quot; &gt;&gt; .bashrc
    5  2018-07-31 11:26:43 . .bashrc
    6  2018-07-31 11:26:53 history</code></pre>
<p>As the listening shows, the <code>echo "new_pass3" | passwd --stdin root</code> was not saved. Just as expected! Thanks to this, you can safely add secrets, passwords and tokens to commands without thinking about leaking them through the history file.</p>
<h2 id="how-deep-is-your-love-history">How deep is your <del>love</del> history?</h2>
<p>The default history size might not be suitable for heavily used machines (like the desktops). To get more space for the history entries, we can extend it. There are two variables responsible for it. The first one is <code>HISTSIZE</code> and the second is <code>HISTFILESIZE</code>. During my research, I saw at least two discussions where they weren’t properly described. In the same time, the Bash manual describes them unambiguously. The descriptions below are taken from the Bash manual. As always the <code>...</code> is the truncated text.</p>
<pre><code>HISTSIZE 
   The number of commands to remember in the command history...  The default value is 500.
...
HISTFILESIZE
   The maximum number of lines contained in the history file.  When this
   variable is assigned a value, the history file is truncated, if necessary,
   by removing the oldest entries, to contain no more than that number of
   lines.  The default value is 500. The history file is also truncated to
   this size after writing it when an interactive shell exits.</code></pre>
<p>You can set a reasonably long history like <code>1000</code> or even <code>10000</code> entries without noticing the performance issue. There is also a possibility to discard any history with setting <code>HISTSIZE</code> to <code>0</code>. In that case, the history will be empty.</p>
<p>Look at the following example:</p>
<pre><code>[root@localhost ~]# history
    1  ls
...
   15  history
[root@localhost ~]# echo &quot;export HISTSIZE=0&quot; &gt;&gt; .bashrc
[root@localhost ~]# . .bashrc 
[root@localhost ~]# history
[root@localhost ~]# cat ~/.bash_history 
ls
...
history
echo &quot;export HISTSIZE=0&quot; &gt;&gt; .bashrc
. .bashrc 
[root@localhost ~]# logout # After logout the history state is saved
[vagrant@localhost ~]$ sudo -i
[root@localhost ~]# cat .bash_history
[root@localhost ~]# history
[root@localhost ~]# </code></pre>
<p>I prefer both settings to be set to 2000, but there is no real science or any more profound thought behind it. So, part of my <code>~/.bashrc</code> file looks like:</p>
<pre><code>export HISTSIZE=2000
export HISTFILESIZE=2000</code></pre>
<h2 id="ignoring-particular-commands.">Ignoring particular commands.</h2>
<p>Well, imagine that you go through the new code repository. After cloning it, you probably will read the README, go through the directories, list the files, go to another directory, grep on file, then list files, then read some file, then go to another directory, list files, grep on files, read a file, and so on. After something like this, your history is going to be cluttered with multiple <code>cd</code>, <code>ls</code>, <code>cat</code>, and <code>grep</code> commands variances.</p>
<p>To keep the more essential commands in the history file, you can ignore the ones that are popular but don’t tell much. For example, <code>cd</code> or <code>ls</code>. Once more, there is a special Bash variable that allows to do so - <code>HISTIGNORE</code>.</p>
<p>The HISTIGNORE that I’m using looks like:</p>
<pre><code>export HISTIGNORE=&quot;cd*:false:history:htop:ls*:ll*:la:l:popd:pushd*:reset:top:true&quot;</code></pre>
<p>The <code>*</code> makes HISTIGNORE matching everything after the string. Without it, the commands like <code>cd Documents</code> would be saved.</p>
<pre><code>[Alex@SpaceStation ~]$ export HISTIGNORE=&quot;cd&quot;
[Alex@SpaceStation ~]$ cd /tmp
[Alex@SpaceStation tmp]$ history | tail -2
  518  cd /tmp
  519  history | tail -2
[Alex@SpaceStation tmp]$ export HISTIGNORE=&quot;cd*&quot;
[Alex@SpaceStation tmp]$ cd /var
[Alex@SpaceStation var]$ history | tail -2
  520  export HISTIGNORE=&quot;cd*&quot;
  521  history | tail -2</code></pre>
<h3 id="bashrc-generator-1">.bashrc generator</h3>
<p>As mentioned in the previous chapter - you can use the bashrc builder - <a href="https://alexbaranowski.github.io/bash-rc-generator/">https://alexbaranowski.github.io/bash-rc-generator/</a> to build your own bashrc. There is a separate section dedicated to the Bash history settings.</p>
<h1 id="event-designator-word-designator-modifiers.">Event designator, word designator, modifiers.</h1>
<p>This chapter is dedicated to some advanced Bash features. Because the presented material might be somehow overwhelming, the last subchapter contains the most frequent commands.</p>
<h2 id="what-does-mean-in-bash">What does <code>!</code> mean in Bash?</h2>
<p><code>!</code> is a special character for the Bash shell. It’s a mighty Event Designator. The Bash manual explains it as:</p>
<pre><code>An event designator is a reference to a command line entry in the history list.  Unless the reference is absolute, events are relative to the current position in the history list.</code></pre>
<p>So easily speaking, <code>!</code> allow us to reuse the previous commands (stored in the history).</p>
<h2 id="sudo-friends-4-eveer1">sudo + !! = fRiends 4 EVEER!!!1</h2>
<p>The most common usage of <code>!</code> (in many cases without knowing what it is) is invoking it with a second <code>!</code>. <code>!!</code> is a special shortcut that says <code>invoke the last command as it was</code>. It’s most frequently used with a privilege escalation via sudo. Look at the following example.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb73-1"><a href="#cb73-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ cat /etc/gshadow <span class="kw">|</span> <span class="fu">head</span> -1</span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="ex">cat</span>: /etc/gshadow: Permission denied</span>
<span id="cb73-3"><a href="#cb73-3"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ sudo !!</span>
<span id="cb73-4"><a href="#cb73-4"></a><span class="fu">sudo</span> cat /etc/gshadow <span class="kw">|</span> <span class="fu">head</span> -1</span>
<span id="cb73-5"><a href="#cb73-5"></a><span class="ex">root</span>:::</span>
<span id="cb73-6"><a href="#cb73-6"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ </span></code></pre></div>
<p>As said before, this is the most popular event designator usage and one that you can find in nearly every Bash course.</p>
<h2 id="invoking-a-command-by-number-in-the-history.">Invoking a command by number in the history.</h2>
<p>Sometimes, it’s easier to list a subset of commands than to search it interactively. Then you can leverage on event designator by invoking it with <code>![NUBMER]</code>. Look at the following example:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb74-1"><a href="#cb74-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ history <span class="kw">|</span> <span class="fu">grep</span> grep</span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="ex">1</span> grep -v bash /etc/passwd <span class="kw">|</span> <span class="fu">grep</span> -v nologin</span>
<span id="cb74-3"><a href="#cb74-3"></a><span class="ex">2</span> grep -n root /etc/passwd</span>
<span id="cb74-4"><a href="#cb74-4"></a><span class="ex">101</span> grep -c false /etc/passwd</span>
<span id="cb74-5"><a href="#cb74-5"></a><span class="ex">202</span> grep -i ps ~/.bash* <span class="kw">|</span> <span class="fu">grep</span> -v history</span>
<span id="cb74-6"><a href="#cb74-6"></a><span class="ex">404</span> grep nologin /etc/passwd</span>
<span id="cb74-7"><a href="#cb74-7"></a><span class="ex">501</span> history <span class="kw">|</span> <span class="fu">grep</span> grep</span>
<span id="cb74-8"><a href="#cb74-8"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ !404</span>
<span id="cb74-9"><a href="#cb74-9"></a><span class="co"># Will invoke `grep nologin /etc/passwd`</span></span></code></pre></div>
<p>There is also another trick with negative numbers. In multiple programming languages, the negative indexes mean that we are counting indexes from the end instead of from the start. For example, <code>-1</code> means the last element on a list and <code>-3</code> means the third element from the end. The same rule goes with invoking the event designator. Look at the following example:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb75-1"><a href="#cb75-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo In Musk We Trust</span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="ex">In</span> Musk We Trust</span>
<span id="cb75-3"><a href="#cb75-3"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo Mars</span>
<span id="cb75-4"><a href="#cb75-4"></a><span class="ex">Mars</span></span>
<span id="cb75-5"><a href="#cb75-5"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo Earth</span>
<span id="cb75-6"><a href="#cb75-6"></a><span class="ex">Earth</span></span>
<span id="cb75-7"><a href="#cb75-7"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ !-2</span>
<span id="cb75-8"><a href="#cb75-8"></a><span class="bu">echo</span> Mars</span>
<span id="cb75-9"><a href="#cb75-9"></a><span class="ex">Mars</span></span>
<span id="cb75-10"><a href="#cb75-10"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ !-2</span>
<span id="cb75-11"><a href="#cb75-11"></a><span class="bu">echo</span> Earth</span>
<span id="cb75-12"><a href="#cb75-12"></a><span class="ex">Earth</span></span>
<span id="cb75-13"><a href="#cb75-13"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ !-2</span>
<span id="cb75-14"><a href="#cb75-14"></a><span class="bu">echo</span> Mars</span>
<span id="cb75-15"><a href="#cb75-15"></a><span class="ex">Mars</span></span>
<span id="cb75-16"><a href="#cb75-16"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ !-2</span>
<span id="cb75-17"><a href="#cb75-17"></a><span class="bu">echo</span> Earth</span>
<span id="cb75-18"><a href="#cb75-18"></a><span class="ex">Earth</span></span></code></pre></div>
<p>Some of the readers might have already noticed that we can replace <code>!!</code> with <code>!-1</code>.</p>
<h2 id="invoking-a-command-starting-with-a-string.">Invoking a command starting with a string.</h2>
<p>To invoke the last command that <strong>starts</strong> with a given string, use the event designator with a string so that the command looks like <code>!&lt;string&gt;</code>. Example below:</p>
<pre><code>[Alex@SpaceShip cat1]$ whoami
Alex
[Alex@SpaceShip cat1]$ who
Alex :0 2018-04-20 09:37 (:0)
...
[Alex@SpaceShip cat1]$ !who
who
Alex :0 2018-04-20 09:37 (:0)
...
[Alex@SpaceShip cat1]$ !whoa
whoami
Alex</code></pre>
<h2 id="invoking-a-command-containing-the-chosen-string.">Invoking a command containing the chosen string.</h2>
<p><code>!?string?</code> substitutes the most recent command that <strong>contains</strong> a <code>string</code>. Note that which command is the most recent depends on your position in the history. As said before you can always get to the end of history with empty command line or with <code>ctrl</code> + <code>&gt;</code>.</p>
<p>The usage of <code>!string!?</code> is presented by the following example:</p>
<pre><code>[Alex@SpaceShip ~]$ echo Mamma mia
Mamma mia
[Alex@SpaceShip ~]$ echo &quot;, here I go again&quot;
, here I go again
[Alex@SpaceShip ~]$ !?mia?
echo Mamma mia
Mamma mia
[Alex@SpaceShip ~]$ !?go
echo &quot;, here I go again&quot;
, here I go again</code></pre>
<p>Note that you can omit the second <code>?</code> if there are no additional arguments. To get what it means, look at the example below:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb78-1"><a href="#cb78-1"></a><span class="ex">Alex@Normandy</span>$ echo mama mia</span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="ex">mama</span> mia</span>
<span id="cb78-3"><a href="#cb78-3"></a><span class="ex">Alex@Normandy</span>$ !?mama? here I go again</span>
<span id="cb78-4"><a href="#cb78-4"></a><span class="bu">echo</span> mama mia here I go again</span>
<span id="cb78-5"><a href="#cb78-5"></a><span class="ex">mama</span> mia here I go again</span>
<span id="cb78-6"><a href="#cb78-6"></a><span class="ex">Alex@Normandy</span>$ !?mama there are some additional args</span>
<span id="cb78-7"><a href="#cb78-7"></a><span class="ex">bash</span>: !?mama there are some additional args: event not found</span></code></pre></div>
<h2 id="word-designator">Word Designator</h2>
<p>Another huge thing in Bash is the word designator. Once more I decided to cite the part of the Bash manual.</p>
<pre><code>Word  designators are used to select desired words from the event. A : separates the event specification from the word designator.  It may be omitted if the word designator begins with a ^, $, *, -, or %.  Words are numbered from the beginning of the line, with the first word being denoted by 0 (zero). Words are inserted into the current line separated by single spaces.</code></pre>
<p>Of course, the word designator is optional, but the quite exciting thing is the fact that it is also optional when we are using modifiers (we will talk about them later). Before showing some samples, I would like to once more quote part of the bash documentation - this time in a tabular form.</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="header">
<th>Designator</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>0 (zero)</code></td>
<td>The zeroth word. For the shell, this is the command word.</td>
</tr>
<tr class="even">
<td><code>n</code></td>
<td>The nth word.</td>
</tr>
<tr class="odd">
<td><code>^</code></td>
<td>The first argument. That is, word 1.</td>
</tr>
<tr class="even">
<td><code>$</code></td>
<td>The last argument.</td>
</tr>
<tr class="odd">
<td><code>x-y</code></td>
<td>A range of words <strong>-y</strong> abbreviates <strong>\0-y</strong>.</td>
</tr>
<tr class="even">
<td><code>*</code></td>
<td>All of the words but the zeroth. This is a synonym for ** 1-$ **. It is not an error to use * if there is just one word in the event; the empty string is returned in that case.</td>
</tr>
<tr class="odd">
<td>x*</td>
<td>Abbreviates x-$.</td>
</tr>
<tr class="even">
<td>x-</td>
<td>Abbreviates x-$ like x*, but omits the last word.</td>
</tr>
<tr class="odd">
<td>%</td>
<td>The word matched by the most recent <strong>?string?</strong> search.</td>
</tr>
</tbody>
</table>
<p>If a word designator is used without an event number, the last event is used.</p>
<p>The word designator usages are presented with the following examples:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb80-1"><a href="#cb80-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo use printf <span class="kw">`</span><span class="ex">use</span> echo\n<span class="kw">`</span></span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="ex">use</span> printf use echo\n</span>
<span id="cb80-3"><a href="#cb80-3"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ !!:2* <span class="co"># You can also use !:2*</span></span>
<span id="cb80-4"><a href="#cb80-4"></a><span class="bu">printf</span> <span class="kw">`</span><span class="ex">use</span> echo\n<span class="kw">`</span></span>
<span id="cb80-5"><a href="#cb80-5"></a><span class="ex">use</span> echo</span></code></pre></div>
<p>We can put together arguments from multiple events (commands from the history).</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb81-1"><a href="#cb81-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo I love rock <span class="dt">\&#39;</span>n<span class="dt">\&#39;</span> roll  </span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="ex">I</span> love rock <span class="st">&#39;n&#39;</span> roll </span>
<span id="cb81-3"><a href="#cb81-3"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo I love rock <span class="dt">\&#39;</span>n<span class="dt">\&#39;</span> roll </span>
<span id="cb81-4"><a href="#cb81-4"></a><span class="ex">I</span> love rock <span class="st">&#39;n&#39;</span> roll</span>
<span id="cb81-5"><a href="#cb81-5"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo I love rock <span class="dt">\&#39;</span>n<span class="dt">\&#39;</span> roll  </span>
<span id="cb81-6"><a href="#cb81-6"></a><span class="ex">I</span> love rock <span class="st">&#39;n&#39;</span> roll</span>
<span id="cb81-7"><a href="#cb81-7"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo I love rock <span class="dt">\&#39;</span>n<span class="dt">\&#39;</span> roll           </span>
<span id="cb81-8"><a href="#cb81-8"></a><span class="ex">I</span> love rock <span class="st">&#39;n&#39;</span> roll</span>
<span id="cb81-9"><a href="#cb81-9"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo I love rock <span class="dt">\&#39;</span>n<span class="dt">\&#39;</span> roll  </span>
<span id="cb81-10"><a href="#cb81-10"></a><span class="ex">I</span> love rock <span class="st">&#39;n&#39;</span> roll</span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb82-1"><a href="#cb82-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ history <span class="kw">|</span> <span class="fu">tail</span> -6</span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="ex">583</span> echo I love rock <span class="dt">\&#39;</span>n<span class="dt">\&#39;</span> roll</span>
<span id="cb82-3"><a href="#cb82-3"></a><span class="ex">584</span> echo I love rock <span class="dt">\&#39;</span>n<span class="dt">\&#39;</span> roll</span>
<span id="cb82-4"><a href="#cb82-4"></a><span class="ex">585</span> echo I love rock <span class="dt">\&#39;</span>n<span class="dt">\&#39;</span> roll</span>
<span id="cb82-5"><a href="#cb82-5"></a><span class="ex">586</span> echo I love rock <span class="dt">\&#39;</span>n<span class="dt">\&#39;</span> roll</span>
<span id="cb82-6"><a href="#cb82-6"></a><span class="ex">587</span> echo I love rock <span class="dt">\&#39;</span>n<span class="dt">\&#39;</span> roll</span>
<span id="cb82-7"><a href="#cb82-7"></a><span class="ex">588</span> history <span class="kw">|</span> <span class="fu">tail</span> -6</span></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb83-1"><a href="#cb83-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo !583:1 !584:2 !585:3 !586:4 !587:5</span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="ex">I</span> love rock <span class="st">&#39;n&#39;</span> roll</span></code></pre></div>
<p>And also use whole arguments groups from the previous commands.</p>
<pre><code>Alex@SpaceShip ~]$ !583:0-3 !584:4*
echo I love rock \&#39;n\&#39; roll
I love rock &#39;n&#39; roll</code></pre>
<p>Now we can get a <code>!!</code> shortcut in another (third) way.</p>
<pre><code>[Alex@SpaceShip ~]$ yum update
...
You need to be root to perform this command.
[Alex@SpaceShip ~]$ sudo !:0*
sudo yum update
...
No packages marked for update</code></pre>
<h2 id="modifiers---additional-operations-on-word-designators">Modifiers - additional operations on word designator/s</h2>
<p>After optional word designator, we can execute additional operations, getting even more control over the command line, these operations are called modifiers. Each modifier is prefixed a with <code>:</code> (colons).</p>
<p>For the last time in this chapter, I am going to quote the bash manual (I hope that GNU project won’t sue me) in the form of a table.</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="header">
<th>Modifier</th>
<th>do</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>h</td>
<td>Remove a trailing file name component, leaving only the head.</td>
</tr>
<tr class="even">
<td>t</td>
<td>Remove all leading file name components, leaving the tail.</td>
</tr>
<tr class="odd">
<td>r</td>
<td>Remove a trailing suffix of the form .xxx, leaving the basename.</td>
</tr>
<tr class="even">
<td>e</td>
<td>Remove all but the trailing suffix.</td>
</tr>
<tr class="odd">
<td>p</td>
<td>Print the new command but do not execute it.</td>
</tr>
<tr class="even">
<td>q</td>
<td>Quote the substituted words, escaping further substitutions.</td>
</tr>
<tr class="odd">
<td>x</td>
<td>Quote the substituted words as with q, but break into words at blanks and newlines.</td>
</tr>
<tr class="even">
<td>s/old/new/</td>
<td>Substitute new for the first occurrence of old in the event line. Any delimiter can be used in place of /. The final delimiter is optional if it is the last character of the event line. The delimiter may be quoted in old and new with a single backslash. If &amp; appears in new, it is replaced by old. A single backslash will quote the &amp;. If old is null, it is set to the last old substituted, or, if no previous history substitutions took place, the last string in a !?string[?] search.</td>
</tr>
<tr class="odd">
<td>&amp;</td>
<td>Repeat the previous substitution.</td>
</tr>
<tr class="even">
<td>g</td>
<td>Cause changes to be applied over the entire event line. This is used in conjunction with ‘:s’ (e.g., ‘:gs/old/new/’) or ‘:&amp;’. If used with ‘:s’, any delimiter can be used in place of /, and the final delimiter is optional if it is the last character of the event line. And may be used as a synonym for g.</td>
</tr>
<tr class="odd">
<td>G</td>
<td>Apply the following ‘s’ modifier once to each word in the event line.</td>
</tr>
</tbody>
</table>
<p>Yeah, that a lot! When you think about it <code>s</code> is a substitution, and the rest (<code>&amp;gGqx</code>) of them are controls how this substitution is going to behave. Finally, you can imagine the event designator as following structure:</p>
<pre><code>![number,string or !][:word_designator][:modifier_1][:modifier2]...</code></pre>
<p>Modifier can be repeated multiple times. To get different set of words from the word designator you have to write a new event designator.</p>
<p>After this horrible theory, let’s look at some examples:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb87-1"><a href="#cb87-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo aaa bbb /a/b/c/aaa.txt</span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="ex">aaa</span> bbb /a/b/c/aaa.txt</span>
<span id="cb87-3"><a href="#cb87-3"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ !!:s/aaa/bbb <span class="co"># substitutes aaa with bbb once</span></span>
<span id="cb87-4"><a href="#cb87-4"></a><span class="bu">echo</span> bbb bbb /a/b/c/aaa.txt</span>
<span id="cb87-5"><a href="#cb87-5"></a><span class="ex">bbb</span> bbb /a/b/c/aaa.txt</span>
<span id="cb87-6"><a href="#cb87-6"></a></span>
<span id="cb87-7"><a href="#cb87-7"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo aaa bbb /a/b/c/aaa.txt</span>
<span id="cb87-8"><a href="#cb87-8"></a><span class="ex">aaa</span> bbb /a/b/c/aaa.txt</span>
<span id="cb87-9"><a href="#cb87-9"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ !:gs/aaa/bbb <span class="co"># substitutes aaa with bbb multiple times, note that there is default value of event designator (last event) so we can use only one `!`</span></span>
<span id="cb87-10"><a href="#cb87-10"></a><span class="bu">echo</span> bbb bbb /a/b/c/bbb.txt</span>
<span id="cb87-11"><a href="#cb87-11"></a><span class="ex">bbb</span> bbb /a/b/c/bbb.txt</span>
<span id="cb87-12"><a href="#cb87-12"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo aaa bbb /a/b/c/aaa.txt</span>
<span id="cb87-13"><a href="#cb87-13"></a><span class="ex">aaa</span> bbb /a/b/c/aaa.txt</span>
<span id="cb87-14"><a href="#cb87-14"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo !!:e</span>
<span id="cb87-15"><a href="#cb87-15"></a><span class="bu">echo</span> .txt</span>
<span id="cb87-16"><a href="#cb87-16"></a><span class="ex">.txt</span></span>
<span id="cb87-17"><a href="#cb87-17"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo aaa bbb /a/b/c/aaa.txt</span>
<span id="cb87-18"><a href="#cb87-18"></a><span class="ex">aaa</span> bbb /a/b/c/aaa.txt</span>
<span id="cb87-19"><a href="#cb87-19"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ !!:r</span>
<span id="cb87-20"><a href="#cb87-20"></a><span class="bu">echo</span> aaa bbb /a/b/c/aaa</span>
<span id="cb87-21"><a href="#cb87-21"></a><span class="ex">aaa</span> bbb /a/b/c/aaa</span>
<span id="cb87-22"><a href="#cb87-22"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo aaa bbb /a/b/c/aaa.txt</span>
<span id="cb87-23"><a href="#cb87-23"></a><span class="ex">aaa</span> bbb /a/b/c/aaa.txt</span>
<span id="cb87-24"><a href="#cb87-24"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ !!:h</span>
<span id="cb87-25"><a href="#cb87-25"></a><span class="bu">echo</span> aaa bbb /a/b/c</span>
<span id="cb87-26"><a href="#cb87-26"></a><span class="ex">aaa</span> bbb /a/b/c</span></code></pre></div>
<h2 id="fast-substitution-in-the-previous-command.">Fast substitution in the previous command.</h2>
<p>When you make a typo or want to change an argument or any other string in the last invoked command, the following trick might be handy - <code>^old^new^</code> It replaces the <code>old</code> string with the <code>new</code>. You should also know that substitution by default works only on the first match. Look at the following examples:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb88-1"><a href="#cb88-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ dgi google.com <span class="kw">|</span> <span class="fu">grep</span> -oE <span class="st">&quot;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&quot;</span> <span class="kw">|</span> <span class="fu">head</span> -1</span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="ex">bash</span>: dgi: command not found...</span>
<span id="cb88-3"><a href="#cb88-3"></a><span class="ex">Similar</span> command is: <span class="st">&#39;dig&#39;</span></span>
<span id="cb88-4"><a href="#cb88-4"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ ^dgi^dig^</span>
<span id="cb88-5"><a href="#cb88-5"></a><span class="ex">dig</span> google.com <span class="kw">|</span> <span class="fu">grep</span> -oE <span class="st">&quot;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&quot;</span> <span class="kw">|</span> <span class="fu">head</span> -1</span>
<span id="cb88-6"><a href="#cb88-6"></a><span class="ex">172.217.16.46</span></span>
<span id="cb88-7"><a href="#cb88-7"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ grep <span class="st">&quot;net.ipv4.&quot;</span> /etc/sysctl.conf</span>
<span id="cb88-8"><a href="#cb88-8"></a><span class="ex">...</span></span>
<span id="cb88-9"><a href="#cb88-9"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ ^v4^v6 <span class="co"># Note the absence of last ^</span></span>
<span id="cb88-10"><a href="#cb88-10"></a><span class="fu">grep</span> <span class="st">&quot;net.ipv6.&quot;</span> /etc/sysctl.conf</span>
<span id="cb88-11"><a href="#cb88-11"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo <span class="st">&quot;echo printf?\n&quot;</span></span>
<span id="cb88-12"><a href="#cb88-12"></a><span class="bu">echo</span> printf?\n</span>
<span id="cb88-13"><a href="#cb88-13"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo aaa bbb aaa</span>
<span id="cb88-14"><a href="#cb88-14"></a><span class="ex">aaa</span> bbb aaa</span>
<span id="cb88-15"><a href="#cb88-15"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ ^aaa^bbb^ ccc ddd <span class="co"># With new args</span></span>
<span id="cb88-16"><a href="#cb88-16"></a><span class="bu">echo</span> bbb bbb aaa ccc ddd</span>
<span id="cb88-17"><a href="#cb88-17"></a><span class="ex">bbb</span> bbb aaa ccc ddd</span></code></pre></div>
<p>As you might suspect, the <code>^old^new</code> is similar to the usage of the last command with word designator that uses substitution modifier. So finally we can write it as <code>!!:s/old/new/</code> what is equal <code>!-1:s/old/new</code> what is equal <code>!:s/old/new</code>.</p>
<p>To get multiple substitutions, we can add a word modifier.</p>
<pre><code>[Alex@SpaceShip ~]$ echo aaa bbb aaa
aaa bbb aaa
[Alex@SpaceShip ~]$ ^aaa^ccc^:&amp; # With &#39;&amp;&#39; modifier.
echo ccc bbb ccc
ccc bbb ccc</code></pre>
<h2 id="histchars-lets-control-the-history-characters-.">histchars – let’s control the history characters :).</h2>
<p>This trick is connected with both Bash history and word designator. There is a possibility to change the special characters of history by setting the <code>histchars</code> env variable. <code>histchars</code> is one of this special variable that for unknown reason is lowercased.</p>
<p>The histchars has three characters that are:</p>
<ol type="1">
<li>Event designator (history expansion). <code>!</code> is default.</li>
<li>Quick substitution, used only if it is the first character on the command line. <code>^</code> is default.</li>
<li>Comment - It’s crucial to understand that this is a comment for history substitution, not the shell parser - to be honest, it’s quite useless I never saw anyone using it this way.</li>
</ol>
<p>Check these two examples:</p>
<p>Default characters:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb90-1"><a href="#cb90-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo <span class="st">&quot;Bash is great&quot;</span></span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="ex">Bash</span> is great</span>
<span id="cb90-3"><a href="#cb90-3"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ !!</span>
<span id="cb90-4"><a href="#cb90-4"></a><span class="bu">echo</span> <span class="st">&quot;Bash is great&quot;</span></span>
<span id="cb90-5"><a href="#cb90-5"></a><span class="ex">Bash</span> is great</span>
<span id="cb90-6"><a href="#cb90-6"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ ^Bash^Fish</span>
<span id="cb90-7"><a href="#cb90-7"></a><span class="bu">echo</span> <span class="st">&quot;Fish is great&quot;</span></span>
<span id="cb90-8"><a href="#cb90-8"></a><span class="ex">Fish</span> is great</span>
<span id="cb90-9"><a href="#cb90-9"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ <span class="co"># This is a comment</span></span></code></pre></div>
<p>Now with histchars set to <code>+=@</code></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb91-1"><a href="#cb91-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ histchars=<span class="st">&quot;+=@&quot;</span></span>
<span id="cb91-2"><a href="#cb91-2"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo <span class="st">&quot;Bash is great&quot;</span></span>
<span id="cb91-3"><a href="#cb91-3"></a><span class="ex">Bash</span> is great</span>
<span id="cb91-4"><a href="#cb91-4"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ ++</span>
<span id="cb91-5"><a href="#cb91-5"></a><span class="bu">echo</span> <span class="st">&quot;Bash is great&quot;</span></span>
<span id="cb91-6"><a href="#cb91-6"></a><span class="ex">Bash</span> is great</span>
<span id="cb91-7"><a href="#cb91-7"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ =Bash=Fish</span>
<span id="cb91-8"><a href="#cb91-8"></a><span class="bu">echo</span> <span class="st">&quot;Fish is great&quot;</span></span>
<span id="cb91-9"><a href="#cb91-9"></a><span class="ex">Fish</span> is great</span>
<span id="cb91-10"><a href="#cb91-10"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ @ This is comment</span>
<span id="cb91-11"><a href="#cb91-11"></a><span class="ex">bash</span>: @: command not found...</span></code></pre></div>
<h2 id="disable-event-designator.">Disable ! (event designator).</h2>
<p>Imagine that you are writing a fantastic, maybe not as amazing as the one that you are reading, book about Bash. The first thing that you would show might be the famous <code>Hello, world!</code>.</p>
<p>In the case of Bash, you will think probably about something like: <code>echo "Hello World!"</code> After reading this chapter, you probably already know the output.</p>
<pre><code>[Alex@SpaceShip ~]$ echo &quot;Hello, world!&quot;
bash: !&quot;: event not found</code></pre>
<p>The solution is simple - use <code>'</code> instead of <code>"</code>. However, there are at least two other solutions.</p>
<p>First one is set <code>histchars</code> to nothing.</p>
<pre><code>[Alex@SpaceShip ~]$ histchars=
[Alex@SpaceShip ~]$ echo &quot;Hello, world!&quot;
Hello, world!</code></pre>
<p>There is another workaround/nasty hack/possibility. You can disable history expansion with: <code>set +o histexpand</code>.</p>
<pre><code>[Alex@SpaceShip ~]$ set +o histexpand
[Alex@SpaceShip ~]$ echo &quot;Hello, world!&quot;
Hello, world!
[Alex@SpaceShip ~]$ set -o histexpand
[Alex@SpaceShip ~]$ echo &quot;Hello, world!&quot;
bash: !&quot;: event not found</code></pre>
<h2 id="so-what-is-really-useful">So, what is really useful?</h2>
<p>It depends. In my opinion, most of this chapter might be treated as a mental exercise, that I describe because it’s a cool feature that many experienced Bash users don’t know about. It’s obvious that in times of advanced terminal emulators, with support for the mouse (the middle button for copy and paste) and normal copying and pasting, the most of these tricks (especially modifiers) are not as useful as they used to be. So, to sum up, I decided to put the most frequently used commands/tricks:</p>
<ul>
<li><code>sudo !!</code></li>
<li><code>^old^new^</code></li>
<li><code>![number]</code> and <code>!-[number]</code></li>
<li><code>!string</code> - Invoking a command starting with the string</li>
<li>`!?string? - Invoking a command containing the string</li>
</ul>
<h1 id="aliases">Aliases</h1>
<p>Alias is an alternative name for computer, command, object, user, etc. Let’s imagine that you are Rey from the new Star Wars movies. Your email would be like <code>rey@resitance.org</code>. Moreover, probably it will be aliased as <code>mary.sue@resitance.org</code>, <code>disappointment@resitance.org</code> or something similar. In other words, aliases are assumed names, also known as (<strong>aka</strong> in the Internet slang), or nicknames.</p>
<p>There are thousands of tools that support aliases. In the next chapters, I’m going to present my favourite aliases for the <code>bash</code> and <code>git</code> version control system. Then, together, we will dive a little deeper into aliases in Bash.</p>
<h2 id="bash-aliases">Bash aliases</h2>
<p>The command that is responsible for alias management has quite a surprising name - <code>alias</code>. To print the currently used aliases use:</p>
<pre><code>Alex@Normandy$ alias
alias back=&#39;popd&#39;
(...) # truncated</code></pre>
<p>By the way - bash <code>help</code> states that the <code>-p</code> option is responsible for printing aliases in a reusable format, but there is no real difference between empty <code>alias</code> and <code>alias -p</code>. The only difference that this option makes is when defining the new alias - it also prints all other aliases (with the new one ;)).</p>
<p>To define a new alias, use `alias alias_name=‘command args’.</p>
<p>There are some aliases that I’m using in my very own environment.</p>
<pre><code>alias sudo=&#39;sudo &#39;
alias ..=&#39;cd ..&#39;
alias ...=&#39;cd ../..&#39;
alias ....=&#39;cd ../../..&#39;
alias .....=&#39;cd ../../../..&#39;
alias picnic=&#39;espeak &quot;problem in chair, not in computer&quot;&#39;
alias r=&#39;reset&#39;
alias c=&#39;clear&#39;
alias lh=&#39;ls -AlhF --color=auto&#39;
hash colordiff &amp;&gt; /dev/null &amp;&amp; alias diff=&#39;colordiff&#39;
alias mkdir=&#39;mkdir -pv&#39;
alias now=&#39;date +&quot;%F-%T; %V week&quot;&#39;
alias my_ip=&#39;curl -s ifconfig.co/json | python3 -m json.tool&#39;</code></pre>
<p>The important and interesting alias is <code>alias sudo='sudo '</code>. To get why I’m aliasing sudo let’s look at the following example.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb97-1"><a href="#cb97-1"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ alias ok=<span class="st">&#39;echo OK&#39;</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ sudo ok</span>
<span id="cb97-3"><a href="#cb97-3"></a><span class="ex">sudo</span>: ok: command not found</span>
<span id="cb97-4"><a href="#cb97-4"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ alias sudo=<span class="st">&#39;sudo &#39;</span></span>
<span id="cb97-5"><a href="#cb97-5"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ sudo ok</span>
<span id="cb97-6"><a href="#cb97-6"></a><span class="ex">OK</span></span>
<span id="cb97-7"><a href="#cb97-7"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ </span></code></pre></div>
<p>The reason why aliased sudo works perfectly fine with aliases is described in ALIASES section of the Bash manual.</p>
<pre><code>ALIASES
 ...
 If the last character of the alias value is a blank, then the next command word following the alias is also checked for alias expansion.</code></pre>
<p>Going back to my favourite aliases. The directory aliases are self-explanatory. <code>picnic</code> uses <code>espeak</code> to express my displeasure with some of “URGENT TECHNICAL QUESTIONS” that I have to support. Aliased <code>mkdir</code> is verbose and makes parent directories so that I can make full paths at once. <code>now</code> prints the date with the current week number (I set my personal annual goals, so it’s important). <code>diff</code> set <code>colordiff</code> instead of regular <code>diff</code>. However, before aliasing this one checks if <code>colordiff</code> is installed. Finally, you can read more about <code>my_ip</code> further in the book.</p>
<h2 id="my-favourite-git-aliases">My favourite Git aliases</h2>
<p>Git is the most successful/popular version control system (VCS) currently used. The original author is The Great Linus Torvalds himself. Git is another excellent project made by/for the Linux community that spread like <del>cancer</del> the best open source software. There is plenty of great, free, sources on Git. If you are unfamiliar with this best in the class version control system, you might look at the official free book Pro Git. I bow down to the Authors of this excellent publication.</p>
<p>Git commands might be tedious, but git supports aliases, so instead of long commands, you can type few characters and make some magic. From git 1.5 (really ancient one :)), git supports executing external shell commands in aliases. The command must be prefixed with <code>!</code>.</p>
<p>My aliases <code>from ~/.gitconfig</code></p>
<pre class="config"><code>[alias]
    lol = log --graph --pretty=oneline --decorate --abbrev-commit --all
    ls = log --pretty=format:&quot;%C(yellow)%h%Cred%d\\ %Creset%s%Cblue\\ [%cn]&quot; --decorate
    s = status -bs
    a = add
    b = branch
    c = commit
    ci = commit --interactive
    r = reset
    rv = checkout --
    git-fuckit = !git clean -d -x -f &amp;&amp; git reset --hard
    ohh = !git add -A . &amp;&amp; git commit --amend</code></pre>
<p>The short aliases allow saving some typing. The other are pearls that I found on the Internet - like <code>git-fuckit</code>, others were given by friends, and <code>ohh</code> alias is what I’m saying before swearing :).</p>
<figure>
<img src="images/09-aliases/homeomorphic_endofunctors.jpg" alt="" /><figcaption>Git is easy.</figcaption>
</figure>
<p>However, aliases can also be added from the command line (it’s useful if you have a bootstrap script, that should not override the configuration that already exists). For example, the <code>lol</code> alias can be added with:</p>
<pre><code>git config --global alias.lol &#39;log --graph --pretty=oneline --decorate --abbrev-commit --all&#39;</code></pre>
<p>As said before - if you are unfamiliar with Git, please consult the other sources.</p>
<h2 id="dotfiles">dotfiles</h2>
<p>Many people share their configuration files on GitHub, GitLab or BitBucket. Hackers (ppl who have exceptional software skill) share their config in repositories that are usually named ‘dotfiles’. There is a great site on this topic - https://dotfiles.github.io/ . It’s excellent to start and find the most known configurations for many programs (like <code>emacs</code> or <code>vim</code>) or shells :).</p>
<h2 id="check-what-command-is---type.">Check what command is - type.</h2>
<p>To check what command really is you can use <code>type</code> shell builtin. Type for all possible returned values</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb101-1"><a href="#cb101-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ type type</span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="bu">type</span> is a shell builtin</span>
<span id="cb101-3"><a href="#cb101-3"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ type bash</span>
<span id="cb101-4"><a href="#cb101-4"></a><span class="fu">bash</span> is /usr/bin/bash</span>
<span id="cb101-5"><a href="#cb101-5"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ type case</span>
<span id="cb101-6"><a href="#cb101-6"></a><span class="kw">case</span> is a shell keyword</span>
<span id="cb101-7"><a href="#cb101-7"></a>[Alex@SpaceShip ~]$ type which</span>
<span id="cb101-8"><a href="#cb101-8"></a>which is aliased to <span class="st">&#39;alias | /usr/bin/which --tty-only --read-alias --show-dot --show-tilde&#39;</span></span>
<span id="cb101-9"><a href="#cb101-9"></a>[Alex@SpaceShip ~]$ type command_not_found_handle</span>
<span id="cb101-10"><a href="#cb101-10"></a>command_not_found_handle is a function</span>
<span id="cb101-11"><a href="#cb101-11"></a>command_not_found_handle ()</span>
<span id="cb101-12"><a href="#cb101-12"></a>{</span>
<span id="cb101-13"><a href="#cb101-13"></a>    ...</span>
<span id="cb101-14"><a href="#cb101-14"></a>}</span>
<span id="cb101-15"><a href="#cb101-15"></a>[Alex@SpaceShip ~]$ type asdsadf</span>
<span id="cb101-16"><a href="#cb101-16"></a>bash: type: asdsadf: not found</span></code></pre></div>
<p>The most useful option of <code>type</code> is <code>-t</code> flag that prints only a single word. It’s useful for scripting.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb102-1"><a href="#cb102-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ type -t type</span>
<span id="cb102-2"><a href="#cb102-2"></a><span class="bu">builtin</span></span>
<span id="cb102-3"><a href="#cb102-3"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ type -t bash</span>
<span id="cb102-4"><a href="#cb102-4"></a><span class="fu">file</span></span>
<span id="cb102-5"><a href="#cb102-5"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ type -t case</span>
<span id="cb102-6"><a href="#cb102-6"></a><span class="ex">keyword</span></span>
<span id="cb102-7"><a href="#cb102-7"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ type -t which</span>
<span id="cb102-8"><a href="#cb102-8"></a><span class="bu">alias</span></span>
<span id="cb102-9"><a href="#cb102-9"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ type -t command_not_found_handle</span>
<span id="cb102-10"><a href="#cb102-10"></a><span class="kw">function</span></span>
<span id="cb102-11"><a href="#cb102-11"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ type -t asdfasdf</span>
<span id="cb102-12"><a href="#cb102-12"></a>[<span class="ex">Alex@SpaceShip</span> ~]$</span></code></pre></div>
<h2 id="check-if-the-command-is-aliased.">Check if the command is aliased.</h2>
<p>We have at least 5 way to do it, 4 of them are easy to script, the last one should be already known to an attentive reader.</p>
<ol type="1">
<li>Use <code>type</code> shell built-in</li>
<li>Use <code>which</code>.</li>
<li>Use <code>alias</code> to print all aliases.</li>
<li>Use <code>BASH_ALIASES</code> variable</li>
<li>Use <code>shell-expand-line</code>.</li>
</ol>
<div class="sourceCode" id="cb103"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb103-1"><a href="#cb103-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ alias</span>
<span id="cb103-2"><a href="#cb103-2"></a><span class="bu">alias</span> egrep=<span class="st">&#39;egrep --color=auto&#39;</span></span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="bu">alias</span> fgrep=<span class="st">&#39;fgrep --color=auto&#39;</span></span>
<span id="cb103-4"><a href="#cb103-4"></a><span class="bu">alias</span> grep=<span class="st">&#39;grep --color=auto&#39;</span></span>
<span id="cb103-5"><a href="#cb103-5"></a><span class="bu">alias</span> l.=<span class="st">&#39;ls -d .* --color=auto&#39;</span></span>
<span id="cb103-6"><a href="#cb103-6"></a><span class="bu">alias</span> ll=<span class="st">&#39;ls -l --color=auto&#39;</span></span>
<span id="cb103-7"><a href="#cb103-7"></a><span class="bu">alias</span> ls=<span class="st">&#39;ls --color=auto&#39;</span></span>
<span id="cb103-8"><a href="#cb103-8"></a><span class="bu">alias</span> vi=<span class="st">&#39;vim&#39;</span></span>
<span id="cb103-9"><a href="#cb103-9"></a><span class="bu">alias</span> which=<span class="st">&#39;alias | /usr/bin/which --tty-only --read-alias --show-dot --show-tilde&#39;</span></span>
<span id="cb103-10"><a href="#cb103-10"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ which fgrep</span>
<span id="cb103-11"><a href="#cb103-11"></a><span class="bu">alias</span> fgrep=<span class="st">&#39;fgrep --color=auto&#39;</span></span>
<span id="cb103-12"><a href="#cb103-12"></a>    <span class="ex">/usr/bin/fgrep</span></span>
<span id="cb103-13"><a href="#cb103-13"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo <span class="va">${BASH_ALIASES[fgrep]}</span></span>
<span id="cb103-14"><a href="#cb103-14"></a><span class="fu">fgrep</span> --color=auto</span>
<span id="cb103-15"><a href="#cb103-15"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ type -t fgrep</span>
<span id="cb103-16"><a href="#cb103-16"></a><span class="bu">alias</span></span>
<span id="cb103-17"><a href="#cb103-17"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ fgrep </span>
<span id="cb103-18"><a href="#cb103-18"></a><span class="co"># after hitting shell-expand-line shortcut `ctrl`+`alt`+`e`</span></span>
<span id="cb103-19"><a href="#cb103-19"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ fgrep --color=auto</span></code></pre></div>
<h2 id="invoke-not-aliased-version-of-a-command">Invoke NOT aliased version of a command</h2>
<p>Sometimes, we want to invoke an not aliased version of a command. There are at least two ways of doing that:</p>
<ol type="1">
<li>unalias command, invoke it, then re-alias if desired</li>
<li>use <code>\</code> before a command.</li>
</ol>
<p>Look at following listening:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb104-1"><a href="#cb104-1"></a>[<span class="ex">Alex@SpaceShip</span> eurolinux7]$ ls</span>
<span id="cb104-2"><a href="#cb104-2"></a><span class="ex">Dockerfile</span></span>
<span id="cb104-3"><a href="#cb104-3"></a>[<span class="ex">Alex@SpaceShip</span> eurolinux7]$ alias ls=<span class="st">&#39;echo Hit Me with Your Best Shot&#39;</span></span>
<span id="cb104-4"><a href="#cb104-4"></a>[<span class="ex">Alex@SpaceShip</span> eurolinux7]$ ls</span>
<span id="cb104-5"><a href="#cb104-5"></a><span class="ex">Hit</span> Me with Your Best Shot</span>
<span id="cb104-6"><a href="#cb104-6"></a>[<span class="ex">Alex@SpaceShip</span> eurolinux7]$ \ls</span>
<span id="cb104-7"><a href="#cb104-7"></a><span class="ex">Dockerfile</span></span></code></pre></div>
<h3 id="bashrc-builder">Bashrc builder</h3>
<p>Most of the aliases presented in this chapter can also be found in the previously introduced bashrc generator - https://alexbaranowski.github.io/bash-rc-generator/</p>
<h1 id="top-and-htop">Top and HTOP</h1>
<p>In this chapter, I will introduce the top-rated tools for viewing and monitoring Linux processes. There are many tools that help gather different statistics about the system, processes, hardware, software, etc. However, I decided to present <code>top</code> and <code>htop</code> process viewers/monitors because they combine most of the useful ones in one place. If you are interested in getting more into the processes, how to monitor system with basics tools. I recommend reading more about <code>procps-ng</code> and programs maintained by this project (the top is one of them).</p>
<h2 id="top---top-tier-serious-process-monitor.">top - top tier serious process monitor.</h2>
<p>As said before, the <code>top</code> is one of the most well-known Unix (and Linux) programs. Most Linux distributions use the rewritten and much-improved version of the old Unix top, the project that rewrote these tools with Linux in mind is <code>procps-ng</code>.</p>
<p>It’s quite popular in the free software world to give <code>-ng</code> suffix to the newer (in most cases rewritten or written from scratch) version of well-known and established software.</p>
<p>Even if the old Unix style top is similar, most of the tricks presented in the next chapters won’t work! Below is the image of the top invoked in the FreeBSD system.</p>
<figure>
<img src="images/10-top-htop/bsd_top.png" alt="" /><figcaption>Original top</figcaption>
</figure>
<p>The top itself presents a set of useful statistics about the current system load/health/behaviour and processes running inside of it. However, output and usage of the <code>top</code> program might be a little overwhelming, so I decided that we can together get through it :) one step at the time.</p>
<p>Because <code>procps-ng</code> package (or <code>procps</code> in SUSE family) is part of the <code>core</code> (or <code>minimal</code>) package group, in most (definitely in any reasonable modern distro) cases, it is installed by default. Therefore, the <code>top</code> doesn’t require any extra steps to install.</p>
<h2 id="top-output-step-by-step">Top output step by step</h2>
<p>To invoke the <code>top</code> just type its name, additional arguments are not required.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb105-1"><a href="#cb105-1"></a><span class="ex">top</span></span></code></pre></div>
<p>After invoking the top, you should get something like:</p>
<figure>
<img src="images/10-top-htop/top1.png" alt="" /><figcaption>top process viewer </figcaption>
</figure>
<p>As said earlier, the top might be overwhelming, let me decompose its output:</p>
<figure>
<img src="images/10-top-htop/top_summary_1.png" alt="" /><figcaption>top summary - uptime .</figcaption>
</figure>
<p>On the first line, we have the name with which the top was invoked (you can have multiple top configurations with different top name), then, the current time and uptime (how long the system has been running) are shown.</p>
<p>The following information is the number of “users”. Note that it counts users the same way as other procps-ng commands, so it counts open user sessions (terminals).</p>
<p>Then there is <strong>extremely important statistic</strong> - <strong>load average</strong>. Load average says under what load our system was in the last 1, 5 and 15 minutes. By rule of thumb, the number of load average should be less than CPU (threads) count. Load average says how many processes wait to be run, so its possible values range from 0 to infinity.</p>
<p>There is also an older statistic that is not present in the top,and it’s the CPU utilization. The problem with the CPU utilization is that it’s value is from 0 to CPU or Threads Count. So, it is a bounded function.</p>
<p>Let’s imagine that we have CPU that has 8 cores and disabled HyperThreading or similar technologies. The CPU utilization equal to 8 and the load average corresponding to 8 will result in a system that is still quite responsive, fully loaded but not overloaded. The CPU Utilization equal to 8 and load average equal to 123 will mean that the system is severely overloaded, and it’s hard to make even the simplest administrative operations on it.</p>
<p>The last thing that I would like to note is that the first top line is identical to other procps-ng programs like <code>w</code> and <code>uptime</code>.</p>
<figure>
<img src="images/10-top-htop/top_summary_2.png" alt="" /><figcaption>Top summary task/threads.</figcaption>
</figure>
<p>The next part considers task or threads (depending on mode) that are managed by the Linux Kernel, and their states. It’s quite easy to see that the top doesn’t report all states because of the “total.” the number is not equal to the sum of all others. The reason for it is that not all states that process can be in are listed, for example, the idle process state is not present.</p>
<p>To get all process states that are present in our system, one can use this simple one-liner.</p>
<pre><code>ps ax -o state | sort | uniq
# OR with count
ps ax -o state | sort | uniq -c </code></pre>
<p>One of the most interesting columns here is the one counting <strong>zombie</strong> processes. To simplify - zombies are processes that have finished their run, and they are waiting for <code>wait()</code> from the parent process. It’s uncommon to see them because most programs can adequately deal with their children and in the case of an orphaned process (one whose parent has finished execution before its children), the init system (like systemd) automatically will call wait when adopting them. To sum this up, the multiple conditions must be met for the zombie process to occur.</p>
<figure>
<img src="images/10-top-htop/top_summary_3.png" alt="" /><figcaption>Top summary - states .</figcaption>
</figure>
<p>The next line has info about the CPU States - there are following states:</p>
<ul>
<li>us(er): time running un-niced user processes (most processes)</li>
<li>sy(stem): time running kernel processes</li>
<li>ni(ce): time running niced processes</li>
<li>id(le): time running idle (kernel idle handler)</li>
<li>wa(it for IO): time waiting for I/O</li>
<li>hi[Hardware Interrups] time spent servicing hardware interrupts</li>
<li>si[Software Interrups]: time spent servicing software interrupts</li>
<li>st(olen): time stolen from this VM by the hypervisor</li>
</ul>
<p>In an alternative mode where the CPU report percentage of usage in a graph from. The graph has the following format:</p>
<pre><code>[us+ni]/[sy] [sum of all excluding idle][Graph]</code></pre>
<figure>
<img src="images/10-top-htop/top_summary_4.png" alt="" /><figcaption>Top summary - memory.</figcaption>
</figure>
<p>After Task/Threads statistics, comes the memory usage section. The <strong>free</strong> section says how much memory wasn’t used by the kernel, the <strong>used</strong> says how much memory is really used, the <strong>buff/cache</strong> is responsible for counting memory used by caching mechanism that makes a system faster by miles. The most important statistic is presented in the next line. <strong>avail Mem</strong> shows memory that can be allocated by the kernel (in most cases with reducing buff/cache).</p>
<p>This value doesn’t count the swap space! There is a little <strong>.</strong> before <strong>avail Mem</strong> that tries to separate the information about the swap and continued physical memory statistics. Unfortunately, this might be counterintuitive. Example without any swappable memory in the system that has correctly counted/displayed available memory:</p>
<figure>
<img src="images/10-top-htop/top_summary_4_2.png" alt="" /><figcaption>Top summary - memory.</figcaption>
</figure>
<p>The swappable (sometimes called extended) memory statistics are self-explanatory.</p>
<p>The last part of top <code>top</code> is a called “task area”.</p>
<figure>
<img src="images/10-top-htop/top_summary_5.png" alt="" /><figcaption>Top summary - memory.</figcaption>
</figure>
<p>By default, there are the following columns (fields) in the task area:</p>
<ul>
<li>PID - Process ID</li>
<li>User - The user that owns process.</li>
<li>PR - Priority. There are two types of priorities: Normal (number) and RT (Real Time). If you see RT, it means that the process is in the real-time mode.</li>
<li>NI - Nice Value. Note that in the most cases priority = 20 + NICE. If you are unfamiliar with process niceness, please read <code>man 1 nice</code> and <code>man 2 nice</code>.</li>
<li>VIRT - Virtual Image size. This is the calculated size of memory mapped by the process, memory used by the process, the files that are mapped into itself (shared libs) and memory shared with other processes. The VIRT in many cases is <strong>the most misleading</strong> and therefore useless value.</li>
<li>RES - Resident Memory - the non-swapped physical memory a task is using.</li>
<li>SHR - Shared Memory - the amount of memory that could be potentially shared with other processes</li>
<li>S - process status (Running, Sleeping, Zombie, etc.).</li>
<li>%CPU - The percentage of CPU time that the processes have used. If the process “ate” two cores (threads) of CPU, the 200% will be reported.</li>
<li>%MEM - Used share of the <strong>physical</strong> memory.</li>
<li>TIME+ - CPU Time - total CPU time the task has used since it started. <code>+</code> Means that it’s presented in hundredths of seconds.</li>
<li>COMMAND - Executed command.</li>
</ul>
<h2 id="customizing-the-top">Customizing the TOP</h2>
<p>Before making the customization, I strongly recommend making the top symlink and then invoking <code>top</code> by it.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb108-1"><a href="#cb108-1"></a>$ <span class="fu">sudo</span> ln -s /usr/bin/top /usr/bin/my_top</span>
<span id="cb108-2"><a href="#cb108-2"></a>$ <span class="ex">my_top</span></span></code></pre></div>
<p>Now, the first line of the top will start with <code>my_top -</code>. This is a feature based on the fact that the top, as any program invoked in the Linux, knows its name. The top uses this information to give you the ability to make and maintain multiple configurations.</p>
<p>The first practical thing that I recommend is to change the memory units. The <code>top</code> in opposite to htop doesn’t have intelligent unit scaling, it’s static and uses KiB that are too small to get clean information on most systems. Two keys are responsible for memory scaling - <code>e</code> and <code>E</code>. First, use <code>E</code> to scale what unit is used to display memory in summary area. Then use <code>e</code> to change how the memory is shown in the task area. I personally scale to megabytes or gigabytes (I have never managed a server that had more than 1024 GB of RAM [and I’m not ashamed of it!]).</p>
<p>Now we can commit our first changes. To save the current top settings, use <code>W</code> key. Depending on procps-ng version the top rcfile will be placed in <code>${HOME}/.${NAME}rc</code> or <code>${HOME}/.config/procps/.${NAME}rc</code> in the newer version. In the newer version the legacy path (<code>~/.toprc</code>) is read first, then the one from <code>XDG_CONFIG_HOME</code> variable (by default set to <code>~/.config</code>, XDG_* variables are one defined by X Desktop Group) is used.</p>
<p>The next important setting that I change updates the update interval (time between refreshing the statistics). The default value is 3 seconds. Delay value can be set with <code>d</code> like <strong>d</strong>elay or <code>s</code> like <strong>s</strong>econds to the requested amount. The value that I personally prefer is 5 seconds. But there is a possibility to use absurd values from nearly zero like <code>0.00001</code> (the real-time between refreshing will depend on the host performance; the top will consume 100% [one] CPU) to more than 31536000 (exactly one year). The highest value that I can get is 2147483520.0 (when you add a small number to it the top will still use 2147483520.0, and in case of using more than 2147483583 the <code>top</code> will report <strong>Unacceptable floating point</strong>.). But I believe that it depends on the version, architecture and so on :). BTW 2147483520.0 is over 68 years, so probably more than I will live :).</p>
<p>In the field management interactive menu, that is bound to the <code>f</code> key, you can choose which fields are displayed. Choose a field with up/down arrow, enable them with <code>space</code>, and move them with the right arrow, then up/down and left to put in the desired place with the left arrow. To choose the default sort field use the <code>s</code> key. BTW: The default sort field doesn’t have to be enabled! In field management mode, you can also set the other windows that are available in <code>Alt-display</code> (alternative display mode, with four different windows). To change the currently edited window use the <code>w</code> key. The window that is used in the default mode is named <code>1:Def</code> like DEFault :).</p>
<p>In my case, I enabled the <code>nTH</code> field and <code>USED</code> field then disabled the <code>VIRT</code> field. After it, I sorted the fields in the following manner <code>PID</code>, <code>USER</code>, <code>COMMAND</code>, <code>S</code>, <code>%CPU</code>, <code>nTH</code>, <code>USED</code>, <code>RES</code>, <code>SHR</code>, <code>%MEM</code>, <code>TIME+</code>, <code>NI</code>, <code>PR</code>.</p>
<p>With fields the setup we can exit editing <strong>SINGLE</strong> <code>q</code> (double will exit the top, without saving the configuration!), then use already known <code>W</code> to make the configuration persistent.</p>
<p>When it comes to the fields, I highly recommend not to trust the <code>SWAP</code> field. As said, before the <code>VIRT</code> in many cases might be a <del>little</del> misleading metric. Because the top emulates the <code>SWAP</code> field with a simple formula <code>SWAP=VIRT-RES</code> in most cases, it is plain wrong. You can observe the <code>SWAP</code> field having value greater than 0 on systems that don’t have any swap memory enabled.</p>
<p>The last configuration adjustment that I made is the color change. I know that many IT people (with a noble exception of UI/UX department) is not able to list more than 3 colors, but even if you are one (I’m saying this to myself) that hates to set colors - Don’t Panic! - the top allows using a whole stunning palette of 8 colors! So with little trial and error method you can get satisfying results. Before editing colors, you must enable them with the <code>z</code> key that is a typical toggle.</p>
<p>To invoke color change mode use the <code>Z</code> key. With <code>S</code>,<code>M</code>, <code>H</code>, <code>T</code>, choose the target (part of the top), and then with numbers between 0-7 select the colors. After this operation, use <code>Enter</code> to save current the settings and then <code>W</code> to make them persistent.</p>
<p>In my case, I used <code>S2 M1 H4 T7</code> that in my opinion look acceptable.</p>
<figure>
<img src="images/10-top-htop/my_top_final.png" alt="" /><figcaption>Top summary - memory.</figcaption>
</figure>
<h3 id="sorting-processes.">Sorting processes.</h3>
<p>One of the most essential functionality in the top is the ability to sort the processes by a given filter or measurement.</p>
<p>Two most popular are:</p>
<ul>
<li><code>M</code> - sorts by memory usage - <code>M</code>emory.</li>
<li><code>P</code> - sorts by processor usage (%CPU) - <code>P</code>rocessor.</li>
</ul>
<p>The other filters/sorts include:</p>
<ul>
<li><code>u</code> - Filter on the username - <code>u</code>ser.</li>
<li><code>T</code> - Sort by TIME+ (consumed CPU time) - <code>T</code>ime.</li>
<li><code>N</code> - Sort by PID - <code>N</code>umber.</li>
</ul>
<p>In order to flip the order of sorting (DESC/ASC) use <code>R</code> like <code>R</code>everse :).</p>
<p>The field on which the top will sort can also be chosen in the interactive field management (<code>f</code> or <code>F</code>).</p>
<h2 id="practical-top-usage.">Practical Top usage.</h2>
<p>I will take the first and most important advice straight from the <code>top</code> manual</p>
<pre><code>When  operating  top,  the  two most important keys are a help (’h’ or ’?’) and quit (’q’) key.</code></pre>
<p>So, if anything is unclear, just use the built-in help or read the <code>man 1 top</code>.</p>
<p>Because the top is potent and robust, there is no need/way to memorize all keys and settings. As said before, when in doubt, use the help or the manual. Netherless I’m going to present the most important ones.</p>
<h3 id="sorting-and-filters.">Sorting and filters.</h3>
<ul>
<li><code>P</code> - sort processes by CPU usage - <code>P</code>rocessor.</li>
<li><code>M</code> - sort processes by memory usage - <code>M</code>emory.</li>
<li><code>n</code> - sort by PID - <code>n</code>umber.</li>
<li><code>&lt;</code> and <code>&gt;</code> - change the sort field.</li>
<li><code>u</code> - filter by <code>u</code>sername.</li>
<li><code>R</code> - <code>R</code>everse sort order.</li>
</ul>
<h3 id="useful-top-commands">Useful top commands</h3>
<ul>
<li><code>k</code> - send a signal to a process, in most cases to <code>k</code>ill the process. The default signal is <em>15 SIGTERM</em>, in an act of desperation you can use <em>9 SIGKILL</em> that is more powerful than the default <code>SIGTERM</code>. SIGKILL is signal that cannot be ignored and is practically always fatal. Any valid Linux signal can be used.</li>
<li><code>r</code> - <code>r</code>enice process.</li>
</ul>
<h3 id="alternate-display-mode">Alternate-display mode</h3>
<ul>
<li><code>A</code> - enter/exit alternate-display mode.</li>
<li><code>w</code> or <code>a</code> - change currently managed window.</li>
</ul>
<p>Note that in alternate-display mode each has its own field and color configuration.</p>
<h3 id="summary-area">Summary area</h3>
<ul>
<li><code>1</code>,<code>2,</code>3` - change the way that CPU/S are showed. Note that first and seconds have two submodes.</li>
<li><code>t</code> - change the way the CPU load is showed.</li>
<li><code>m</code> - change the way that memory is showed</li>
<li><code>l</code> - enable/disable the first line.</li>
<li><code>H</code> - toggle between threads and tasks.</li>
</ul>
<h3 id="other-useful-commands">Other useful commands</h3>
<ul>
<li><code>c</code> - enable/disable the absolute command path.</li>
<li><code>g</code> - change the the current window (task area) to another (the naming is not that clear, onc time we talk about windows, other times, it is called a field group and a task areas).</li>
<li><code>V</code> - enable the forest mode. In this mode, the top shows the output in a tree format quite similar to <code>pstree</code> command but within fields of the task area.</li>
</ul>
<p>I highly recommend trying each of the presented keys, modes, and configurations. Then try to find the setting that suits you the most.</p>
<h2 id="htop---top-on-steroids.">htop - top on steroids.</h2>
<p>The name <code>htop</code> came from <code>Hisham top</code> - the first letter is from the name of the program author, but I personally remember it with the HyperTOP mnemonic. <code>htop</code> is a better, easier-to-use, cleaner and more powerful, version of the <code>top</code>. It’s a self-desscriptive and easy-to-discover program. The only drawback of htop is that it is not a part of the proc-ng so:</p>
<ul>
<li>It’s not a part of the minimal installation.</li>
<li>Not all vendors have it in their repositories. So, if you install a third-party package containing the <code>htop</code>, some vendors <strong>might mark your system as unsupportable</strong>, that is well … stupid as f***.</li>
</ul>
<p>To install <code>htop</code> on Enterprise Linux distributions, you need the EPEL repository.</p>
<pre><code>sudo yum install -y epel-release; </code></pre>
<p>The epel-release is a package that sets up EPEL, so it contains repository info, GPG keys and a preset that is used by the systemd. After installing EPEL, the <code>htop</code> can easily be installed with yum.</p>
<pre><code>sudo yum install -y htop</code></pre>
<h3 id="compiling-the-htop">Compiling the htop</h3>
<p>If your vendor is not sane, you can compile the <code>htop</code> and place it into a not standard path, that won’t be gathered by the sosreport or any other system state gathering utility.</p>
<p>Compiling the <code>htop</code> is extremely easy.</p>
<pre><code># Install build dependencies
sudo yum install -y @development git libncursesw ncurses-devel
# Compilation
git clone https://github.com/hishamhm/htop.git
cd htop
./autogen.sh &amp;&amp; ./configure &amp;&amp; make
sudo make install</code></pre>
<p>Note that these commands will install the htop in the default location. In order to install <code>htop</code> in different path, use</p>
<pre><code>./autogen.sh &amp;&amp; ./configure --perfix=/somewhere/over/rainbow &amp;&amp; make</code></pre>
<h3 id="customizing-the-htop">Customizing the htop</h3>
<p>Regarding the installation method, the <code>htop</code> can be invoked, like a top, without any argument. So, to start it, just type <code>htop</code> on the command line.</p>
<p>We can start our customization by looking into help (<code>F1</code> from the bottom menu). In many cases, there is a little problem. The <code>F1</code> key is bound to the terminal emulator itself (in my case the <code>terminator</code>) and invokes the its’ help. What can you do to get to open the <code>htop</code> help? Well, it might sound funny, but try to click F1 button. Yeah, click it with a mouse. Contrary to the prevailing opinion, it is possible to write the console program with support for the mouse. Some ncurses based programs actually support this feature, and <code>htop</code> is one of them. The other options to get built-in help are the well-known top-like <code>?</code> or <code>h</code> keys.</p>
<p>With the help read, we can start the setup of our <code>htop</code>. The configuration file is saved in <code>~/.config/htop/htoprc</code>, and despite the comment of the author, the simpler parser used to read the config made the configuration file human friendly.</p>
<p>The htop with default configuration looks like:</p>
<figure>
<img src="images/10-top-htop/htop_default.png" alt="" /><figcaption>htop default configuration </figcaption>
</figure>
<p>To start the customization, enter the <code>Setup</code> with <code>F2</code> key or click on the <code>Setup</code> with mouse :). The first thing that is worth noting is that the meters section has two columns, and we can freely change the position of all elements. To change the position of an element (meter), select it (or use the mouse ;)), then use <code>Enter</code> to enter the element move or add mode, then use arrows to move it to the chosen place, then hit <code>Enter</code> one more time to commit the change. To change the style of the meter printing (for example, bar chart, text information, or seven-segment display ) use the <code>space</code> key.</p>
<p>The first thing that I’m always doing is removing the CPUs information broken down into individual CPUs. It’s really not practical when working with an 8+ CPUs system (there are some edge cases when it might be useful, for example, if there is a single thread application, but most services [DB, WEB, Network file systems] support multiprocessing and multithreading). To remove this information I choose (CPU 1/2 then CPU 2/2) metric then use the <code>delete</code> key. As nearly always in htop it’s possible to achieve same with the mouse. Next, I add the <strong>CPU Average</strong> metric, and put it on the top of the left column and change the printing style to <strong>Text</strong>.</p>
<p>I make similar changes until my left column has:</p>
<ul>
<li>Load average [Text]</li>
<li>CPU [Text]</li>
<li>Task Counter [Text]</li>
<li>Memory [Text]</li>
<li>Swap [Text]</li>
</ul>
<p>And my right column has:</p>
<ul>
<li>Clock [Text]</li>
<li>Uptime [Text]</li>
<li>Battery [Bar]</li>
</ul>
<p>I use the battery because my basic computer is my notebook. But I’m part of the Glorious PC Gaming Master Race.</p>
<figure>
<img src="images/10-top-htop/meme1.jpg" alt="" /><figcaption>PC MaStEr RaCe </figcaption>
</figure>
<p>Honestly, I have a great gaming setup that I’m not using because of the lack of time. Sometimes I wish one day to become rich and spend like a whole week gaming! Of course, real gamers will consider this amount of time as pathetic.</p>
<p>Back to the main topic - the next section is <strong>Display options</strong>. I have the following enabled:</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
Hide kernel threads - in most scenarios, the kernel threads give only the so-called “data smog”.</li>
<li><input type="checkbox" disabled="" checked="" />
Display threads in a different color</li>
<li><input type="checkbox" disabled="" checked="" />
Highlight program “basename”</li>
<li><input type="checkbox" disabled="" checked="" />
Highlight large numbers in memory counters</li>
<li><input type="checkbox" disabled="" checked="" />
Detailed CPU time (SYSTEM/IO-wait/HARD-IRQ/Soft-IRQ/Steal/Guest)</li>
<li><input type="checkbox" disabled="" checked="" />
Count CPUs from 0 instead of 1 - well most programming languages count from 0.</li>
</ul>
<p>Because in most cases (might depend on your terminal settings), the default colors scheme is excellent, I will skip <strong>Colors</strong> section, especially that <code>htop</code> provides built-in themes so there is no much to set.</p>
<p>The last setup configuration phase is setting up the <strong>Columns</strong>, called Fields in the top, I remove <strong>VIRT (M_SIZE)</strong>, metric and for my setup, this is the end of this phase. There is a little curious that you can add the <strong>OMM</strong> column, that gives Out-of-Memory (OMM) killer score. This might be useful for exceptionally heavily loaded systems.</p>
<p>After the setup use the <code>F10</code> key to save changes.</p>
<p>My <code>htop</code> configurations after changes:</p>
<figure>
<img src="images/10-top-htop/htop_customized.png" alt="" /><figcaption>htop customized </figcaption>
</figure>
<h3 id="searchfiltersort-processes">Search/filter/sort processes</h3>
<p>To search for or filter a process, you can use the <code>F3</code> or <code>F4</code> key. Search will look for a single process that command matches the search string. You can kill, renice or get environment information about the selected (or found) process. The filter will show all processes that match the search string, the example below filters processes that have <code>haroopad</code> in a name. Note that in both cases the search string <strong>is not a regular expression</strong>.</p>
<figure>
<img src="images/10-top-htop/htop_filter.png" alt="" /><figcaption>htop filter example </figcaption>
</figure>
<p>The <code>htop</code> can also search for processes by PID. To do that, just type the PID. The search is incremental. To get what it means - look at the following example:</p>
<p>Imagine that we have the following PIDs:</p>
<ul>
<li>1 - systemd</li>
<li>123 - auditd</li>
<li>12345 - spotify</li>
<li>and there are no processes with PID 12 or 1234.</li>
</ul>
<p>In that case the steps of searching and the results will look like:</p>
<ul>
<li>"" ()<br />
</li>
<li>“1” -&gt; (systemd)<br />
</li>
<li>“12” -&gt; (systemd)<br />
</li>
<li>“123” -&gt; (auditd)<br />
</li>
<li>“1234” -&gt; (auditd)<br />
</li>
<li>“12345” -&gt; (spotify).</li>
</ul>
<p>To sort processes, you can simply use <code>F6</code>, then select a column. As said before, in some terminal emulators, you can also take an advantage of your mouse to click on the column. What is quite obvious, but still worth mentioning, is that sorting might be combined with filters. You can invert the sort order with the <code>I</code> key.</p>
<p>The last type of filters that I would like to demonstrate is filtering by a user - to do so, use the <code>u</code> key then choose the user from the list - it’s much more convenient than having to type the whole username in the <code>top</code>. What is also worth mentioning is that you can type the username and as soon as there is only one match the <code>htop</code> will move the cursor to that user. For example, imagine that you have a user - <code>root</code> and <code>rpc</code>. When <code>r</code> is typed, nothing happens, but when the next letter <code>p</code> is inserted, <code>rpc</code> user will be selected.</p>
<h3 id="top-compatibility-keys-in-htop"><code>top</code> compatibility keys in <code>htop</code></h3>
<ul>
<li><code>M</code> - Sort processes by memory usage.</li>
<li><code>P</code> - Sort processes by CPU usage.</li>
<li><code>T</code> - Sort processes by time consumed by process.</li>
<li><code>k</code> - Sends chosen signal, mostly used to kill a process.</li>
</ul>
<h3 id="other-useful-htop-commands">Other useful htop commands</h3>
<ul>
<li><code>p</code> - <code>p</code>rint absolute command path</li>
<li><code>e</code> - Shows the <code>e</code>nvironment of the selected process.</li>
<li><code>s</code> - Enable <code>s</code>trace mode of the process (requires strace).</li>
<li><code>l</code> - display open files (requires lsof).</li>
<li><code>I</code> - <code>I</code>nvert the sort order.</li>
<li><code>a</code> - Set CPU <code>a</code>ffinity: set which CPUs process can use.</li>
<li><code>i</code> - set IO/Priority (uses ionice).</li>
<li><code>&lt;</code>, <code>&gt;</code>, <code>.</code>, <code>,</code> <code>F6</code> - set the sorting field.</li>
</ul>
<h2 id="summary">Summary</h2>
<p>After reading this chapter, manuals <code>man 1 top</code> and <code>man 1 htop</code>, you should understand not only how to use these programs, but also learn a lot about process-related topics like what is priority or state in which the processes can be. I also highly recommend <code>man 5 proc</code> that provides information about the Linux <code>/proc</code> pseudo-file system.</p>
<h1 id="print-to-console-like-a-hacker-or-a-script-kiddie.">Print to console like a hacker (or a script kiddie).</h1>
<p>In this chapter, we will look into the way of printing the letters, symbols, even some kind of Linux memes. Please note that the knowledge from this chapter is not very helpful when it comes to being a SysAdmin or DevOps.</p>
<figure>
<img src="images/11-hacker-printing/drake_meme.jpg" alt="" /><figcaption>Drake Meme</figcaption>
</figure>
<h2 id="banner">banner</h2>
<p>The banner is a quite old program (so old that its original code is barely readable [sh**load of conditional compilation for computers older than a transistor ;)]), that prints given string in a <strong>gigantic</strong> letters.</p>
<p>Installation on an Enterprise Linux machine (requires EPEL):</p>
<pre><code>sudo yum install -y epel-release
sudo yum install -y banner</code></pre>
<p>In any other distribution, please try to find it with your package manager, in most cases, it’s called <strong>banner</strong> or <strong>sysvbaner</strong>. Die-hard compilation fans can find the sources and easily compile it.</p>
<p>With banner installed, now we can answer the development team lead when he/she/they (gender neutral alphabetical order) asks “Why our application doesn’t work in a production environment?”.</p>
<div class="smaller_font">
<pre><code>[vagrant@localhost ~]$ banner you sucks

#     #  #######  #     #   #####   #     #   #####   #    #   ##### 
 #   #   #     #  #     #  #     #  #     #  #     #  #   #   #     #
  # #    #     #  #     #  #        #     #  #        #  #    #      
   #     #     #  #     #   #####   #     #  #        ###      ##### 
   #     #     #  #     #        #  #     #  #        #  #          #
   #     #     #  #     #  #     #  #     #  #     #  #   #   #     #
   #     #######   #####    #####    #####    #####   #    #   #####  </code></pre>
</div>
<p>Well, that’s like all that the banner can do. This program is dead simple. In the default implementation, there is not much more that you can do. I personally made my own implementation that can be found at the GitHub - https://github.com/AlexBaranowski/Banner.</p>
<p>I’m not very proud of this program, but since I mentioned it, I would like to give you a glimpse how to use it. To compile my version of the banner you can use following commands.</p>
<pre><code>git clone git@github.com:AlexBaranowski/Banner.git
cd Banner
make
sudo make install</code></pre>
<p>After this, there should be <code>/usr/bin/banner</code>, that should also be available with your <code>$PATH</code> environment variable. The general options for my banner are</p>
<ul>
<li>-c [CHAR] change the output character</li>
<li>-s the printing character is the same as a letter</li>
<li>-i reads from stdin</li>
<li>-n ignore options strings after this one</li>
</ul>
<p>I would like to give two examples. The first one with the same printing character as the printed character.</p>
<div class="smaller_font">
<pre><code>Alex@Normandy$ banner -s &quot;I Love U&quot;
IIIII           L                                       U     U 
  I             L                                       U     U 
  I             L        oooo   v     v  eeee           U     U 
  I             L       o    o   v   v  e    e          U     U 
  I             L       o    o   v   v  eeeeee          U     U 
  I             L       o    o    v v   e                U   U  
IIIII           LLLLLL   oooo      v     eeee             UUU   </code></pre>
</div>
<p>Second one is with the custom character set to **<span class="citation" data-cites="*">@*</span>*.</p>
<div class="smaller_font">
<pre><code>Alex@Normandy$ banner -c@ &quot;Kiss&quot;
@    @                          
@   @     @                     
@  @             @@@@    @@@@   
@@@      @@     @       @       
@  @      @      @@@@    @@@@   
@   @     @          @       @  
@    @  @@@@@   @@@@@   @@@@@  </code></pre>
</div>
<p>Once more my personal implementation of the banner is a also simple program, so there is no much more that you can do.</p>
<h2 id="figlet">FIGlet</h2>
<p>Have you ever used torrent? You probably did! You nasty <del>thief</del> <del>broke student</del> freedom fighter! So, you know that there is always a “kick-ass” signature of <del>pirates</del> <del>thieves</del> freedom fighters’ group that can be found in the <code>README.txt</code> file. You can achieve the same effect with FIGlet. The little program that “displays large characters made up of ordinary screen characters”.</p>
<p>Installation on EL machine (requires EPEL):</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb119-1"><a href="#cb119-1"></a><span class="fu">sudo</span> yum install -y epel-release</span>
<span id="cb119-2"><a href="#cb119-2"></a><span class="fu">sudo</span> yum install -y figlet</span></code></pre></div>
<p>Sample FIGlets of “famous” hacker groups.</p>
<div class="smaller_font">
<pre><code>$ figlet &#39;H@Ck01&#39;
 _   _   ____   ____ _     ___  _ 
| | | | / __ \ / ___| | __/ _ \/ |
| |_| |/ / _` | |   | |/ / | | | |
|  _  | | (_| | |___|   &lt;| |_| | |
|_| |_|\ \__,_|\____|_|\_\\___/|_|
        \____/  </code></pre>
</div>
<p>The FIGlet has a built-in support for fonts (<strong>flf</strong> file extension), so we can deeply customize its output. To get the default font names we can query rpm for files instaled from a FIGlet package.</p>
<pre><code>$ rpm -ql figlet | grep flf | sed &#39;s:.*/::&#39; | sed &quot;s/.flf//&quot;
banner
...
term</code></pre>
<p>The following script will print all fonts with a sample output.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb122-1"><a href="#cb122-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb122-2"><a href="#cb122-2"></a><span class="kw">for</span> <span class="ex">i</span> in <span class="va">$(</span><span class="ex">rpm</span> -ql figlet <span class="kw">|</span> <span class="fu">grep</span> flf <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s:.*/::&#39;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&quot;s/.flf//&quot;</span><span class="va">)</span><span class="kw">;</span></span>
<span id="cb122-3"><a href="#cb122-3"></a><span class="kw">do</span></span>
<span id="cb122-4"><a href="#cb122-4"></a>    <span class="ex">figlet</span> -f  <span class="st">&quot;</span><span class="va">$i</span><span class="st">&quot;</span> <span class="st">&quot;font: </span><span class="va">$i</span><span class="st">&quot;</span> <span class="kw">;</span></span>
<span id="cb122-5"><a href="#cb122-5"></a><span class="kw">done</span></span></code></pre></div>
<p>Another option is to use <code>find</code> to find a file instead of listing them with rpm.</p>
<pre><code>FIGLET_DIR=/usr/share/figlet
for i in $(find $FIGLET_DIR -iname &#39;*flf&#39; | sed &#39;s:.*/::&#39; | sed &quot;s/.flf//&quot;);
do
    figlet -f  &quot;$i&quot; &quot;font: $i&quot; ;
done</code></pre>
<p>My favourite font is <code>slant</code>. There is a secret message that I would like to send to all people that supported and bought this book.</p>
<div class="smaller_font">
<pre><code>$ figlet -f slant &#39;thank you &lt;3&#39;
   __  __                __                           __   _____
  / /_/ /_  ____ _____  / /__   __  ______  __  __   / /  |__  /
 / __/ __ \/ __ `/ __ \/ //_/  / / / / __ \/ / / /  / /    /_ &lt; 
/ /_/ / / / /_/ / / / / ,&lt;    / /_/ / /_/ / /_/ /   \ \  ___/ / 
\__/_/ /_/\__,_/_/ /_/_/|_|   \__, /\____/\__,_/     \_\/____/  
                             /____/                            </code></pre>
</div>
<h2 id="cowsay">cowsay</h2>
<p>Another well-known alternative way to print the message in the terminal is <code>cowsay</code>. It uses ASCII-Art cow. Not many Linux users know that there are also symlinked versions like <code>cowthink</code> that is printing a “thinking cow” :). Moreover, <code>cowsay</code> has multiple modes, that we will discuss further.</p>
<p>On Enterprise Linux distributions package cowsay can be installed from the EPEL repository . Installation is as straight forward as:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb125-1"><a href="#cb125-1"></a><span class="fu">sudo</span> yum install -y epel-release</span>
<span id="cb125-2"><a href="#cb125-2"></a><span class="fu">sudo</span> yum install -y cowsay</span></code></pre></div>
<p>Sample cowsays:</p>
<pre><code>Alex@Normandy:~$  cowsay help me!
 __________
&lt; help me! &gt;
 ----------
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||</code></pre>
<p>The first customization is called a mod (or modifier). Depending on the version of cowsay, different modes could be found. In the version that I’m using, there are the following modifiers:</p>
<ul>
<li>-d dead;</li>
<li>-b Borg mode;</li>
<li>-g greedy mode;</li>
<li>-p causes a state of paranoia to come over the cow;</li>
<li>-s makes the cow appear thoroughly stoned;</li>
<li>-t yields a tired cow;</li>
<li>-w is somewhat the opposite of -t, and initiates awired mode;</li>
<li>-y brings on the cow’s youthful appearance.</li>
</ul>
<p>There are also multiple images that can be used instead of a standard cow. They are located in /usr/share/cowsay/ and have “.cow” file extension.</p>
<p>This short script will iterate through all extra cow ASCII pictures and print a message with the name of the used image. <code>-W</code> parameter sets the terminal width to 100 characters.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb127-1"><a href="#cb127-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb127-2"><a href="#cb127-2"></a></span>
<span id="cb127-3"><a href="#cb127-3"></a><span class="kw">for</span> <span class="ex">i</span> in /usr/share/cowsay/*.cow<span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb127-4"><a href="#cb127-4"></a>    <span class="ex">cowsay</span> -W 100 -f <span class="st">&quot;</span><span class="va">$i</span><span class="st">&quot;</span> <span class="st">&quot;I&#39;m using: </span><span class="va">$i</span><span class="st">&quot;</span></span>
<span id="cb127-5"><a href="#cb127-5"></a><span class="kw">done</span></span></code></pre></div>
<p>Here are sample cowsays that use different fonts (images):</p>
<div class="smaller_font">
<pre><code>Alex@Normandy:~$  cowsay -f kiss &#39;Sorry baby - I choose Bash Bushido over you!&#39;
 _________________________________________
/ Sorry baby - I choose Bash Bushido over \
\ you!                                    /
 -----------------------------------------
     \
      \
             ,;;;;;;;,
            ;;;;;;;;;;;,
           ;;;;;&#39;_____;&#39;
           ;;;(/))))|((\
           _;;((((((|))))
          / |_\\\\\\\\\\\\
     .--~(  \ ~))))))))))))
    /     \  `\-(((((((((((\\
    |    | `\   ) |\       /|)
     |    |  `. _/  \_____/ |
      |    , `\~            /
       |    \  \           /
      | `.   `\|          /
      |   ~-   `\        /
       \____~._/~ -_,   (\
        |-----|\   \    &#39;;;
       |      | :;;;&#39;     \
      |  /    |            |
      |       |            |</code></pre>
<pre><code>Alex@Normandy:~$ cowsay -f surgery Where are my testicles, Summer?
 _________________________________
&lt; Where are my testicles, Summer? &gt;
 ---------------------------------
          \           \  / 
           \           \/  
               (__)    /\         
               (oo)   O  O        
               _\/_   //         
         *    (    ) //       
          \  (\\    //       
           \(  \\    )                              
            (   \\   )   /\                          
  ___[\______/^^^^^^^\__/) o-)__                     
 |\__[=======______//________)__\                    
 \|_______________//____________|                    
     |||      || //||     |||
     |||      || @.||     |||                        
      ||      \/  .\/      ||                        
                 . .                                 
                &#39;.&#39;.`                                

            COW-OPERATION                           
</code></pre>
</div>
<h3 id="cow-say-and-ansible">Cow say and Ansible</h3>
<p>Ansible has a <del>stupid and irritating</del> brilliant ‘easter egg’ that print steps of playbooks with <code>cowsay</code>. In order to turn it off add <code>nocows = 1</code> line to <code>ansible.cfg</code> (in most systems <code>/etc/ansible/ansible.cfg</code>). It’s even more irritating when using Ansible properly (each repo has its own <code>ansible.cfg</code> configuration file), because Ansible configuration is not layered (It’s using a single configuration file, and the <code>/etc/ansible/ansible.cfg</code> is last in precedence) you have to put <code>nocows = 1</code> in each repository….</p>
<h2 id="lolcat">lolcat</h2>
<p>Lolcat is an image with funny cats. To make the book look long and full of content, I put in two lolcat images found on the Internet.</p>
<figure>
<img src="images/11-hacker-printing/milk_and_sugar.jpg" alt="" /><figcaption>Sweet sugar. </figcaption>
</figure>
<figure>
<img src="images/11-hacker-printing/cat_poop.jpg" alt="" /><figcaption>Cat poop. </figcaption>
</figure>
<p>Apart from being a funny image lolcat is also a command-line tool that prints text in beautiful rainbow colors. Because lolcat is ruby based, we need <code>ruby</code> and <code>gem</code> (RubyGems package manager command line tool). Installation on Enterprise Linux:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb130-1"><a href="#cb130-1"></a><span class="fu">sudo</span> yum install rubygems -y</span>
<span id="cb130-2"><a href="#cb130-2"></a><span class="ex">gem</span> install lolcat</span></code></pre></div>
<p>Because lolcat is printing coloured text only if the output is terminal it can be aliased as cat :).</p>
<p>To invoke lolcat help use <code>-h</code> or <code>--help</code> flag. When it comes to controls you can set, the duration, speed, colors options and much more. I personally enjoy <code>-a</code> or <code>--animate</code> option, that prints one line then changes its colors for some time. The second really interestin option is <code>-t</code> that enable support for 24-bit true color in the terminal.</p>
<p>There is excellent gist about True Color - <a href="https://gist.github.com/XVilka/8346728">https://gist.github.com/XVilka/8346728</a>. Even newer (made after 16-03-2019) lame Windows Putty supports it!</p>
<p>Whenever I use a new terminal emulator (I have tested a lot of them), I use lolcat as true color tester :).</p>
<figure>
<img src="images/11-hacker-printing/lolcat.png" alt="" /><figcaption>This screen don’t look good at the e-reader</figcaption>
</figure>
<h2 id="nms">nms</h2>
<p>No More Secret - is a command line tool that animates the “hacking” or “decoding” process similar to the one presented in the Sneakers movie. This is one of these cool programs that you use a few times (during a presentation or when you are bored) and then <del>totally forget</del> use it occasionally.</p>
<p>Installation on EuroLinux (Enterprise Linux) 7:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb131-1"><a href="#cb131-1"></a><span class="fu">sudo</span> yum install -y @development <span class="co"># We need gcc, git and make</span></span>
<span id="cb131-2"><a href="#cb131-2"></a><span class="fu">git</span> clone git@github.com:bartobri/no-more-secrets.git </span>
<span id="cb131-3"><a href="#cb131-3"></a><span class="bu">cd</span> no-more-secrets</span>
<span id="cb131-4"><a href="#cb131-4"></a><span class="fu">make</span> all</span>
<span id="cb131-5"><a href="#cb131-5"></a><span class="fu">sudo</span> make install</span></code></pre></div>
<p>Sample usage:</p>
<pre><code>cat /etc/passwd | nms
(...) # output is animated - try it yourself.</code></pre>
<p>When it comes to parameters, there is one flag that I found useful <code>-a</code> that is auto-decrypt. In other words, animation starts without waiting for you to press key.</p>
<h2 id="fortune-teller">Fortune teller</h2>
<p>Whenever I’m testing something that requires a little (like literally short) pseudorandom text input, I’m taking an advantage of <code>fortune</code>. Fortune is a popular program first version of which came out with version 7 Unix (it’s older than dinosaurs). The version used by Enterprise Linux distributions is a little bit different from the one used by BSD (that has, let’s say, a rough history). You can install <strong>fortune-mod</strong> package from EPEL repository.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb133-1"><a href="#cb133-1"></a><span class="fu">sudo</span> yum install -y epel-release</span>
<span id="cb133-2"><a href="#cb133-2"></a><span class="fu">sudo</span> yum install -y fortune-mod</span></code></pre></div>
<p>Before invoking <code>fortune</code>, I would like to note a particular thing about this program. As said before, fortune is an ancient program, its data is residing in the <code>games</code> directory (<code>/usr/share/games</code> in Enterprise Linux 7). Yeah games… like really, this is this “old-better” computing world where fortune teller and fancy terminal printing (like <code>FIGlet</code>) were treated as “games”. But there is even more - <code>fortune</code>, and <code>figlet</code> are programs that actually use the most hated section of the manual (section 6 - games), that many argue is useless.</p>
<p>With this interesting but unnecessary knowledge, you can invoke the actual program:</p>
<pre><code>-bash-4.2$ fortune
&lt;DarthVadr&gt; Kira: JOIN THE DARK SIDE, YOUNG ONE.
&lt;kira&gt; darth, I *am* the dark side.</code></pre>
<p>You can choose from themed fortunes like art, education, goedel, linux, startrek or the equally imaginative thing called love (I’m sooooo alone, even my CPU has other CPUs!). The actual fortune database will/might differ, based on your distribution and/or chosen implementation.</p>
<p>To get fortunes on Linux, use</p>
<pre><code>-bash-4.2$ fortune linux
It&#39;s now the GNU Emacs of all terminal emulators.
   -- Linus Torvalds, regarding the fact that Linux started off as a terminal emulator</code></pre>
<p>You can append other categories to make your favourite set of fortune. For example <code>fortune science art linux</code> will print only these three categories.</p>
<p>Besides the ability to choose a category, there are three parameters that might be useful.</p>
<ul>
<li><code>s</code> - short ( &lt; 160 chars)</li>
<li><code>l</code> - long ( &gt;= 160 chars)</li>
<li><code>n [number]</code> - set a number from which characters will be considered long (default is 160) - short/long classificatory.</li>
</ul>
<p>Another funny thing is that there is a bug in fortune that is described in a manual, and probably treated as a “feature”. If you ask for a long fortune and make the short/long classification too high, the fortune will be in a never-ending loop, so you have to kill it manually.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb136-1"><a href="#cb136-1"></a><span class="co"># Infinite fortune search</span></span>
<span id="cb136-2"><a href="#cb136-2"></a><span class="ex">fortune</span> -l -n 600000</span></code></pre></div>
<h1 id="network">Network</h1>
<p>In this chapter, we are going to explore network related tools, programs and tricks. First off there are tricks related to SSH. It is one of the most popular, heavy-used and battle-tested commands/services. Then we have some <code>netcat</code> tricks. Netcat is sometimes called Swiss Army Knife of Hacking Tools/Network Tools. Then you will learn how to scan a network and check the open ports. There are also other goodies!</p>
<p>For a great start - here is one of my favourite XKDC comic:</p>
<figure>
<img src="images/12-network/devotion_to_duty.png" alt="" /><figcaption>XKDC Devotion to Duty Comic</figcaption>
</figure>
<h2 id="sshfs---ssh-file-system">SSHFS - SSH File System</h2>
<p>Whenever there is a need to edit files that are on a remote server that has only ssh access, the following pattern occurs:</p>
<ol type="1">
<li>Files are copied, locally edited, then copied back.</li>
<li>Files are remotely edited.</li>
</ol>
<p>The first one is cumbersome, especially if you are doing live patching (it’s an awkward experience that I don’t recommend). The second one is good only if the necessary tools are available on the remote server. But what if there is another, better, possibility that takes what is best from both worlds?</p>
<p>Well, it’s possible! You can mount remote files locally with sshfs, that surprisingly leverages SSH.</p>
<p>The first and most important benefit is that you can edit live on a remote server, and still use your favourite programs/tools that are on your computer. The second benefit of sshfs is that it’s based on SSH File Transfer Protocol that is supported on all modern ssh clients and servers. <code>sshfs</code> does not require new software, permission management and open ports on firewalls. Moreover, SSH is one of the most battle-tested and secure protocols, so you can safely use it even on public networks.</p>
<p>To install <code>sshfs</code> on Enterprise Linux systems, you should install <code>fuse-sshfs</code> package from the EPEL repository:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb137-1"><a href="#cb137-1"></a><span class="fu">sudo</span> yum install -y epel-release</span>
<span id="cb137-2"><a href="#cb137-2"></a><span class="fu">sudo</span> yum install -y fuse-sshfs</span></code></pre></div>
<p><code>FUSE</code> is an abbreviation of Filesystem in Userspace. The <code>sshfs</code> is FUSE based, so it doesn’t require root privileges to manage mounts. Example <code>sshfs</code>:</p>
<pre><code>[Alex@SpaceShip ~]$ sshfs Alex@webserver1:/var/www/static /home/Alex/static</code></pre>
<p>It will allow editing static content from webserver1 on the local machine. To unmount the FUSE-based mount, you can use the well-known:</p>
<pre><code>umount /home/Alex/static</code></pre>
<p>But it requires root privileges! If your user has sudo capability, you can use the <code>sudo !!</code> trick. But, the better solution is to use <code>fusermount</code> command with <code>-u</code> like <code>u</code>nmount flag:</p>
<pre><code>[Alex@SpaceShip ~]$ fusermount -u /home/Alex/static</code></pre>
<p>It will unmount the previously mounted sshfs.</p>
<p>I won’t recommend using sshfs as an always mounted production network file system, but it’s perfect for small changes, write/reads. The potential problem with SSHFS are I/O errors, but they should not corrupt the filesystem ;).</p>
<h3 id="allow-others-to-use-our-sshfs-and-other-fuse-based-mount.">Allow others to use our sshfs (and other FUSE based) mount.</h3>
<p>Sometimes, sharing FUSE based resources with other users can save us a lot of fuss. To do so, you have to edit <code>/etc/fuse.conf</code> (uncomment or add <code>user_allow_other</code> line. Then pass <code>allow_other</code> option to the mount command. There is no service that have to be restarted because <code>/etc/fuse.conf</code> is read each time the FUSE-based resource is mounted.</p>
<p>Previous example with <code>sshfs</code> that makes shared mount:</p>
<pre><code>sshfs Alex@webserver1:/var/www/static /mnt/static -o allow_other</code></pre>
<h2 id="ssh-with-the-x-server">SSH with the X server</h2>
<p>Sometimes you want to use a graphical tool from a host that only has the ssh enabled (99.9% of prod servers). For example, adding the next disk to a virtual machine is much easier from a hypervisor graphical console (ex. VirtualBox). In that case, you can easily set up X11 forwarding with ssh. The <code>-X</code> option must you use (Yoda voice). A system from which you will forward GUI programs needs proper libraries installed, but if there are graphical tools, it’s quite likely that it already has them.</p>
<p>The listening below will start <code>firefox</code> on the remote host:</p>
<pre><code>[Alex@SpaceShip ~]$ ssh -X myuser@remote
[myuser@remote]$ firefox</code></pre>
<p>There are some security considerations. According to Red Hat 7 Security Guide, X11 forwarding is not recommended for an unknown host. Another important note is that there is an X11 replacement that is under massive development - Wayland. Wayland can somehow forward in X11 style with Xwayland, but some users claim that it’s buggy.</p>
<h2 id="port-forwarding-with-ssh">Port forwarding with ssh</h2>
<p>In many environments, there is a host called “jump server”, jump hosts or jumpbox that is used to access computers in another security zone (like company LAN). Sometimes you need to get a service (like a web server) from this zone. In cases like that, the SSH port forwarding, also called SSH tunnelling, might come in handy.</p>
<p>There are two types of forwarding. The first one is the local forwarding. Because it’s much easier to get it with an example look at the following command:</p>
<pre><code>ssh -L 9999:webserver:443 root@jumphost</code></pre>
<p>It will open the local port 9999. When the user opens a browser (or uses anything that can use https like curl or wget) with the address <code>https://localhost:9999</code>, the connection will be transferred to jumphost, that will ask the webserver for content.</p>
<p>Another way is the remote port forwarding, it is the same but reverse :). Look at the following example:</p>
<pre><code>ssh -R 8080:localhost:80 root@jumphost</code></pre>
<p>It will allow anyone that has access to jumphost asks about <code>http://jumphost:8080</code> to connect to the localhost on port 80.</p>
<p>Please note that examples above use web servers, but any other protocol that uses TCP will work. There is also a great answer on superuser.com how to achieve port forwarding for UDP services. You can read it here <a href="https://superuser.com/questions/53103/udp-traffic-through-ssh-tunnel">https://superuser.com/questions/53103/udp-traffic-through-ssh-tunnel</a>.</p>
<p>When it comes to ssh tunnelling, there are some security considerations - because it’s possible to transfer anything that jump host has access to, it might be wise to add some extra security. SSH tunnelling might be used to make backdoors, so proper hardened jump host SSH daemon configuration should prevent it.</p>
<p>But there are also benefits of using port forwarding. For example, when you have an insecure web application that is using HTTP instead of HTTPS, then you can locally forward the connection to the server itself:</p>
<pre><code>ssh -L 9999:localhost:80 root@webserver</code></pre>
<p>Now your connection between the web server and your host are SSH grade encrypted!</p>
<p>SSH port forwarding can also be used when your idiotic boss orders the blocking of some significant websites like facebook.com or ilovemyself.my. Sometimes there is an even more natural way to bypass them, but ssh forwarding with some of your external servers (every self-respecting admin should have at least one private VPN) will work.</p>
<h2 id="add-ssh-host-key-to-.sshknown_host-if-they-dont-exist">Add SSH host key to .ssh/known_host if they don’t exist</h2>
<p>One of the problems that you may encounter during scripting is that the host key is not in the ~/.ssh/known_hosts file. In that case, scripts that are not interactive won’t work. But there is a small utility called <code>ssh-keyscan</code> that can be used to get the ssh keys provided by the host. For the previously mentioned problem, look at the following solution:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb146-1"><a href="#cb146-1"></a><span class="va">TO_HOST=</span>this.is.my.host.com</span>
<span id="cb146-2"><a href="#cb146-2"></a><span class="bu">[</span> <span class="va">$(</span><span class="fu">grep</span>  -cim1 <span class="st">&quot;</span><span class="va">$TO_HOST</span><span class="st">&quot;</span> ~/.ssh/known_hosts<span class="va">)</span> <span class="ot">-gt</span> 0<span class="bu"> ]</span> <span class="kw">||</span> <span class="fu">ssh-keyscan</span> <span class="st">&quot;</span><span class="va">$TO_HOST</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tee</span> -a  ~/.ssh/known_hosts </span>
<span id="cb146-3"><a href="#cb146-3"></a><span class="co"># Now the ssh commands can be invoked.</span></span></code></pre></div>
<p><code>-cim1</code> means <code>--count</code> <code>--ignore-case</code> and <code>--max-count=1</code>, so it returns 1 or 0. If the test that is in <code>[</code> <code>]</code> fails, then the second part that leverages ssh-keyscan with a tee in append (<code>-a</code>) mode runs.</p>
<h2 id="instant-directory-content-sharing-with-python.">Instant directory content sharing with Python.</h2>
<p>Sometimes you have to share files with random people. One of the most straightforward solutions is to share the content of a directory on a web server. To achieve this, we can invoke the standard Python module. It’s like having a minimalistic web server that serves static content, always with you :)!</p>
<p>For Python2, use:</p>
<pre><code>python2 -m SimpleHTTPServer</code></pre>
<p>For Python3, use:</p>
<pre><code>python3 -m http.server</code></pre>
<p>Because Python 2 will hit EOL soon, I recommend using Python 3. You can also change the port on which our webserver will listen (default 8000):</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb149-1"><a href="#cb149-1"></a><span class="ex">python2</span> -m SimpleHTTPServer 8080 <span class="co"># port 8080 on 0.0.0.0</span></span>
<span id="cb149-2"><a href="#cb149-2"></a><span class="ex">python3</span> -m http.server 8080 <span class="co"># port 8080 on 0.0.0.0</span></span></code></pre></div>
<p>Of course - 0.0.0.0 means all interfaces.</p>
<p>In Python 3, we can also choose on which interface our server should listen.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb150-1"><a href="#cb150-1"></a><span class="ex">python3</span> -m http.server 8080 -b 10.10.1.123 <span class="co"># port 8080 on 10.10.1.123</span></span></code></pre></div>
<p>There might be small complications:</p>
<ul>
<li>If you want to use a standard port like 80, you need to have root privileges, not privileged users can use ports that are higher than 1024. In that case, ports like 8080 are not formally standardized but frequently used.</li>
<li>The other complication is the firewall - if it’s enabled the proper configuration has to be done. Also, remember to clean-up these temporary firewall rules.</li>
</ul>
<h2 id="scan-ports-with-nmap">Scan ports with Nmap</h2>
<p>Nmap is a security scanner that allows finding open ports on the host, it has lots of specially crafted packages, that helps to determine not only ports, services but sometimes service flavour (vendor and version) or even host OS. In most countries, although no law explicitly forbids port scanning, doing it without permission can be detected as a potential attack and drag you into legal hell. It’s because port scanning is used/might be used as one of the first phases of a cyber-attack.</p>
<p>Before performing a network scan, you should get a written consent that allows you to do it. There is an excellent article on nmap.org - <a href="https://nmap.org/book/legal-issues.html">https://nmap.org/book/legal-issues.html</a> that gives a real-life example of what can potentially happen.</p>
<p>Nevertheless, after being warned, the nmap is frequently used by users to scan their own networks. It’s so popular that most distributions have it in their repo. Installing it on EL7 is as simple as:</p>
<pre><code>sudo yum install -y nmap</code></pre>
<p>Now you can start scanning your network :). I personally use it to determine open ports on hosts that are “forgotten” and find IP addresses of printers.</p>
<p>To scan for TCP open ports, use:</p>
<pre><code>nmap -sT HOST</code></pre>
<p>To scan for UPD open ports, use:</p>
<pre><code>nmap -sU HOST</code></pre>
<p>To enable OS detection, use:</p>
<pre><code>nmap -O --osscan-guess HOST</code></pre>
<p>The most commonly used options is <code>-A</code> (like all) with <code>-T4</code>. The <code>-T</code> option sets the timing, there is a possibility to also use names. The values are from 0 to 5, or from paranoid (0) to insane (5). The 4 is also called aggressive. <code>-A</code> options enable things like OS detection, version detection, scripts scanning and traceroute. As always more can be found in the nmap manual.</p>
<pre><code>nmap -A -T4 HOST</code></pre>
<p>To scan a whole network (local network in your workplace) just choose whichever IP and add a mask (nmap will automatically convert it to a network).</p>
<pre><code>nmap -A -T insane 192.168.121.111/24 </code></pre>
<p>To get more information about nmap, I recommend the official website - nmap.org, there is a separate book section. The author of Nmap - Gordon “Fyodor” Lyon, wrote the book half of which is available online - https://nmap.org/book/toc.html. If you are really interested in network scanning, you might consider buying the official book; in way you support the development and show the gratitude towards the author.</p>
<p>Bonus meme describing the Bash Bushido author. <img src="images/12-network/hackerman.jpg" alt="Nmap hacker Meme" /></p>
<h2 id="monitor-traffic-with-traf-ng">Monitor traffic with traf-ng</h2>
<p>There are multiple tools to monitor traffic, the most well-known is Wireshark, but it’s a GUI program. There is a tshark project that allows you to get some of the Wireshark capabilities into CLI, but Wireshark is one of these rare programs where GUI is, and will be, more potent than CLI.</p>
<p>But don’t lose hope! There is a tool to monitor the network from CLI, its name is <code>iptraf</code> and because it’s a rewritten version it has <code>-ng</code> at the end. It’s not as robust and powerful as Wireshark, but it allows monitoring the most basic network functions, statistics, load, etc. and in many cases it is enough.</p>
<p>The <code>iptraf-ng</code> is a standard package at Enterprise Linux distribution to install it, you might use</p>
<pre><code>sudo yum install -y iptraf-ng</code></pre>
<p>The iptraf-ng requires superuser permissions. Because it’s the interactive program, it doesn’t require additional arguments to startup.</p>
<figure>
<img src="images/12-network/iptraf-ng1.png" alt="" /><figcaption>iptraf menu</figcaption>
</figure>
<p>IPtraf-ng is self-explanatory with great discoverability. So, I decided to provide just 2 screenshots that show some capabilities of the iptraf program.</p>
<p>To watch the hosts that our computer connects to you can choose “IP traffic monitor”:</p>
<figure>
<img src="images/12-network/iptraf-ng2.png" alt="" /><figcaption>iptraf IP traffic monitor</figcaption>
</figure>
<p>To watch detailed interface statistics choose “Detailed interface statistics” (WoW, rLy?):</p>
<figure>
<img src="images/12-network/iptraf-ng3.png" alt="" /><figcaption>iptraf IP traffic monitor</figcaption>
</figure>
<p>As said before, the program is self-explanatory, but there is little curio about this program. It leverages signals in a non-standard manner. So according to the manual, there are two signals:</p>
<pre><code>SIGNALS
    SIGUSR1 - rotates log files while program is running
    SIGUSR2 - terminates an IPTraf process running in the background.</code></pre>
<p>Both are defined in the POSIX standard as signals that a programmer (user) can define. In this case, SIGUSR2 can be used to terminate the process. To check it out, you can use commands from the listening below:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb159-1"><a href="#cb159-1"></a><span class="op">&gt;</span> <span class="fu">sudo</span> iptraf-ng -g -B</span>
<span id="cb159-2"><a href="#cb159-2"></a><span class="op">&gt;</span> <span class="ex">pgrep</span> iptraf-ng</span>
<span id="cb159-3"><a href="#cb159-3"></a><span class="ex">31431</span></span>
<span id="cb159-4"><a href="#cb159-4"></a><span class="op">&gt;</span> <span class="fu">sudo</span> kill -s 12 31431</span>
<span id="cb159-5"><a href="#cb159-5"></a><span class="op">&gt;</span> <span class="ex">pgrep</span> iptraf-ng</span>
<span id="cb159-6"><a href="#cb159-6"></a><span class="op">&gt;</span></span></code></pre></div>
<h2 id="network-load---nload">Network LOAD - nload</h2>
<p>nload is the minimalistic program that shows, well, - the network load. There are options like period, interval or unit, but there is not much to see. As always, I recommend reading the manual. Even so basic program like nload has some configuration that can be set and saved. <code>F2</code> invoke configuration window and <code>F5</code> save the configuration to a file.</p>
<p><code>nload</code> is not part of Enterprise Linux distributions, but fortunately, it’s in EPEL repository, so installation is straightforward as:</p>
<pre><code>sudo yum install -y epel-release
sudo yum install -y nload</code></pre>
<p>After installation, nload can be invoked without any parameters. To change the currently inspected interface, use arrows. And that all :).</p>
<p>Sample statistics for my wireless card:</p>
<figure>
<img src="images/12-network/nload.png" alt="" /><figcaption>nload label{nload}</figcaption>
</figure>
<h2 id="ss---another-utility-to-investigate-sockets">ss - another utility to investigate sockets</h2>
<p><code>ss</code> is a utility to get information about the sockets. It’s really similar to <code>netstat</code>, but it’s newer and much faster. Still, not all <code>netstat</code> functionalities are fully implemented in <code>ss</code>, some of the old <code>netstat</code> commands are represented in <code>ip</code> command.</p>
<p>To list <strong>all</strong> connections in your system you might use <code>ss</code> without any parameter</p>
<pre><code>Alex@Normandy$ ss
Netid  State      Recv-Q Send-Q  Local Address:Port    Peer Address:Port 
u_str  ESTAB      0      0       /run/systemd/journal/stdout 645671 * 642860               
u_str  ESTAB      0      0       * 89062               * 93582                
u_str  ESTAB      0      0       /run/dbus/system_bus_socket 79026 * 72610                
u_str  ESTAB      0      0       @/tmp/dbus-EEfUpzdsKr 64988   * 65714 </code></pre>
<p>To list the TCP connection, use <code>-t</code> option</p>
<pre><code>Alex@Normandy$ ss -t
State      Recv-Q Send-Q Local Address:Port                 Peer Address:Port                
ESTAB      0      0      192.168.0.12:40630                 94.23.88.39:https </code></pre>
<p>Similarly, to list the UDP connections, you might use <code>-u</code>. When it comes to Unix socket use <code>-x</code>.</p>
<p>By default, the <code>ss</code> report only established connections, to enable <strong>all</strong> connections, use <code>-a</code> option.</p>
<p>To get which process is using the particular socket the <code>-p</code> parameter should be used.</p>
<pre><code>Alex@Normandy$ ss -tp
State      Recv-Q Send-Q Local Address:Port                 Peer Address:Port                
ESTAB      0      0      192.168.0.12:40134                172.217.16.3:http                  users:((&quot;firefox&quot;,pid=5778,fd=165))</code></pre>
<p><code>ss</code> can try to resolve the DNS name of a host. The option that enables it, is <code>-r</code>.</p>
<pre><code>Alex@Normandy$ ss -tpr
ESTAB      0      0          Normandy:49918                stackoverflow.com:https                 users:((&quot;firefox&quot;,pid=5778,fd=116))</code></pre>
<p>To check the listening sockets, the <code>-l</code> option can be used, it’s useful to check what services are running on the current host, and what are the addresses of these services. It’s commonly used with <code>-n</code> that won’t show the service name but the numeric value of the port, for example instead of https <code>ss</code> shows 443. Note that in most cases, to get more specific information about the process, the superuser privileges are required.</p>
<p>This example below shows the same line for sshd with and without root privileges:</p>
<pre><code>Alex@Normandy$ ss -nltp
State       Recv-Q Send-Q       Local Address:Port      Peer Address:Port
LISTEN     0      128          *:22                       *:*                  
LISTEN     0      128         :::22                      :::*  </code></pre>
<pre><code>sudo ss -nltp
State       Recv-Q Send-Q       Local Address:Port      Peer Address:Port
LISTEN     0      128          *:22                       *:*      users:((&quot;sshd&quot;,pid=7411,fd=3))
LISTEN     0      128         :::22                      :::*      users:((&quot;sshd&quot;,pid=7411,fd=4))</code></pre>
<p>SS can be also used to get some simple statistics about sockets:</p>
<pre><code>Alex@Normandy$ ss -s 
Total: 1077 (kernel 0)
TCP:   13 (estab 3, closed 1, orphaned 0, synrecv 0, timewait 0/0), ports 0

Transport Total     IP        IPv6
*     0         -         -        
RAW   1         0         1        
UDP   11        8         3        
TCP   12        8         4        
INET      24        16        8        
FRAG      0         0    0 </code></pre>
<p>The other useful functionality of ss is ability to show SELinux context. Like in most command line utilities, the option responsible for printing SELlinux related information is <code>-Z</code>. The following example has condensed output for IPv4 sshd:</p>
<pre><code>sudo ss -ltZ
State     Recv-Q Send-Q  Local Address:Port  Peer  Address:Port
LISTEN    0      128     *:ssh               *:*   users:((&quot;sshd&quot;,pid=7411,proc_ctx=system_u:system_r:sshd_t:s0-s0:c0.c1023,fd=3))</code></pre>
<p>To display only IPv4 connection the <code>-4</code> option must be set. The similar option for IPv6 is obviously <code>-6</code>.</p>
<p><code>ss</code> can display TCP timers. To enable it use <code>-o</code> flag. For example:</p>
<pre><code>Alex@Normandy$ ss -etro
State      Recv-Q Send-Q Local Address:Port                 Peer Address:Port                
ESTAB      0      0      Normandy:49918                stackoverflow.com:https                 timer:(keepalive,9min22sec,0)</code></pre>
<p>SS also has the ability to filter the connections based on their state, port number, and host.</p>
<pre><code>ss -nt dst 10.10.1.100 # tcp connection to host 10.10.1.100
ss -nt dst 10.10.1.100/24 # tcp connection to network 10.10.1.100/24
ss -nt dport = :80 # Port number must be used with &quot;:&quot; think about it as part of host:port combination with empty host
# The filter can be put together 
ss -nt &#39;( dport = :80 or dport = :443 or dport =: 443  )&#39;</code></pre>
<p>As always, more can be found in the manual, in this case, it’s the section 8 - system administration commands, <code>man 8 ss</code>.</p>
<h2 id="ncat-netcat">Ncat (Netcat)</h2>
<p>Ncat is a simple yet extremely powerful and popular tool to read and write from/to TCP, UPD, and UNIX socket connections. In many cases, it’s a backend that is frequently middle layer in scripts, and other programs.</p>
<p>The Ncat is the reimplementation of popular netcat, both commands have the same aberration (nc). The most popular implementation implementation is one from the nmap project, it combines the most prominent options from other netcat’s. Installation on EL7 is as simple as:</p>
<pre><code>sudo yum install -y nmap-ncat</code></pre>
<p>After installation, there is a <code>ncat</code> command and the symbolic link to it <code>nc</code>.</p>
<h3 id="connect-to-service-with-netcat">Connect to service with netcat</h3>
<p>Netcat might be used to connect to any specific port/host combination.</p>
<p>To connect to host with TCP, use:</p>
<pre><code>ncat HOST PORT</code></pre>
<p>To connect to host with UPD, use:</p>
<pre><code>nc -u HOST PORT</code></pre>
<p>To connect to a Unix socket use:</p>
<pre><code>nc -U /path/to/my.socket</code></pre>
<p>To dump session to a file the <code>-o</code> option can be used.</p>
<pre><code>ncat -o FILENAME HOST PORT</code></pre>
<p>The first application of ncat is to determine if a specific port is open (it’s one of the first things to check when a service doesn’t work as expected). Usually, NMap is better suited for this job, but ncat package is about 40 times smaller, and nc is loved because of its minimalistic nature. Another usage of netcat is sending commands, files or payload. The payload is a technical term that can mean the actually delivered message (when you send the message to a server, there is a lot of metadata - like hops, source, destination, that are necessary to deliver a package through a network), the second meaning is the harmful code that is delivered by an exploit. Payload term is frequently used by pentesters.</p>
<p>Some “payload” payload.txt (HTTP request) to sample Heroku application.</p>
<pre><code>GET / HTTP/1.0
Host: example.herokuapp.com
</code></pre>
<p>Because RFC 2616 (Hypertext Transfer Protocol – HTTP/1.1) defines that linebreak is of <code>CRLF</code> type (more information about this problem can be found at <a href="##%20dos2unix%20unix2dos">dos2unix unix2dos</a> then before piping the HTTP request that is written in the file, the unix2dos should be used.</p>
<pre><code>$ unix2dos payload.txt</code></pre>
<p>After this operation cat piped to netcat works like a charm.</p>
<pre><code>cat payload.txt | nc example.herokuapp.com 80</code></pre>
<h3 id="ncat-transfer-files">Ncat transfer files</h3>
<p>Ncat is frequently used to transfer the files over the network. Because I prefer self-contained examples, the localhost is used, but in a normal situation, there is a different host.</p>
<p>To start ncat in the listening mode use the <code>-l</code> option:</p>
<pre><code>nc -l -p 6969 &gt; output_file</code></pre>
<p>To transfer the file, you might use the file redirection (<code>&lt;</code>), or pipe:</p>
<pre><code>nc localhost 6969 &lt; file.txt</code></pre>
<p>After these operations, the output_file should be identical to file.txt. Note that in a normal situation, the firewall rules should block the connection between hosts.</p>
<h3 id="ncat-transfer-the-whole-directory">Ncat Transfer the whole directory</h3>
<p>Ncat can quickly transfer directory (and subdirectories). On the one end, the tar output is used as input to ncat, and on the second session, the ncat output is input for tar. You might also use compression (in my case it is bzip2).</p>
<p>On the receiving host use:</p>
<pre><code>nc -l 4242 | tar xvzf -</code></pre>
<p>Then on the sending host use:</p>
<pre><code>tar cvzf - /path/to/directory |  nc HOST 4242 </code></pre>
<h2 id="telnet-check-if-port-works">Telnet check if port works</h2>
<p>Telnet is mostly a legacy, not encrypted way to communicate between computers. It was used to remotely control web servers thousands of years ago (if you used telnet frequently, don’t look at your metric - you are probably old!). Because telnet passes the data in clear-text, it’s not advisable to use it on public networks, but to be honest, also not on any network/system. But because telnet is text-based, it might also be used to test some services.</p>
<p>For example, to test if web server works, you might do the following:</p>
<pre><code>[Alex@SpaceShip ~]$ telnet 192.168.121.170 80
Trying 192.168.121.170...
Connected to 192.168.121.170.
Escape character is &#39;^]&#39;.
GET /
Never gonna give you up,
Never gonna let you down,
Never gonna run around and desert you,
Never gonna make you cry, Never gonna say goodbye,
Never gonna tell a lie and hurt you
Connection closed by foreign host</code></pre>
<p>In that example, we use an HTTP defined method “GET” on a path “/” which is the root of the web server.</p>
<p>Telnet can also check if it is possible to connect to the specified port (5432 [Postgres]):</p>
<pre><code>[Alex@SpaceShip ~]$ telnet 192.168.121.170 5432
Trying 192.168.121.170...
telnet: connect to address 192.168.121.170: Connection refused</code></pre>
<p>After starting the Postgresql server that listens on 5432, the same command will print</p>
<pre><code>telnet 192.168.121.170 5432
Trying 192.168.121.170...
Connected to 192.168.121.170.
Escape character is &#39;^]&#39;.</code></pre>
<h2 id="telnet-star-wars">telnet Star Wars</h2>
<p>This trick is one of the simplest in whole Bash Bushido. With telnet installed you can watch the part of Star Wars Episode IV:</p>
<pre><code>telnet towel.blinkenlights.nl</code></pre>
<p>If your network supports the IPv6, you might get the better IPv6 version with:</p>
<pre><code>telnet -6 towel.blinkenlights.nl</code></pre>
<p>I didn’t test it, so if it’s not working you might make an issue on GitHub repo - https://github.com/AlexBaranowski/bash-bushido-errata .</p>
<p>To exit telnet, use <code>ctrl</code> + <code>]</code> (exit character), then <code>ENTER</code>, after that you should get <code>telnet&gt;</code> prompt where you can send EOF (<code>ctrl</code> + <code>d</code>) that closes a session.</p>
<p>As my friend said about this amazing telnet movie - “This is a typical Open Source project - it’s great, fun to use and watch, but also half-finished”. And with this pure gold quote, let’s finish this chapter.</p>
<h1 id="miscellaneous-scripting-topics">Miscellaneous scripting topics</h1>
<p>This chapter is the essence of Bash Bushido, it’s the longest chapter in the whole book, and it contains a lot of small solutions and programs that any sysadmin/devops/production engineer can use.</p>
<h2 id="repeat-until-success.">Repeat until success.</h2>
<p>Sometimes there is a need to repeat the command as long as there is no success. In most cases, three constructions are used.</p>
<ol type="1">
<li>Run until success - never give up :) (meme below)</li>
<li>Run until success with a counter.</li>
<li>Run until success with a timeout.</li>
</ol>
<figure>
<img src="images/13-scripting/genius.jpg" alt="" /><figcaption>Endless loop</figcaption>
</figure>
<ul>
<li><p>1st case:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb188-1"><a href="#cb188-1"></a><span class="kw">while</span> <span class="fu">true</span><span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb188-2"><a href="#cb188-2"></a>    <span class="ex">this_command_might_fail</span> <span class="kw">&amp;&amp;</span> <span class="bu">break</span><span class="kw">;</span></span>
<span id="cb188-3"><a href="#cb188-3"></a>    <span class="fu">sleep</span> 5<span class="kw">;</span> <span class="co"># Sleep well little angel!</span></span>
<span id="cb188-4"><a href="#cb188-4"></a><span class="kw">done</span></span></code></pre></div></li>
<li><p>2nd case:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb189-1"><a href="#cb189-1"></a><span class="va">RETRY_COUNTER=</span>1</span>
<span id="cb189-2"><a href="#cb189-2"></a><span class="kw">while</span> <span class="fu">true</span> <span class="kw">;do</span></span>
<span id="cb189-3"><a href="#cb189-3"></a>    <span class="kw">if [[</span> RETRY_COUNTER <span class="ot">-gt</span> 10<span class="kw"> ]]</span>; <span class="kw">then</span></span>
<span id="cb189-4"><a href="#cb189-4"></a>        <span class="bu">echo</span> <span class="st">&quot;Sorry it didn&#39;t work&quot;</span></span>
<span id="cb189-5"><a href="#cb189-5"></a>        <span class="bu">exit</span> 1</span>
<span id="cb189-6"><a href="#cb189-6"></a>    <span class="kw">fi</span></span>
<span id="cb189-7"><a href="#cb189-7"></a>    <span class="bu">echo</span> <span class="st">&quot;I&#39;m trying for </span><span class="va">$RETRY_COUNTER</span><span class="st"> time&quot;</span></span>
<span id="cb189-8"><a href="#cb189-8"></a>    <span class="ex">this_command_might_fail</span> <span class="kw">&amp;&amp;</span> <span class="bu">break</span><span class="kw">;</span></span>
<span id="cb189-9"><a href="#cb189-9"></a>    <span class="va">RETRY_COUNTER=$((</span>RETRY_COUNTER+1<span class="va">))</span></span>
<span id="cb189-10"><a href="#cb189-10"></a>    <span class="fu">sleep</span> 5<span class="kw">;</span> <span class="co"># You might add some sleep</span></span>
<span id="cb189-11"><a href="#cb189-11"></a><span class="kw">done</span></span></code></pre></div></li>
<li><p>3rd case:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb190-1"><a href="#cb190-1"></a><span class="va">MY_TIMEOUT=</span>60</span>
<span id="cb190-2"><a href="#cb190-2"></a><span class="va">MY_BASE_TIME=$(</span> <span class="fu">date</span> +%s <span class="va">)</span></span>
<span id="cb190-3"><a href="#cb190-3"></a><span class="kw">while</span> <span class="fu">true</span><span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb190-4"><a href="#cb190-4"></a>    <span class="va">MY_CURRENT_TIME=$(</span> <span class="fu">date</span> +%s <span class="va">)</span></span>
<span id="cb190-5"><a href="#cb190-5"></a>    <span class="kw">if [[</span> <span class="va">$((</span> MY_BASE_TIME - MY_CURRENT_TIME + MY_TIMEOUT <span class="va">))</span> <span class="ot">-lt</span> 0<span class="kw"> ]]</span>; <span class="kw">then</span></span>
<span id="cb190-6"><a href="#cb190-6"></a>        <span class="bu">echo</span> <span class="st">&quot;Timeout trap - sorry :(.&quot;</span></span>
<span id="cb190-7"><a href="#cb190-7"></a>        <span class="bu">exit</span> 1</span>
<span id="cb190-8"><a href="#cb190-8"></a>    <span class="kw">fi</span></span>
<span id="cb190-9"><a href="#cb190-9"></a>    <span class="ex">this_command_might_fail</span> <span class="kw">&amp;&amp;</span> <span class="bu">break</span><span class="kw">;</span></span>
<span id="cb190-10"><a href="#cb190-10"></a>    <span class="bu">echo</span> <span class="st">&quot;It didn&#39;t work! I hope that I won&#39;t hit timeout!&quot;</span></span>
<span id="cb190-11"><a href="#cb190-11"></a>    <span class="fu">sleep</span> 5<span class="kw">;</span> <span class="co"># You might add some sleep</span></span>
<span id="cb190-12"><a href="#cb190-12"></a><span class="kw">done</span></span></code></pre></div></li>
</ul>
<p>In the third case, we use epoch time - a number of seconds since 00:00:00 UTC, Thursday, 1 January 1970. It’s also called Unix Time.</p>
<h2 id="print-lines-based-on-the-lines-number.">Print lines based on the lines number.</h2>
<p><code>sed</code> is one of the mysterious, powerful tools from Unix that only guys with beards longer than their… FINGERS can understand. SED stands for Stream EDitor - it means that it takes stream (the file, pipe, stdin) of characters and performs an operation on it. That’s it :). It sounds simple - but like a lot of things in Unix - the simple, clean ideas can result in absurdly powerful tools.</p>
<p>One of the easiest problems that can be solved with sed is printing only selected lines. To do so, use ‘N,Mp’ command. The <code>N</code> and <code>M</code> are numbers of lines when <code>p</code> is sed command that accepts address range. In the example below, lines from 3 to 10 are printed.</p>
<pre><code>[root@Normandy ~]# cat -n /etc/passwd &gt; n_passwd # cat -n number the lines
[root@Normandy ~]# sed -n &#39;3,10p&#39; n_passwd 
     3  daemon:x:2:2:daemon:/sbin:/sbin/nologin
     4  adm:x:3:4:adm:/var/adm:/sbin/nologin
     5  lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
     6  sync:x:5:0:sync:/sbin:/bin/sync
     7  shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
     8  halt:x:7:0:halt:/sbin:/sbin/halt
     9  mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
    10  operator:x:11:0:operator:/root:/sbin/nologin</code></pre>
<p>There is a possibility to get similar results without sed, but they require multiple commands and are slower.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb192-1"><a href="#cb192-1"></a>[<span class="ex">root@Normandy</span> ~]# cat  n_passwd <span class="kw">|</span> <span class="fu">head</span> -10 <span class="kw">|</span> <span class="fu">tail</span> -8</span>
<span id="cb192-2"><a href="#cb192-2"></a>     <span class="ex">3</span>  daemon:x:2:2:daemon:/sbin:/sbin/nologin</span>
<span id="cb192-3"><a href="#cb192-3"></a>     <span class="ex">4</span>  adm:x:3:4:adm:/var/adm:/sbin/nologin</span>
<span id="cb192-4"><a href="#cb192-4"></a>     <span class="ex">5</span>  lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span>
<span id="cb192-5"><a href="#cb192-5"></a>     <span class="ex">6</span>  sync:x:5:0:sync:/sbin:/bin/sync</span>
<span id="cb192-6"><a href="#cb192-6"></a>     <span class="ex">7</span>  shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span>
<span id="cb192-7"><a href="#cb192-7"></a>     <span class="ex">8</span>  halt:x:7:0:halt:/sbin:/sbin/halt</span>
<span id="cb192-8"><a href="#cb192-8"></a>     <span class="ex">9</span>  mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span>
<span id="cb192-9"><a href="#cb192-9"></a>    <span class="ex">10</span>  operator:x:11:0:operator:/root:/sbin/nologin</span></code></pre></div>
<p>In both cases, <code>cat</code> command can be omitted. I decide to add it only to make the examples cleaner.</p>
<h2 id="tail-on-changes">Tail on changes</h2>
<p>When debugging services admins look into log files. But the logs grow and reading the full content each time can be extremely time consuming or even impossible. The answer to this problem is the tail <code>follow</code> mode. In this mode <code>tail</code> prints data appended to the file. The flag (switch/option) that enables it is <code>-f</code> or <code>--follow.</code> Sample with <code>/var/log/audit/audit.log.</code></p>
<pre><code>[root@tmpcdn ~]# tail -1 -f /var/log/audit/audit.log type=SERVICE_STOP ...
# Add some enters to separate events. Next part
# was logged after sudo invocation

type=USER_CMD msg=audit(1537357799.016:603): ...  </code></pre>
<h2 id="substitute-the-string-in-a-file.">Substitute the string in a file.</h2>
<p>The most popular usage of sed is replacing (substituting) a string in a file. To demonstrate this capability, I used the following text:</p>
<pre><code>sed is a stream editor.
Sed is sed SED SED sed</code></pre>
<p>That is saved as <strong>orig.txt</strong>. To replace a string use following sed command <code>s/OLD/NEW/[MODS]</code>, where <strong>MODS</strong> can be skipped. A simple change from sed to seed:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb195-1"><a href="#cb195-1"></a>[<span class="ex">Alex@Normandy</span> tmp]$ sed <span class="st">&#39;s/sed/seed/&#39;</span> orig.txt </span>
<span id="cb195-2"><a href="#cb195-2"></a><span class="ex">seed</span> is a stream editor.</span>
<span id="cb195-3"><a href="#cb195-3"></a><span class="ex">Sed</span> is seed SED SED sed</span></code></pre></div>
<p>As you can see only the first occurance in a line was changed. To make the replacing “global”, so it changes multiple occurrences in line that has them add the <strong>g</strong> modifier.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb196-1"><a href="#cb196-1"></a>[<span class="ex">Alex@Normandy</span> tmp]$ sed <span class="st">&#39;s/sed/seed/g&#39;</span> orig.txt </span>
<span id="cb196-2"><a href="#cb196-2"></a><span class="ex">seed</span> is a stream editor.</span>
<span id="cb196-3"><a href="#cb196-3"></a><span class="ex">Sed</span> is seed SED SED seed </span></code></pre></div>
<p>To make the <code>sed</code> replacing case insensitive, add <strong>i</strong> modifier.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb197-1"><a href="#cb197-1"></a>[<span class="ex">Alex@Normandy</span> tmp]$ sed <span class="st">&#39;s/sed/seed/gi&#39;</span> orig.txt </span>
<span id="cb197-2"><a href="#cb197-2"></a><span class="ex">seed</span> is a stream editor.</span>
<span id="cb197-3"><a href="#cb197-3"></a><span class="ex">seed</span> is seed seed seed seed</span></code></pre></div>
<h2 id="remove-selected-linelines-from-a-file.">Remove selected line/lines from a file.</h2>
<p>Sed can also be used to remove the line/lines from the file. Imagine a test file named <strong>remove.txt</strong> that has the following content:</p>
<pre><code>     1  root:x:0:0:root:/root:/bin/bash
     2  bin:x:1:1:bin:/bin:/sbin/nologin
     3  daemon:x:2:2:daemon:/sbin:/sbin/nologin
     4  adm:x:3:4:adm:/var/adm:/sbin/nologin
     5  lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
     6  sync:x:5:0:sync:/sbin:/bin/sync
     7  shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
     8  halt:x:7:0:halt:/sbin:/sbin/halt
     9  mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
    10  operator:x:11:0:operator:/root:/sbin/nologin</code></pre>
<p>It was made with <code>cat -n /etc/passwd | head -10</code>. Now, to remove line number 9 that has mail user the following sed command can be used <strong>N[,M]d</strong>. The N,M are integers. The <code>[,M]</code> parameter, this parameter creates a range, can be skipped, in that case sed will remove only the selected line.</p>
<pre><code>[Alex@Normandy tmp]$ sed &#39;9d&#39; remove.txt 
     1  root:x:0:0:root:/root:/bin/bash
     2  bin:x:1:1:bin:/bin:/sbin/nologin
     3  daemon:x:2:2:daemon:/sbin:/sbin/nologin
     4  adm:x:3:4:adm:/var/adm:/sbin/nologin
     5  lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
     6  sync:x:5:0:sync:/sbin:/bin/sync
     7  shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
     8  halt:x:7:0:halt:/sbin:/sbin/halt
    10  operator:x:11:0:operator:/root:/sbin/nologin</code></pre>
<p>To remove lines from 2 to 9, the following <code>sed</code> command can be used:</p>
<pre><code>[Alex@Normandy tmp]$ sed &#39;2,9d&#39; remove.txt 
     1  root:x:0:0:root:/root:/bin/bash
    10  operator:x:11:0:operator:/root:/sbin/nologin</code></pre>
<h2 id="change-the-file-with-sed-in-place">Change the file with sed in place</h2>
<p>To change the file in place, the <code>-i</code> option can be used. Let’s reuse orig.txt file from the previous examples.</p>
<pre><code>sed is a stream editor.
Sed is sed SED SED sed</code></pre>
<p>After using:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb202-1"><a href="#cb202-1"></a>[<span class="ex">Alex@Normandy</span> tmp]$ sed <span class="st">&#39;s/sed/seed/gI&#39;</span> orig.txt </span>
<span id="cb202-2"><a href="#cb202-2"></a><span class="ex">seed</span> is a stream editor.</span>
<span id="cb202-3"><a href="#cb202-3"></a><span class="ex">seed</span> is seed seed seed seed </span></code></pre></div>
<p>The file stays the same. But if you run sed with <code>-i</code> option sed will change the file <code>i</code>n place</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb203-1"><a href="#cb203-1"></a>[<span class="ex">Alex@Normandy</span> tmp]$ sed -i <span class="st">&#39;s/sed/seed/gI&#39;</span> orig.txt </span>
<span id="cb203-2"><a href="#cb203-2"></a>[<span class="ex">Alex@Normandy</span> tmp]$ cat orig.txt </span>
<span id="cb203-3"><a href="#cb203-3"></a><span class="ex">seed</span> is a stream editor.</span>
<span id="cb203-4"><a href="#cb203-4"></a><span class="ex">seed</span> is seed seed seed seed </span></code></pre></div>
<h2 id="make-the-script-exit-on-the-first-error">Make the script exit on the first error</h2>
<p>One of the most common mistakes that programmers make is the fact that their scripts don’t stop on the first error. Most programming languages will terminate if there is an exception that is not handled. But not Bash. BaSh iS StRoNG, aNd NeVer DooonT GiVE Up! Let’s look at the following code:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb204-1"><a href="#cb204-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb204-2"><a href="#cb204-2"></a></span>
<span id="cb204-3"><a href="#cb204-3"></a><span class="fu">destroy_entire_planet()</span><span class="kw">{</span></span>
<span id="cb204-4"><a href="#cb204-4"></a>    <span class="bu">echo</span> <span class="st">&quot;Refresh the trigger&quot;</span></span>
<span id="cb204-5"><a href="#cb204-5"></a>    <span class="fu">touch</span> /tmp/death_star_trigger</span>
<span id="cb204-6"><a href="#cb204-6"></a>    <span class="fu">sleep</span> <span class="va">$((</span>RANDOM%3 +1<span class="va">))</span></span>
<span id="cb204-7"><a href="#cb204-7"></a>    <span class="bu">echo</span> <span class="st">&quot;Planet </span><span class="va">$1</span><span class="st"> destroyed&quot;</span></span>
<span id="cb204-8"><a href="#cb204-8"></a><span class="kw">}</span></span>
<span id="cb204-9"><a href="#cb204-9"></a></span>
<span id="cb204-10"><a href="#cb204-10"></a><span class="co"># Check if it&#39;s safe to destroy planet exit if false</span></span>
<span id="cb204-11"><a href="#cb204-11"></a><span class="ex">check_if_planet_save_to_destroy_or_exit</span></span>
<span id="cb204-12"><a href="#cb204-12"></a><span class="co"># actually destroy a planet</span></span>
<span id="cb204-13"><a href="#cb204-13"></a><span class="ex">destroy_entire_planet</span> <span class="va">$1</span></span></code></pre></div>
<p>This code was written by one of the interns that decided that automating his job is a great idea! Then decided to try it on planet “ButtHurt”, where all the fans (like me) of the older Star Wars live.</p>
<pre><code>[intern128539494@DeathStar my_home]$./destroy.sh ButtHurt
./destroy.sh: line 11: check_if_planet_save_to_destroy_or_exit: command not found
Refresh the trigger
Planet ButtHurt destroyed</code></pre>
<p>And BANG BANG! Even if the whole function (routine, subprogram) is not implemented, Bash didn’t stop the execution. It’s great when using command line interactively, so each typo like <code>pdw</code> instead of <code>pwd</code> doesn’t log the user out, but it’s really undesirable for scripts. There is interesting option that enables instant exit when a command fails (based on not zero exit status!). It is <code>-e</code> it can be set in script with the <code>set</code> command.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb206-1"><a href="#cb206-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb206-2"><a href="#cb206-2"></a><span class="co"># Stop script on first error</span></span>
<span id="cb206-3"><a href="#cb206-3"></a><span class="kw">set</span> <span class="ex">-e</span></span>
<span id="cb206-4"><a href="#cb206-4"></a></span>
<span id="cb206-5"><a href="#cb206-5"></a><span class="fu">destroy_entire_planet()</span><span class="kw">{</span></span></code></pre></div>
<p>To disable it, you can use <code>set +e</code>. Disabling might be useful when you know that a command might fail, and you want to branch the script depending on its exit status.</p>
<p>There is also the possibility to set the options for bash with <code>env</code> in shebang, but <strong>only in the newer coreutils</strong>. Then the first line of the script looks like:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb207-1"><a href="#cb207-1"></a><span class="co">#!/usr/bin/env -S bash -e</span></span></code></pre></div>
<p>The <code>-S</code> options inform the <code>env</code> that is should split the rest of the string (‘bash -e’ -&gt; [‘bash’, ‘-e’]).</p>
<h2 id="more-safety-features-in-bash-scripts">More safety features in bash scripts</h2>
<p>There are at least two basic additional safety features that everyone should use. First one is the usage of a not defined variable. Imagine the following code that is saved in removeHome.sh</p>
<pre><code>#!/usr/bin/env bash
set -e

TO_REMOVE=$1

echo &quot;Gonna remove all files from /home/$TO_REMOVE&quot;
# rm -rf /home/$TO_REMOVE</code></pre>
<p>This script will work! What’s gonna happen when the first argument is not provided? Well, the <code>/home/</code> will be removed (EUID must be equal to 0). There is another safety feature in Bash that treats the usage of unset variable as an error. With the <code>-e</code> option, it will stop the script execution. This option can be set with <code>set -u</code>. After a little change in the script</p>
<pre><code>#!/usr/bin/env bash
set -eu</code></pre>
<p>The script that uses not defined/unbound variable won’t work.</p>
<pre><code>[Alex@Normandy tmp]$ ./removeHome.sh 
./removeHome.sh: line 4: $1: unbound variable</code></pre>
<p>Without <code>set -e</code> the <code>-u</code> won’t exit, but it will mark command as failed. Following example uses <code>$$</code> variable that contains current shell PID and <code>$?</code> variable that contains the last command exit status.</p>
<pre><code>[Alex@SpaceStation ~]$ echo $$ # Bash 1
26333
[Alex@SpaceStation ~]$ bash # starting shell in shell
[Alex@SpaceStation ~]$ echo $$ # Bash 2 
26800
[Alex@SpaceStation ~]$ echo $asdfasdf # this variable doesn&#39;t exist

[Alex@SpaceStation ~]$ echo $? # but echo returns 0
0
[Alex@SpaceStation ~]$ set -u  # enables -u
[Alex@SpaceStation ~]$ echo $asdfasdf # this variable doesn&#39;t exist
bash: asdfasdf: unbound variable
[Alex@SpaceStation ~]$ echo $? #command returns 1; echo wasn&#39;t even executed
1
[Alex@SpaceStation ~]$ echo $$ # we are still  in second shell
26800
[Alex@SpaceStation ~]$ set -e
[Alex@SpaceStation ~]$ echo $asdfasdf # this command will fail and exit shell
bash: asdfasdf: unbound variable 
[Alex@SpaceStation ~]$ echo $$ # Bash1
26333</code></pre>
<p>Another feature that should be used, is checking if <strong>any</strong> command in the pipe exited with a not-zero status.</p>
<p>Look at the code saved into <strong>test_fail.sh</strong>:</p>
<pre><code>#!/usr/bin/env bash
set -eu

true | false | true
echo &quot;Ain&#39;t nothing but a mistake&quot;
false | true
echo &quot;Tell me why &quot;
false | true | true
echo &quot;I never want to hear you say&quot;
false | false | true
echo &quot;I want it that way&quot;</code></pre>
<p>When invoked it prints part of chorus from “I Want It That Way” by Backstreet Boys.</p>
<pre><code>[Alex@Normandy tmp]$ ./test_fail.sh 
Ain&#39;t nothing but a mistake
Tell me why
I never want to hear you say
I want it that way</code></pre>
<p>Note that each time the last command in the pipe exit with 0 exit code/status, but some commands inside the pipe failed (non-zero exit status). It’s safe to conclude that as long as the last command exits with a zero, the whole pipe is considered correct. But in the real world, it’s undesirable. The failed program inside the pipe means that something went wrong. The other aspect is that a lot of commands nearly always finish with a zero status, for example, <code>sort</code>.</p>
<p>It’s highly recommended that the <code>-o pipefail</code> is set. This option mark the whole pipe failed if <strong>any</strong> of its components fails.</p>
<p>So after change <code>set</code> line into</p>
<pre><code>set -euo pipefail</code></pre>
<p>The <code>./test_file.sh</code> won’t print anything (exits after the first pipe). The <code>set -euo pipefail</code> is considered a standard minimal safeguard for scripts.</p>
<h2 id="echo-to-stderr">echo to stderr</h2>
<p>Sometimes, you might want to print some information to stderr instead of stdout. This is a widespread practice of reporting errors and sometimes debugging. As I assume that reader knows about redirections, I would like to present three different ways to print on standard error (stderr). These tricks are system dependent, all of them work on Enterprise Linux distributions, but for example, second won’t work on Android Termux.</p>
<ol type="1">
<li><p>Simple redirection:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb215-1"><a href="#cb215-1"></a><span class="co"># Note that redirection &#39;&gt;&amp;2&#39; might be put on</span></span>
<span id="cb215-2"><a href="#cb215-2"></a><span class="co"># very beggining and the end. </span></span>
<span id="cb215-3"><a href="#cb215-3"></a></span>
<span id="cb215-4"><a href="#cb215-4"></a><span class="op">&gt;&amp;2</span> <span class="bu">echo</span> ERROR config file does not exist!</span>
<span id="cb215-5"><a href="#cb215-5"></a><span class="bu">echo</span> ERROR config file does not exist! <span class="op">&gt;&amp;2</span></span></code></pre></div></li>
<li><p>Redirect to /dev/stderr:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb216-1"><a href="#cb216-1"></a><span class="bu">echo</span> ERROR config file does not exist! <span class="op">&gt;</span> /dev/stderr</span></code></pre></div></li>
<li><p>Redirect to /proc/self/fd/2:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb217-1"><a href="#cb217-1"></a><span class="bu">echo</span> ERROR config file does not exist! <span class="op">&gt;</span> /proc/self/fd/2</span></code></pre></div></li>
</ol>
<p>There a is little curio:</p>
<pre><code>[Alex@Normandy BashBushido]$ ll /dev/stderr
lrwxrwxrwx. 1 root root 15 Jun 16 14:56 /dev/stderr -&gt; /proc/self/fd/2</code></pre>
<h2 id="debug-bash-script">Debug bash script!</h2>
<p>Debugging is the process of finding the bugs in your code (Thanks Captain Obvious). Even if there is no formal definition of a bug in a common sense, it’s similar to a much more defined defect. The defect is a flaw (imperfection) or deficiency in a work product where it does not meet requirements and/or specifications.</p>
<p>The very first thing to do when you get an error is actually reading it! In old languages like C or C++ you might get ultra-specific errors like “Core Dump (Segmentation fault)”. In modern languages, especially in one that uses some kind of VM or interpreter, you will get something called traceback or backtrace. Tracebacks/backtraces print the stack traces of the running program. So, you can get the information which function used which function and finally which line leads to the error.</p>
<p>Unfortunately, this is not the case in the bash shell. Even if bash is also a scripting language, or at least a “sh-compatible command language” it won’t produce meaningful tracebacks in the case of an error. So, we have to make them ourself. It can be enabled with <code>set -x</code> or <code>set -o xtrace</code>. This simple tracing prints each line before execution. To present it, I decided to provide the following simple code.</p>
<ol type="1">
<li><p><code>run.sh</code> script</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb219-1"><a href="#cb219-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb219-2"><a href="#cb219-2"></a></span>
<span id="cb219-3"><a href="#cb219-3"></a><span class="fu">foo()</span><span class="kw">{</span></span>
<span id="cb219-4"><a href="#cb219-4"></a>    <span class="bu">echo</span> -n <span class="st">&quot;foo&quot;</span></span>
<span id="cb219-5"><a href="#cb219-5"></a>    <span class="ex">bar</span></span>
<span id="cb219-6"><a href="#cb219-6"></a><span class="kw">}</span></span>
<span id="cb219-7"><a href="#cb219-7"></a></span>
<span id="cb219-8"><a href="#cb219-8"></a><span class="fu">bar()</span><span class="kw">{</span></span>
<span id="cb219-9"><a href="#cb219-9"></a>    <span class="bu">echo</span> -n <span class="st">&quot;bar&quot;</span></span>
<span id="cb219-10"><a href="#cb219-10"></a><span class="kw">}</span></span>
<span id="cb219-11"><a href="#cb219-11"></a><span class="fu">main()</span><span class="kw">{</span></span>
<span id="cb219-12"><a href="#cb219-12"></a>    <span class="bu">.</span> <span class="ex">./lib.sh</span></span>
<span id="cb219-13"><a href="#cb219-13"></a>    <span class="ex">check_euid</span> <span class="kw">||</span> <span class="ex">foo</span></span>
<span id="cb219-14"><a href="#cb219-14"></a>    <span class="ex">check_euid</span> <span class="kw">&amp;&amp;</span> <span class="ex">bar</span></span>
<span id="cb219-15"><a href="#cb219-15"></a>    <span class="bu">echo</span> <span class="st">&#39;&#39;</span></span>
<span id="cb219-16"><a href="#cb219-16"></a><span class="kw">}</span></span>
<span id="cb219-17"><a href="#cb219-17"></a><span class="ex">main</span></span></code></pre></div></li>
<li><p>Little library that has one function - <code>lib.sh</code></p>
<div class="sourceCode" id="cb220"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb220-1"><a href="#cb220-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb220-2"><a href="#cb220-2"></a><span class="fu">check_euid()</span> <span class="kw">{</span></span>
<span id="cb220-3"><a href="#cb220-3"></a>    <span class="kw">if</span><span class="bu"> [</span> <span class="st">&quot;</span><span class="va">$EUID</span><span class="st">&quot;</span>  <span class="ot">==</span> 0<span class="bu"> ]</span>; <span class="kw">then</span></span>
<span id="cb220-4"><a href="#cb220-4"></a>        <span class="op">&gt;&amp;2</span> <span class="bu">echo</span> <span class="st">&quot;Warn: Running with root privileges - I like it.&quot;</span></span>
<span id="cb220-5"><a href="#cb220-5"></a>        <span class="bu">return</span> 0</span>
<span id="cb220-6"><a href="#cb220-6"></a>    <span class="kw">else</span></span>
<span id="cb220-7"><a href="#cb220-7"></a>        <span class="op">&gt;&amp;2</span> <span class="bu">echo</span> <span class="st">&quot;Warn: EUID != 0&quot;</span></span>
<span id="cb220-8"><a href="#cb220-8"></a>        <span class="bu">return</span> 1</span>
<span id="cb220-9"><a href="#cb220-9"></a>    <span class="kw">fi</span></span>
<span id="cb220-10"><a href="#cb220-10"></a><span class="kw">}</span></span></code></pre></div>
<p>Now, the execution with xtraced enable will produce an output similar to</p></li>
</ol>
<pre><code>[Alex@Normandy tmp]$ bash -x ./run.sh 
+ main
+ . ./lib.sh
+ check_euid
+ &#39;[&#39; 1000 == 0 &#39;]&#39;
# ... output truncated</code></pre>
<p>As you can see <code>$EUID</code> variable was expanded to <code>1000</code>.</p>
<p>To get the line number, filename and function name, you might set the PS4 environmental variable. This trick was taken from - https://wiki.bash-hackers.org/scripting/debuggingtips. The value of PS4 is changed to <code>'+(${BASH_SOURCE}:${LINENO}): ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'</code>. These prompt uses bash special variables like <code>$LINENO</code>. Each of these variables is described in the Bash manual.</p>
<p>Sample debugging execution with an almighty prompt:</p>
<pre><code>[Alex@Normandy tmp]$ export PS4=&#39;+(${BASH_SOURCE}:${LINENO}): ${FUNCNAME[0]:+${FUNCNAME[0]}(): }&#39;
[Alex@Normandy tmp]$ bash -x ./run.sh 
+(./run.sh:17): main
+(./run.sh:12): main(): . ./lib.sh
+(./run.sh:13): main(): check_euid
+(./lib.sh:3): check_euid(): &#39;[&#39; 1000 == 0 &#39;]&#39;
+(./lib.sh:7): check_euid(): echo &#39;Warn: EUID != 0&#39;</code></pre>
<h2 id="shellcheck---write-better-bash-scripts">Shellcheck - write better bash scripts!</h2>
<p>There are multiple ways that a software can be tested, but one of the most fundamental distinction is based on whether the software is actually run. In dynamic testing, the code is executed, in contrary, static testing doesn’t execute the code, but checks its static properties. The static testing is also white box testing because the tester/test automation engineer/software engineer in test actually has access to the source code of the program.</p>
<p>One of the most frequently used static testing techniques is static code analysis. In most cases, programs that perform static code analysis and often also grade the code, are called linters. The name linter came from ‘lint’ a program from Unix version 7 that was looking for mistakes in the C programs. Nowadays, most IDE have built-in linters that help avoid most popular missteps/errors. Some linters even gives a numeric or “school grade” score like 8.9/10 or B+. A lot of GitHub repositories have badges that inform on the code health based on linters and other statistics.</p>
<p>OK, why did I provide all this theory? Well, there is an absolutely fabulous linter for shell scripts - it’s shellcheck. Shellcheck is shell a script static analysis tool. It also uses standard exit codes to inform if a code is flawless (at least on a level that shellcheck can check it ;)).</p>
<p>The official ShellCheck GitHub repository: <a href="https://github.com/koalaman/shellcheck/wiki">https://github.com/koalaman/shellcheck/wiki</a>.</p>
<p>The shellcheck groups wrong statements/bad codes based on severity, currently there are three categories:</p>
<ol type="1">
<li><code>Error</code> - in most cases, the script won’t invoke properly.</li>
<li><code>Warning</code> - in most cases inadequate, but syntax acceptable, code.</li>
<li><code>Info</code> - from quite important to pedant information. In many cases, they don’t have much impact on a script and its execution.</li>
</ol>
<p>Installing the ShellCheck on Enterprise Linux distributions is really easy - you just need the EPEL repository :).</p>
<pre><code>sudo yum install -y epel-release
sudo yum install -y ShellCheck</code></pre>
<p>After installation, shellcheck is invoked like any other program. One of the most essential switches is <code>-e</code> that excludes specified error codes.</p>
<p>Look at the following example:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb224-1"><a href="#cb224-1"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ shellcheck /usr/sbin/alsa-info.sh <span class="kw">|</span> <span class="fu">wc</span> -l</span>
<span id="cb224-2"><a href="#cb224-2"></a><span class="ex">1511</span></span>
<span id="cb224-3"><a href="#cb224-3"></a><span class="co"># Excluding 2086 doublequote information</span></span>
<span id="cb224-4"><a href="#cb224-4"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ shellcheck -e 2086 /usr/sbin/alsa-info.sh <span class="kw">|</span> <span class="fu">wc</span> -l</span>
<span id="cb224-5"><a href="#cb224-5"></a><span class="ex">341</span></span></code></pre></div>
<p>I personally like to use shellcheck in CI/CD, unfortunately, the shellcheck return a not-zero status whenever there is <strong>any</strong> flaw (even if it is at the “information” level). However, the shellcheck can print its data in a different format. One of the supported formats is JSON. My favourite command-line tool for performing search and other operations on JSON is <code>jq</code>. Going back to the previous example, to count the different types of levels, the following pipe might be used:</p>
<pre><code>[Alex@SpaceShip BashBushido]$ shellcheck --format json /usr/sbin/alsa-info.sh | jq . | grep &#39;level&#39; | sort | uniq -c
    292     &quot;level&quot;: &quot;info&quot;,
    68     &quot;level&quot;: &quot;style&quot;,
    3     &quot;level&quot;: &quot;warning&quot;,</code></pre>
<p>The <code>jq .</code> is jq invocation with an empty filter. Never version (1.6+) of JQ can be invoked without a dot. The jq is not the scope of this chapter, but there is an official GitHub page https://stedolan.github.io/jq, that has a considerably good tutorial.</p>
<p>To only read the “warning” level messages the jq filter must be changed.</p>
<pre><code>[Alex@SpaceShip BashBushido]$ shellcheck --format json /usr/sbin/alsa-info.sh | jq &#39;.[] | select(.level == &quot;warning&quot;) &#39;
{
  &quot;file&quot;: &quot;/usr/sbin/alsa-info.sh&quot;,
  &quot;line&quot;: 93,
  &quot;column&quot;: 100,
  &quot;level&quot;: &quot;warning&quot;,
  &quot;code&quot;: 2034,
  &quot;message&quot;: &quot;inp appears unused. Verify it or export it.&quot;
}
{ # ... output truncated</code></pre>
<h3 id="shellcheck-web-version.">Shellcheck web version.</h3>
<p>Shellcheck has a website that allows you to use it without installing - https://shellcheck.net . If you don’t trust the author or his/her server, you can always spin your own similar website based on the official GitHub repository - https://github.com/koalaman/shellcheck.net :).</p>
<figure>
<img src="images/13-scripting/shell_check_web.png" alt="" /><figcaption>ShellCheck web interface</figcaption>
</figure>
<h3 id="shellcheck-in-cicd">ShellCheck in CI/CD</h3>
<p>ShellCheck can be used in a CI/CD pipeline. Thank God all projects I’m working on use Git (BTW if the company is using a <strong>legacy CVS</strong>, it is a <strong>RED FLAG</strong>). The following script can be used in CI/CD scenario where only the modified <code>*.sh</code> files are taken into account.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb227-1"><a href="#cb227-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb227-2"><a href="#cb227-2"></a><span class="co"># Author: Aleksander Baranowski</span></span>
<span id="cb227-3"><a href="#cb227-3"></a><span class="co"># License: MIT (https://choosealicense.com/licenses/mit/)</span></span>
<span id="cb227-4"><a href="#cb227-4"></a><span class="co"># This simple script looks for changed .sh file from the last git commit</span></span>
<span id="cb227-5"><a href="#cb227-5"></a><span class="co"># then run shellcheck on them.</span></span>
<span id="cb227-6"><a href="#cb227-6"></a><span class="co"># USAGE: shellcheck_ci repo_root_dir</span></span>
<span id="cb227-7"><a href="#cb227-7"></a></span>
<span id="cb227-8"><a href="#cb227-8"></a></span>
<span id="cb227-9"><a href="#cb227-9"></a><span class="co"># Exit codes:</span></span>
<span id="cb227-10"><a href="#cb227-10"></a><span class="co"># 98 - required command is not installed</span></span>
<span id="cb227-11"><a href="#cb227-11"></a><span class="co"># 1 - some file failed check</span></span>
<span id="cb227-12"><a href="#cb227-12"></a><span class="co"># 0 - success</span></span>
<span id="cb227-13"><a href="#cb227-13"></a></span>
<span id="cb227-14"><a href="#cb227-14"></a><span class="co"># VARS</span></span>
<span id="cb227-15"><a href="#cb227-15"></a><span class="va">MY_REQUIRED_COMMANDS=</span><span class="st">&quot;python shellcheck git&quot;</span></span>
<span id="cb227-16"><a href="#cb227-16"></a><span class="va">MY_DIR_TO_CHECK=</span><span class="st">&quot;&quot;</span></span>
<span id="cb227-17"><a href="#cb227-17"></a><span class="va">MY_FILES_TO_CHECK=</span><span class="st">&quot;&quot;</span></span>
<span id="cb227-18"><a href="#cb227-18"></a></span>
<span id="cb227-19"><a href="#cb227-19"></a><span class="fu">check_required_commands()</span><span class="kw">{</span></span>
<span id="cb227-20"><a href="#cb227-20"></a>    <span class="kw">for</span> <span class="ex">my_command</span> in <span class="va">$MY_REQUIRED_COMMANDS</span><span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb227-21"><a href="#cb227-21"></a>        <span class="bu">hash</span> <span class="st">&quot;</span><span class="va">$my_command</span><span class="st">&quot;</span> <span class="op">2&gt;</span>/dev/null <span class="kw">||</span> <span class="kw">{</span> </span>
<span id="cb227-22"><a href="#cb227-22"></a>        <span class="bu">echo</span> <span class="st">&quot;Script require </span><span class="va">$my_command</span><span class="st"> command! Aborting.&quot;</span><span class="kw">;</span> <span class="bu">exit</span> 98<span class="kw">;</span></span>
<span id="cb227-23"><a href="#cb227-23"></a>        <span class="kw">}</span> <span class="co"># Using 98 as exit code</span></span>
<span id="cb227-24"><a href="#cb227-24"></a>    <span class="kw">done</span></span>
<span id="cb227-25"><a href="#cb227-25"></a><span class="kw">}</span></span>
<span id="cb227-26"><a href="#cb227-26"></a></span>
<span id="cb227-27"><a href="#cb227-27"></a><span class="fu">print_help()</span><span class="kw">{</span></span>
<span id="cb227-28"><a href="#cb227-28"></a>    <span class="bu">echo</span> <span class="st">&quot;Usage: </span><span class="va">$0</span><span class="st"> DIRECTORY_TO_CHECK&quot;</span></span>
<span id="cb227-29"><a href="#cb227-29"></a>    <span class="bu">exit</span> 1</span>
<span id="cb227-30"><a href="#cb227-30"></a><span class="kw">}</span></span>
<span id="cb227-31"><a href="#cb227-31"></a></span>
<span id="cb227-32"><a href="#cb227-32"></a><span class="fu">setup_script()</span><span class="kw">{</span></span>
<span id="cb227-33"><a href="#cb227-33"></a>    <span class="kw">if</span><span class="bu"> [</span> <span class="va">$#</span> <span class="ot">-ne</span> 1<span class="bu"> ]</span>;<span class="kw">then</span></span>
<span id="cb227-34"><a href="#cb227-34"></a>        <span class="ex">print_help</span></span>
<span id="cb227-35"><a href="#cb227-35"></a>    <span class="kw">fi</span></span>
<span id="cb227-36"><a href="#cb227-36"></a>    <span class="va">MY_DIR_TO_CHECK=</span><span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span></span>
<span id="cb227-37"><a href="#cb227-37"></a>    [ <span class="ex">-d</span>  <span class="st">&quot;</span><span class="va">$MY_DIR_TO_CHECK</span><span class="st">&quot;</span> ] <span class="kw">||</span>  <span class="kw">{</span> <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$1</span><span class="st"> is not directory!&quot;</span><span class="kw">;</span> <span class="bu">exit</span> 1<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb227-38"><a href="#cb227-38"></a><span class="kw">}</span></span>
<span id="cb227-39"><a href="#cb227-39"></a></span>
<span id="cb227-40"><a href="#cb227-40"></a><span class="fu">find_files_to_check()</span><span class="kw">{</span></span>
<span id="cb227-41"><a href="#cb227-41"></a>    <span class="bu">pushd</span> <span class="st">&quot;</span><span class="va">$MY_DIR_TO_CHECK</span><span class="st">&quot;</span> <span class="op">&gt;</span> /dev/null</span>
<span id="cb227-42"><a href="#cb227-42"></a>    <span class="va">MY_FILES_TO_CHECK=$(</span><span class="fu">git</span> show --pretty=<span class="st">&quot;format:&quot;</span> --name-only <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&quot;.*\.sh$&quot;</span><span class="va">)</span></span>
<span id="cb227-43"><a href="#cb227-43"></a>    <span class="bu">echo</span> <span class="st">&quot;Found </span><span class="va">$(</span> <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$MY_FILES_TO_CHECK</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> -w<span class="va">)</span><span class="st"> *.sh file/s&quot;</span></span>
<span id="cb227-44"><a href="#cb227-44"></a>    <span class="bu">popd</span> <span class="op">&gt;</span> /dev/null</span>
<span id="cb227-45"><a href="#cb227-45"></a><span class="kw">}</span></span>
<span id="cb227-46"><a href="#cb227-46"></a></span>
<span id="cb227-47"><a href="#cb227-47"></a><span class="fu">run_shellcheck()</span><span class="kw">{</span></span>
<span id="cb227-48"><a href="#cb227-48"></a>    <span class="kw">if [[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$MY_FILES_TO_CHECK</span><span class="st">&quot;</span><span class="kw"> ]]</span>; <span class="kw">then</span></span>
<span id="cb227-49"><a href="#cb227-49"></a>        <span class="bu">echo</span> <span class="st">&quot;No *.sh script found - skipping&quot;</span></span>
<span id="cb227-50"><a href="#cb227-50"></a>        <span class="bu">exit</span> 0</span>
<span id="cb227-51"><a href="#cb227-51"></a>    <span class="kw">else</span></span>
<span id="cb227-52"><a href="#cb227-52"></a>        <span class="co"># disable fail on first error; multiple scripts might not pass;</span></span>
<span id="cb227-53"><a href="#cb227-53"></a>        <span class="co"># fail_flag is now responsible for exit code</span></span>
<span id="cb227-54"><a href="#cb227-54"></a>        <span class="kw">set</span> <span class="ex">+e</span></span>
<span id="cb227-55"><a href="#cb227-55"></a>        <span class="va">fail_flag=</span>0</span>
<span id="cb227-56"><a href="#cb227-56"></a></span>
<span id="cb227-57"><a href="#cb227-57"></a>        <span class="kw">for</span> <span class="ex">i</span> in <span class="va">$MY_FILES_TO_CHECK</span><span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb227-58"><a href="#cb227-58"></a>            <span class="va">output=$(</span><span class="ex">shellcheck</span> --format=json <span class="st">&quot;</span><span class="va">${MY_DIR_TO_CHECK}</span><span class="st">/</span><span class="va">${i}</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb227-59"><a href="#cb227-59"></a>            <span class="va">output_status=$?</span></span>
<span id="cb227-60"><a href="#cb227-60"></a>            <span class="kw">if [[</span> <span class="va">$output_status</span> <span class="ot">-ne</span> 0<span class="kw"> ]]</span>; <span class="kw">then</span></span>
<span id="cb227-61"><a href="#cb227-61"></a>                <span class="va">fail_flag=$((</span>fail_flag+1<span class="va">))</span></span>
<span id="cb227-62"><a href="#cb227-62"></a>                <span class="bu">echo</span> <span class="st">&quot;==== Script </span><span class="va">$i</span><span class="st"> REPORT: ====&quot;</span></span>
<span id="cb227-63"><a href="#cb227-63"></a>                <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$output</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">python</span> -m json.tool</span>
<span id="cb227-64"><a href="#cb227-64"></a>            <span class="kw">fi</span></span>
<span id="cb227-65"><a href="#cb227-65"></a>        <span class="kw">done</span></span>
<span id="cb227-66"><a href="#cb227-66"></a>    <span class="kw">fi</span></span>
<span id="cb227-67"><a href="#cb227-67"></a>    <span class="kw">if [[</span> <span class="va">$fail_flag</span> <span class="ot">-ne</span> 0<span class="kw"> ]]</span>; <span class="kw">then</span></span>
<span id="cb227-68"><a href="#cb227-68"></a>        <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$fail_flag</span><span class="st"> script/s failed :(&quot;</span> <span class="kw">&amp;&amp;</span> <span class="bu">exit</span> 1</span>
<span id="cb227-69"><a href="#cb227-69"></a>    <span class="kw">else</span></span>
<span id="cb227-70"><a href="#cb227-70"></a>        <span class="bu">echo</span> <span class="st">&quot;All script/s passed :)&quot;</span></span>
<span id="cb227-71"><a href="#cb227-71"></a>    <span class="kw">fi</span></span>
<span id="cb227-72"><a href="#cb227-72"></a><span class="kw">}</span></span>
<span id="cb227-73"><a href="#cb227-73"></a></span>
<span id="cb227-74"><a href="#cb227-74"></a><span class="ex">check_required_commands</span></span>
<span id="cb227-75"><a href="#cb227-75"></a><span class="ex">setup_script</span> <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span></span>
<span id="cb227-76"><a href="#cb227-76"></a><span class="ex">find_files_to_check</span></span>
<span id="cb227-77"><a href="#cb227-77"></a><span class="ex">run_shellcheck</span></span></code></pre></div>
<h2 id="at-execute-command-at-a-given-time.">At execute command at a given time.</h2>
<p>atd is daemon that helps schedule jobs for later execution. It stores jobs in /var/spool/at and executes them at a given time. Simple example:</p>
<pre><code>[Alex@SpaceStation tmp]$ at now + 2 minutes
at&gt; echo &quot;I love Bash Bushido&quot; &gt; /tmp/my_at_tmp
at&gt; date &gt;&gt; /tmp/my_at_tmp
at&gt; &lt;EOT&gt;
job 3 at Sun Jul 21 23:17:00 2019</code></pre>
<p>To dispaly at jobs that wait to be run, use <code>atq</code> command.</p>
<pre><code>[Alex@SpaceStation tmp]$ atq
3   Sun Jul 21 23:17:00 2019 a Alex</code></pre>
<p>After about 2 minutes the result can be read.</p>
<pre><code>[Alex@SpaceStation tmp]$ cat /tmp/my_at_tmp 
I love Bash Bushido
Sun Jul 21 23:17:00 CEST 2019</code></pre>
<p>There is a massive difference between at and cron when it comes to handling not executed jobs. If cron misses a job, it won’t try to execute it until the next cron date is hit. The <code>at</code> will try to run the missed jobs the next day at the same time.</p>
<p>Curio - you might disallow/allow usage of at command for particular user/s. More about at can be found in manuals:</p>
<ul>
<li><code>man 1 at</code></li>
<li><code>man 8 atd</code></li>
<li><code>man 5 at.allow</code></li>
</ul>
<h2 id="awk-print-selected-words.">AWK print selected words.</h2>
<p><code>awk</code> is another powerful tool from UNIX. It’s a full programming language, excelling in string manipulation to the point that some people write whole reports in it. Most Linux distributions will use GNU AWK (gawk) implementation, and <code>awk</code> is a symbolic link to <code>gawk</code>.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb231-1"><a href="#cb231-1"></a><span class="ex">Alex@SpaceStation</span> ~]$ ll <span class="va">$(</span><span class="fu">which</span> awk<span class="va">)</span></span>
<span id="cb231-2"><a href="#cb231-2"></a><span class="ex">lrwxrwxrwx.</span> 1 root root 4 Feb 14 11:40 /usr/bin/awk -<span class="op">&gt;</span> gawk</span></code></pre></div>
<p>Because awk excels when it comes to manipulating strings, it’s frequently used with <code>sed</code> and <code>grep</code>. Actually, awk can handle regular expressions and much more, but the most straightforward and extremely useful program in awk is printing the selected word. The syntax is as easy as <code>awk '{print $NUMBER}'</code>. Note that the AWK program is in single quotes, so <code>$NUMBER</code> doesn’t expand into a shell variable.</p>
<p>Look at the following example:</p>
<pre><code>❰Alex❙~❱✔≻ echo &quot;I love rock and roll&quot; | awk &#39;{print $4}&#39;
and</code></pre>
<p>I showed a simple awk program, but why is awk better than <code>cut</code> with a field separator? To see, look at the following example:</p>
<pre><code>❰Alex❙~❱✔≻ echo &quot;I love rock and roll&quot; | cut -f4 &#39;-d &#39;
and
❰Alex❙~❱✔≻ echo &quot;I love rock and roll&quot; | awk &#39;{print $4}&#39;
and
❰Alex❙~❱✔≻ echo &quot;I love   rock   and roll&quot; | cut -f4 &#39;-d &#39;

❰Alex❙~❱✔≻ echo &quot;I love   rock   and roll&quot; | awk &#39;{print $4}&#39;
and</code></pre>
<p>In the case of an unknown number and types of whitespaces, the awk will produce expected results, whereas the <code>cut</code> will not (ofc it’s programmatically correct but inconvenient).</p>
<figure>
<img src="images/13-scripting/awk_still_useful.jpg" alt="" /><figcaption>AWK Meme</figcaption>
</figure>
<h2 id="awk-getting-selected-line-range.">AWK getting selected line range.</h2>
<p>AWK has a variable that keeps the current line number - <code>NR</code>. The example file contains the following lines:</p>
<pre><code>1 one
2 two
3 three
4 four</code></pre>
<p>to print lines from 2 to 3 you might use</p>
<pre><code>❰Alex❙~❱✔≻ awk &#39;NR&gt;=2 &amp;&amp; NR&lt;=3&#39; sample
2 two
3 three</code></pre>
<p>The version with strick inequalities (<code>'NR&gt;1 &amp;&amp; NR&lt;4'</code>) will also work :).</p>
<h2 id="getting-pid-of-the-current-bash-shell.">Getting PID of the current Bash shell.</h2>
<p>PID is a process identifier - the unique number that process has in the operating system. But what is actually surprising is that not all IT people know that there is also PPID that states the Parent PID. It’s one of the questions that I really like to ask during job interviews. The next one is a follow-up question about PPID of init system.</p>
<p>To get the current Bash PID, you can use a particular Bash variable <code>$$</code>. The <strong>nearly</strong> same variable is <code>$BASHPID</code>.</p>
<pre><code>[Alex@SpaceShip BashBushido]$ echo $$
26571
[Alex@SpaceShip BashBushido]$ echo $BASHPID
26571</code></pre>
<p>Yields the same outcome. The difference between <code>$BASHPID</code> and <code>$$</code> can be presented with the following example.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb237-1"><a href="#cb237-1"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ echo <span class="va">$$</span></span>
<span id="cb237-2"><a href="#cb237-2"></a><span class="ex">26571</span></span>
<span id="cb237-3"><a href="#cb237-3"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ echo <span class="va">$(</span><span class="bu">echo</span> <span class="va">$$)</span></span>
<span id="cb237-4"><a href="#cb237-4"></a><span class="ex">26571</span></span>
<span id="cb237-5"><a href="#cb237-5"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ echo <span class="va">$BASHPID</span></span>
<span id="cb237-6"><a href="#cb237-6"></a><span class="ex">26571</span></span>
<span id="cb237-7"><a href="#cb237-7"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ echo <span class="va">$(</span><span class="bu">echo</span> <span class="va">$BASHPID)</span></span>
<span id="cb237-8"><a href="#cb237-8"></a><span class="ex">10779</span></span>
<span id="cb237-9"><a href="#cb237-9"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ echo <span class="va">$(</span><span class="bu">echo</span> <span class="va">$BASHPID)</span></span>
<span id="cb237-10"><a href="#cb237-10"></a><span class="ex">10782</span></span></code></pre></div>
<p>The <code>$BASHPID</code> has a different value in subshells.</p>
<p>I personally like to use <code>$$</code> to make temporary files and directories. It’s useful for debugging running bash scripts and creating simple, unique files (note that using <code>mktemp</code> with proper options is actually a better solution).</p>
<h2 id="dos2unix-unix2dos">dos2unix unix2dos</h2>
<p>A long, long time ago, before standardization, there were multiple ways to mark a newline. It’s connected with how the teleprinters (btw TTY is a shortcut for teletype) work. There are two signals (symbols) that were used to make a new line. First one is LF (linefeed) that moves the paper one line up, the second symbol is the carriage return (CR) that returns the printer head to the start of a line. At some point in time, the OS designers must decide how to represent the new line in a text file. MS-DOS went with CR and LF when Unix used LF only. Windows inherited its newline format from MS-DOS and Linux inherited it from Unix. Because of that, to this day sometimes there is a need to change from one format to another. There are two minimalistic programs, <code>unix2dos</code> and <code>dos2unix</code> that change the newline format.</p>
<p>The installation on Enterprise Linux distrubtions 7 and 8 is as simple as</p>
<pre><code>sudo yum install -y dos2unix</code></pre>
<p>Now you can change the newline encoding with both <code>dos2unix</code> and <code>unix2dos</code>. Example below uses the <code>file</code> to determine current newline character/s</p>
<pre><code>$ echo &quot;Test&quot; &gt; test_file
$ file test_file 
test_file: ASCII text
$ unix2dos test_file 
unix2dos: converting file test_file to DOS format ...
$ file test_file 
test_file: ASCII text, with CRLF line terminators
$ dos2unix test_file 
dos2unix: converting file test_file to Unix format ...
$ file test_file 
test_file: ASCII text</code></pre>
<h2 id="get-ascii-asap">Get ASCII ASAP</h2>
<p>ASCII is an abbreviation of American Standard Code for Information Interchange. This is one of the oldest (older than my parents!) standards still in use. As you probably know, the ASCII is slowly replaced by Unicode, nevertheless, it’s still in use!</p>
<p>To get the ASCII table, with information about this standard, invoke:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb240-1"><a href="#cb240-1"></a><span class="fu">man</span> 7 ascii</span></code></pre></div>
<h2 id="set-bash-auto-log-out">Set Bash auto log out</h2>
<p>There is possibility to set up an automatic logout based on idle time. In other words, if there is a period without any action, the user is logged out. The variable responsible for it is “TMOUT”. For example, you can set it to 3600 seconds (exactly one hour) with the following script:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb241-1"><a href="#cb241-1"></a><span class="fu">grep</span> TMOUT ~/.bashrc <span class="kw">||</span> <span class="bu">echo</span> <span class="st">&quot;export TMOUT=3600&quot;</span> <span class="op">&gt;&gt;</span> ~/.bashrc</span>
<span id="cb241-2"><a href="#cb241-2"></a> <span class="bu">.</span> <span class="ex">~/.bashrc</span></span></code></pre></div>
<p>To test idle time log out, you can set it to something shorter, like 3 seconds:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb242-1"><a href="#cb242-1"></a>[<span class="ex">Alex@Normandy</span> ~]$ bash <span class="co"># start subshell</span></span>
<span id="cb242-2"><a href="#cb242-2"></a>[<span class="ex">Alex@Normandy</span> ~]$ TMOUT=3</span>
<span id="cb242-3"><a href="#cb242-3"></a>[<span class="ex">Alex@Normandy</span> ~]$ timed out waiting for input: auto-logout</span>
<span id="cb242-4"><a href="#cb242-4"></a>[<span class="ex">Alex@Normandy</span> ~]$ <span class="co"># Timed out to original shell after 3 seconds</span></span></code></pre></div>
<p>I highly recommend checking what will happen with a timeout when:</p>
<ul>
<li>There is a working process -ex. <code>TMOUT=3; tail -f /var/log/dmesg</code></li>
<li>There is working process in the background - ex. <code>TMOUT=3; tail -f /var/log/dmesg  &amp;</code></li>
</ul>
<h2 id="timeout-process">Timeout process</h2>
<p>Sometimes, some programs might take an entirely unpredicted time to complete. In most cases, it’s OK when the program finishes work faster than expected, and the problematic situation is when the program runs too long. For cases like this, there is a possibility to run a command with a time limit. There are multiple solutions to this problem, but my favourite is the <code>timeout</code> command from GNU Coreutils. Please look at the following listening.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb243-1"><a href="#cb243-1"></a>[<span class="ex">Alex@Normandy</span> BashBushido]$ timeout 5 sleep 7 <span class="kw">||</span> <span class="bu">echo</span> <span class="st">&quot;Sorry this failed&quot;</span></span>
<span id="cb243-2"><a href="#cb243-2"></a><span class="ex">Sorry</span> this failed</span></code></pre></div>
<p>In this example, we set a timeout to 5 seconds and run the program (<code>sleep</code>) that will sleep for 7 seconds before exiting. Because sleep was killed by <code>timeout</code>, and its return status was non-zero, the <code>echo "Sorry this failed"</code> was invoked.</p>
<p>Some of the useful timeout command options are:</p>
<ul>
<li><code>-s --signal=SIGNAL</code> - allows setting a specific signal on timeout.</li>
<li><code>--foreground</code> - used when a timeout is not run directly from a shell prompt (in other words timeout is used in the script).</li>
<li><code>--preserve-status</code> - returns status of a killed or signalled child.</li>
</ul>
<p>The duration itself might have the following units:</p>
<ul>
<li>s - seconds (the default)</li>
<li>m - minutes</li>
<li>h - hours</li>
<li>d - days</li>
</ul>
<p>So, following examples are valid:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb244-1"><a href="#cb244-1"></a><span class="ex">timeout</span> 20m /opt/backup/run.sh</span>
<span id="cb244-2"><a href="#cb244-2"></a><span class="ex">timeout</span> 2h /opt/backup/full.sh</span>
<span id="cb244-3"><a href="#cb244-3"></a><span class="ex">timeout</span> 1d /opt/backup/full_with_upload.sh</span></code></pre></div>
<p>There is also a possibility to set the time out to the time that is shorter than seconds:</p>
<pre><code>timeout 0.005 this_must_be_milenium_falcon_fast
timeout 0.05 this_must_be_really_really_fast
timeout 0.5 this_must_be_fast</code></pre>
<p>If command times out the <code>timeout</code> returns 124 as the exit status or the status of the signalled (SIGTERM is the default signal) child. Because timeout is part of the GNU project, more detailed information can be found in Coreutils info pages - <code>info timeout</code>.</p>
<h2 id="getting-my-current-ip">Getting my current IP</h2>
<p>There are web services allow you to get your external IP instantly. One that I’m using is <code>ifconfig.co</code>, others that I have heard of are and <code>ipinfo.io</code> and <code>ifconfig.me</code>. I’m quite sure that there are many more. The reason why I’m using ifconfig.co is simple - it’s open-sourced.</p>
<p>You can get your IP address with a simple <code>curl ifconfig.co</code>. Because I prefer getting more information in an easy-to-manipulate accessible format, the <code>curl ifconfig.co/json</code> suits me better. JSON can be nicely formatted with <code>python -m json.tool</code> or <code>jq</code>. Finally, the command that I use is <code>curl -s ifconfig.co/json | jq</code>. The <code>-s</code> flag makes the curl silent (no progress info). The whole command can be saved as more a accessible alias, for example - <code>my_ip</code>.</p>
<h2 id="audible-ping">Audible ping</h2>
<p>The <code>-a</code> flag makes the <code>ping</code> command audible. Note that <code>ping</code> uses a system beep. So, it must be enabled. The simplest test whether beep works is:</p>
<pre><code>echo -e &quot;\a&quot;</code></pre>
<p>If you heard the beep sound it means that the audible ping would work on your hardware &amp;&amp; software configuration.</p>
<p>Finally - example of an audible ping:</p>
<pre><code>ping -a 8.8.8.8</code></pre>
<h2 id="prettyping">PrettyPING</h2>
<p>The nicer version of the ping is prettyping. On Enterprise Linux and its clones, you can install it from the EPEL repository</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb248-1"><a href="#cb248-1"></a><span class="fu">sudo</span> yum install -y epel-release</span>
<span id="cb248-2"><a href="#cb248-2"></a><span class="fu">sudo</span> yum install -y prettyping</span></code></pre></div>
<p>Prettyping is a bash script that only needs reasonable modern bash, ping and awk - the things that probably every Linux distribution ships out of the box. The nicest thing about <code>prettyping</code> are bars showing the response time.</p>
<pre><code>[Alex@SpaceShip ~]$ prettyping 8.8.8.8
0 ▁ 10 ▂ 20 ▃ 30 ▄ 40 ▅ 50 ▆ 60 ▇ 70 █ 80 ▁ 90 ▂ 100 ▃ 110 ▄ 120 ▅
130 ▆ 140 ▇ 150 █ 160 ▁ 170 ▂ 180 ▃ 190 ▄ 200 ▅ 210 ▆ 220 ▇ 230 █ ∞
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
▅▃▃▃▃▃▃▃▃▃▄▃▄▅▃▄█▅▃▃▄▇▄▃▄▄▃▃▄▅▃▃▃▃▆▅▄▃▃▄▃▃▃▄▃▄▃▃▃▃▃▃▃▃▃▅▃▅▃▃▃▄▅▄▅▃▃▄▃
▃▄▃▃▃▄▃▃▃▄▃▃▄▄▆▃▃▃▄▃▃▃▅▃▇▃▅▇^C
 0/ 97 ( 0%) lost;   20/  31/  74ms; last:   63ms
 0/ 60 ( 0%) lost;   20/  30/  66/   7ms (last 60)
--- 8.8.8.8 ping statistics ---
97 packets transmitted, 97 received, 0% packet loss, time 96077ms
rtt min/avg/max/mdev = 20.536/31.181/74.924/11.175 ms</code></pre>
<p>As you can see at the end of the chart, I killed a process with <code>ctrl</code>+<code>c</code>.</p>
<p>The <code>prettyping</code> is a wrapper around the system ping. Its argument handling is quite clever. Because system ping supports only short parameters (like <code>-S</code>), the <code>prettyping</code> parameters are extended parameters like <code>--last</code>. The second group are short ping parameters handled by prettyping, these are <code>-a</code> (audible ping), <code>-f</code> (flood mode), <code>-q</code> (quiet mode), <code>-R</code> (record route) is BTW ignored or discarded by most hosts, and <code>-v</code> (verbose mode). The rest of the parameters is forwarded to ping as they are.</p>
<p>Following example with leverage <code>ping</code> <code>-c [number]</code> option/parameter.</p>
<pre><code>prettyping -c 10 8.8.8.8</code></pre>
<h2 id="multitail">multitail</h2>
<p>The tail is a program that is used to read the last lines of the file, it leverages lseek system call to make it fast. Another widespread usage of the tail is the follow mode, that literally follow changes appended to the file, in this case, the Linux io_watches and inotify system calls are used. Multitail is like a tail but on steroids - on tons of steroids (like professional cyclists)! On Enterprise Linux distributions, you can install it from the EPEL repository.</p>
<pre><code>sudo yum install -y epel-release
sudo yum install -y multitail</code></pre>
<p>The default mode for multitail is the “follow mode” that works similar to the normal <code>tail</code> in the same mode. But multitail has a lot more abilities, like splitting the terminal window into multiple subwindows that have chosen files/logs.</p>
<p>The most basic usage is to open multiple files with it:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb252-1"><a href="#cb252-1"></a><span class="ex">multitail</span> /var/log/audit/audit.log /var/log/dmesg /var/log/secure</span></code></pre></div>
<p>To get multiple columns, use the <code>-s NUMBER</code> option.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb253-1"><a href="#cb253-1"></a><span class="ex">multitail</span> -s 3 /var/log/audit/audit.log /var/log/dmesg /var/log/secure</span></code></pre></div>
<p>The most crucial <code>multitail</code> key bindings are:</p>
<ul>
<li><code>q</code> - quit - back to the previous window, quit the program if there aren’t any stacked windows.</li>
<li><code>ctrl</code>+<code>h</code> - Help (In many cases, F1 invokes terminal emulator HELP).</li>
<li><code>b</code> - scroll through the log. If multiple logs are currently followed, asks which window (log/logs) should be used.</li>
<li><code>gg</code> - scroll to the beginning of the file - NOTE that this is a typical <code>vim</code> shortcut</li>
<li><code>G</code> - scroll to the end of the file - NOTE that this is a typical <code>vim</code> shortcut</li>
<li><code>/</code> - search for string in the logs.</li>
<li><code>o</code> - clear the current window</li>
</ul>
<p>Multitail might also be used to merge multiple log files into one:</p>
<pre><code>sudo multitail -ci red /var/log/audit/audit.log  -ci yellow -I  /var/log/dmesg -ci blue -I  /var/log/secure</code></pre>
<p>It will merge three logs into one window. Additional option <code>-ci</code> is responsible for setting different colours (red, yellow, blue) for each log.</p>
<h2 id="quis-custodiet-ipsos-custodes">Quis custodiet ipsos custodes?</h2>
<p>This Latin phrase means - “Who watches the watchers?” There was a Star Trek episode with the same title :). But for me, the real underrated gem of cinema art is the <code>Watchmen</code> movie - even if you don’t like superheroes, you definitely should watch its intro. It tells more of a story than most movies I watched. But let’s return to our main topic - the <code>watch</code> command.</p>
<p>The <code>watch</code> is part of the <code>procps-ng</code> package that is part of the minimal installation. The command itself executes another (provided) command in the chosen intervals (default 2 seconds). For example, to watch the uptime command, we can use:</p>
<pre><code>watch uptime</code></pre>
<p>It should produce a quite similar output:</p>
<pre><code>Every 2.0s: uptime   Fri Dec 14 19:05:45 2018

 19:05:45 up  1:04,  4 users,  load average: 0.41, 0.44, 0.31</code></pre>
<p>that will be updated every two seconds.</p>
<p>Like nearly all Linux commands, the <code>watch</code> has a bunch of useful options:</p>
<ul>
<li><code>-n</code> or <code>--interval</code> changes the interval; the default is 2 seconds.</li>
<li><code>-d</code> or <code>--differences</code> differences between invocation have a different color.</li>
<li><code>-t</code> or <code>--no-title</code> doesn’t print the header (the first line contains `Every $TIME: $COMMAND $DATE" and newline).</li>
</ul>
<p>The minimal interval is <code>0.1</code>. You can try the following:</p>
<pre><code>watch -n 0.09 echo aaa
# OR
watch -n 0.0001 echo aaa</code></pre>
<p>But the interval will be set to 0.1.</p>
<p>After finding the smallest value, you can try to crash <code>watch</code> with huge integer :):</p>
<pre><code>watch -n 123908741320987412039478 echo aaa</code></pre>
<p>And to find out that the maximum interval is <code>4294967295</code>. What is equal to 2^32 - 1, so it’s an unsigned 32-bit integer. This number of seconds is more than 136 years, so it’s probably enough.</p>
<p>Knowing program limits, we can safely ask about the system load every 10 seconds:</p>
<pre><code>watch -n 10 cat /proc/loadavg </code></pre>
<p>That gives the following output:</p>
<pre><code>Every 10.0s: cat /proc/loadavg Fri Dec 14 19:26:51 2018

0.55 0.43 0.33 1/823 9371</code></pre>
<p>You can read more about /proc/loadavg in the <code>man proc</code> :).</p>
<p>To see the difference between the output of subsequent command executions, you can use the <code>-d</code> switch. The <code>date</code> is a perfect command to observe it.</p>
<pre><code>watch -n 1 -d date</code></pre>
<p>You can also invoke a watch without a title bar. It is useful if the command output is long and you want to save some space.</p>
<pre><code>watch -n 1 -t -d date</code></pre>
<p>With the <code>-g</code> option enabled watch can be used as a simple wait mechanism. On terminal one, start the process</p>
<pre><code>sleep 120</code></pre>
<p>On a separate terminal, find the PID of sleep.</p>
<pre><code>[Alex@Normandy 13-scripting]$ ps aux | grep &#39;[s]leep&#39;
Alex 29517  0.0  0.0 107960   712 pts/4    S+   15:29   0:00 sleep 120</code></pre>
<p>After finding it, the following watch can be used to start another program when the sleep ends (or it’s terminated).</p>
<pre><code>[Alex@Normandy 13-scripting]$ watch -g ps -P 29517 &amp;&amp; echo &quot;Sleep terminated&quot;
Sleep terminated</code></pre>
<p>Note that there is corner case when the new program takes the PID of watched program.</p>
<p>As always, I highly recommend the <code>watch</code> manual <code>man 1 watch</code> where you can find other useful options like <code>-e</code> (stops on an error and wait for user input to exit) and <code>-g</code> (Exit when the output of command changes).</p>
<h2 id="print-process-tree">Print Process tree</h2>
<p>Because each process (the exception is <code>init</code> the first process, nowadays mostly systemd, and some kernel-related processes like kthreadd) in Linux have PPID other than 0, the processes are in a hierarchy that can be visualized with specific directed acyclic graph. This graph is a tree where the root node is an init process. The relation between two nodes is based on the PPID of children and the PID of the parent. In Linux/Unix, there is a small program called <code>pstree</code> that prints the process tree. Some of the features of <code>pstree</code> include changing the output format. The first curious is that <code>pstree</code> format might be Unicode or ASCII - and it’s based on the <code>LANG</code> environment variable. ASCII:</p>
<pre><code>[Alex@SpaceStation ~]$ LANG=C pstree 
...
        |-tuned---4*[{tuned}]
        |-udisksd---4*[{udisksd}]
        |-upowerd---2*[{upowerd}]
        |-wpa_supplicant
        `-xdg-permission----2*[{xdg-permission-}]</code></pre>
<p>Unicode:</p>
<pre><code>[Alex@SpaceStation ~]$ LANG=en_US.UTF-8 pstree
        ├─tuned───4*[{tuned}]
        ├─udisksd───4*[{udisksd}]
        ├─upowerd───2*[{upowerd}]
        ├─wpa_supplicant
        └─xdg-permission-───2*[{xdg-permission-}</code></pre>
<p>On modern computers, the UTF-8 is supported by default. The next curious thing is that if pstree is piped, the <code>ASCII</code> format will be used. The format can be forced with <code>-A</code> options for ASCII and <code>-U</code> for Unicode. There are also two switches that you can find useful - one is <code>g</code> so its print won’t compact process groups:</p>
<pre><code>[Alex@SpaceStation ~]$ pstree
...
            └─xdg-permission-───2*[{xdg-permission-}</code></pre>
<p>Will become:</p>
<pre><code>[Alex@SpaceStation ~]$ pstree -g
...
           └─xdg-permission-(2442)─┬─{xdg-permission-}(2442)
                                   └─{xdg-permission-}(2442)</code></pre>
<p>There are also a <code>-Z</code> or <code>--security-context</code> flags that enable SELinux security context printing:</p>
<pre><code>[Alex@SpaceStation ~]$ pstree -g -Z 
...
 └─xdg-permission-(2442,`unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&#39;)
    ├─{xdg-permission-}(2442,`unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&#39;)
    └─{xdg-permission-}(2442,`unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&#39;)</code></pre>
<h2 id="imagemagick---convert-image">ImageMagick - convert image</h2>
<p>The ImageMagick is the project that allows manipulating, editing, displaying and even creating images. The package name is unusual because it has uppercase letters. To install ImageMagic on EL7 systems invoke:</p>
<pre><code>sudo yum install -y ImageMagick</code></pre>
<p>After installation, there is the <code>display</code> command that allows you to graphically edit, add an effect, crops, rotate, etc. images. I won’t recommend it because <code>gimp</code> and <code>krita</code> are better by far. My favourite ImageMagick command is <code>convert</code>, that, well, allows converting images from one format to another. The first simple trick with ImageMagick is changing the image format:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb272-1"><a href="#cb272-1"></a><span class="ex">convert</span>  myimage.png myimage.jpg</span></code></pre></div>
<h3 id="compress-image-with-imagemagick">Compress Image with ImageMagick</h3>
<p>To compress an image you can use the following code snippet, it’s based on a quick StackOverflow research.</p>
<pre><code>convert orginal.jpg -strip -sampling-factor 4:2:0 -quality 80 -interlace JPEG -colorspace RGB compressed.jpg</code></pre>
<h3 id="resize-image-with-imagemagick">Resize Image with ImageMagick</h3>
<p><code>convert</code> command can also be used to resize images:</p>
<pre><code>convert huge_image.png -resize 500x500 resized_image.png</code></pre>
<p>By default, <code>convert</code> will keep the image ratio, to change this behaviour add <code>!</code> to the resized size.</p>
<pre><code>convert huge_image.png -resize 500x500\! resized_image.png</code></pre>
<p>The backslash is used to escape <code>!</code> so it won’t be interpreted as the event designator.</p>
<h3 id="make-a-gif">make a gif</h3>
<p>Sometimes when you have multiple similar images (like terminal screenshots), you might want to make a gif image. I used to make gifs that way, now I’m just recording whole terminal session with OBS. In the example below, the .png files should have a name that are alphanumerically sorted, for example, 001.png 002.png etc.</p>
<pre><code>convert -delay 80 -loop 0 *.png my.gif</code></pre>
<h2 id="merge-multiple-pdfs-into-one.">Merge multiple pdfs into one.</h2>
<p>This one is inspired by my Mother, that seldom but regularly asks me about merging multiple pdfs into one. There are numerous online solutions, but the problem with most of them is the quality of the merged pdf. Fortunately, there is a program that is made and designed for manipulating PostScript and PDF files - Ghostscript - <code>gs</code>. You might wonder why I won’t just make a simple web service that can automate this, so my mom can do it by herself. Well, this is not about the pdfs, it’s about my mother’s smile whenever I gave her a Pendrive with “magically” merged pdf.</p>
<figure>
<img src="images/13-scripting/feel_bird.jpg" alt="" /><figcaption>Fell Bird MEME</figcaption>
</figure>
<p>Going back from feels to BB - In order to merge multiple pdfs into an <strong>output.pdf</strong> file, you can use:</p>
<pre><code>gs -dBATCH -dNOPAUSE -q -sDEVICE=pdfwrite -sOutputFile=out.pdf file1.pdf file2.pdf file3.pdf ...</code></pre>
<p>If you would like to know more about <code>gs</code> as always much more can be found in manual <code>man 1 gs</code> and the Internet.</p>
<h2 id="cp-bak-and-mv-.new">cp {,bak} and mv {,.new}</h2>
<p>It’s always a good idea to make backups when editing an important system setting file. It can be achieved on multiple levels. For example, VM can be snapshotted or cloned. But a simpler solution ad-hoc solution is to make backup file. In this case, shell expansion comes in handy. For example, before editing fstab, you can invoke:</p>
<pre><code>cp /etc/fstab{,.bak}</code></pre>
<p>Now even if you mess up the configuration, you can safety revert to the previous file with:</p>
<pre><code>mv /etc/fstab{.bak,}</code></pre>
<p>The very same trick can be used to add an expansion to the file. For example, many repos have README written in markdown without an explicit Markdown expansion. The same trick can be used to fix that small mistake.</p>
<pre><code>mv README{,.md}</code></pre>
<h2 id="du-and-ncdu">du and ncdu</h2>
<p>To obtain information about disk usage, and how much data does the chosen directory keep, most people use <code>du</code> program. <code>du</code> is part of <code>coreutils</code>, so it’s installed on nearly all Linux systems. Without any arguments, it will show the summarized size recursively for directories.</p>
<p>The most common and useful flags include:</p>
<ul>
<li><code>-a</code> - shows size for each file, not summarized directories.</li>
<li><code>-h</code> - human-readable size. For example, instead of <code>4405312</code> you get nice <code>4.3G</code>.</li>
<li><code>-s</code> - summarize the size of each argument (useful for dirs).</li>
<li><code>-x</code> - Only one filesystem. Helpful when you have multiple filesystems mounted. In some cases (ex. slow network filesystem that we don’t want to calculate), it’s a huge timesaver.</li>
<li><code>-d</code> - set max recurse depth.</li>
</ul>
<p>A sample usage:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb281-1"><a href="#cb281-1"></a>[<span class="ex">root@SpaceShip</span> ~]# du -sh /b*</span>
<span id="cb281-2"><a href="#cb281-2"></a><span class="ex">0</span>   /bin</span>
<span id="cb281-3"><a href="#cb281-3"></a><span class="ex">252M</span>    /boot</span>
<span id="cb281-4"><a href="#cb281-4"></a><span class="ex">564M</span>    /boxes</span>
<span id="cb281-5"><a href="#cb281-5"></a><span class="ex">18G</span> /build</span></code></pre></div>
<p>The <code>/bin</code> directory is 0 because it is symlink to <code>/usr/bin/</code></p>
<p>The interactive version for <code>du</code> is <code>ncdu</code>. It’s NCurses (the most popular library for making terminal interactive programs) based program that allows you to count and manage the files interactively. Installation on Enterprise Linux distributions requires the EPEL repository:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb282-1"><a href="#cb282-1"></a><span class="fu">sudo</span> yum install -y epel-release</span>
<span id="cb282-2"><a href="#cb282-2"></a><span class="fu">sudo</span> yum install -y ncdu</span></code></pre></div>
<p>Then we can simply invoke ncdu</p>
<pre><code>[Alex@SpaceShip ~]$ ncdu</code></pre>
<figure>
<img src="images/13-scripting/nc_du.png" alt="" /><figcaption>NCourses Disk Usage - NCDU </figcaption>
</figure>
<p>The <code>/</code> before name distinguish directories from regular files. One of the most nicest features of ncdu are vim-like bindings.</p>
<p>The most important keys include:</p>
<ul>
<li><code>?</code> - invokes help.</li>
<li><code>j</code> or <code>down arrow</code> - move the cursor down.</li>
<li><code>k</code> or <code>up arrow</code> - move the cursor up.</li>
<li><code>h</code> or l<code>eft arrow</code> - open parent directory.</li>
<li><code>l</code> or r<code>ight arrow</code> or <code>enter</code> - open selected a directory (do nothing on files). Note that <code>l</code> navigation is not listed in in-program help, but it’s mentioned in <code>man</code> pages at least for the 1.13 version.</li>
<li><code>d</code> - delete the selected file or directory.</li>
</ul>
<p>Mnemonics: - <code>du</code> - <code>d</code>isk <code>u</code>sage - <code>ncdu</code> - <code>nc</code>urser <code>d</code>isk <code>u</code>sage</p>
<h2 id="pv---pipe-viewer.">pv - Pipe Viewer.</h2>
<p>One of the most irritating things about pipes is the fact that it might be hard to find out how fast/how much data goes through it. Of course, in many cases, it’s possible to determine the speed, especially for I/O heavy pipes. Programs like <code>iotop</code> or <code>iostat</code> might help determine how many read/writes are going on the disks, what could be a great estimation. But compute-heavy pipes might be much harder to monitor.</p>
<p>One of the solutions to this problem is <code>pv</code> command that allows to observe how much data is going through the pipe. For Enterprise Linux Distributions you can find <code>pv</code> in the EPEL repository.</p>
<pre><code>sudo yum install -y epel-release 
sudo yum install -y pv</code></pre>
<p>Now imagine a real-life example - copy the image to make it a bootable usb stick. Normally the <code>dd</code> is the default solution.</p>
<pre><code>dd if=/home/Alex/Downloads/EuroLinux.6.10-DVD-x86_64-2018-07-25.iso of=/dev/sdc bs=4M conv=fsync</code></pre>
<p>Unfortunately out of the box it won’t print the status, in newer versions, there is the <code>status=</code> option that can also print status/speed of dd. But there is a <strong>generic</strong> solution - <code>pv</code>.</p>
<pre><code>dd if=/home/Alex/Downloads/EuroLinux.6.10-DVD-x86_64-2018-07-25.iso | pv | dd  of=/dev/sdc bs=4M conv=fsync
1.3GiB 0:00:36 [   34 MB/s] [            &lt;=&gt;              ]</code></pre>
<p>It’s also possible to read file with pv and redirect it.</p>
<pre><code>[root@SpaceShip ~]# pv /home/Alex/Downloads/EuroLinux.6.10-DVD-x86_64-2018-07-25.iso &gt; /dev/sdc 
 153MiB 0:00:14 [8.53MiB/s] [===&gt;                                                                                                 ]  4% ETA 0:05:26</code></pre>
<p>I could provide more examples, but let’s be frank - as always with pipes, rediretions and process substitutions - the sky is the limit.</p>
<h2 id="what-is-happening-why-does-it-take-so-long-what-is-progress">What is happening? Why does it take so long? What is PROGRESS?</h2>
<p>Regularly, when you invoke some long-time commands - you would like to know if they are really working. Look into the following example.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb288-1"><a href="#cb288-1"></a><span class="fu">rsync</span> -pa root@repohost:/build/repo/my_linux/6.10 /tmp_repos/</span></code></pre></div>
<p>After invoking rsync like this, you are blind (ofc - you can add the <code>-P</code> flag that will add the progress of every single file). There is a natural, friendly and neat way to look at coreutils (and more) programs progress called - surprise, surprise <code>progress</code>! Progress program is packed by nux-desktop repository/community. It can be found at GitHub - https://github.com/Xfennec/progress, the compilation and installation process is extremely easy.</p>
<p>Some old distros might have a similar command <code>cv</code>. To get the list of commands that <code>progress</code> will look for by default, invoke <code>progress</code> without any cp, rsync etc. running.</p>
<pre><code>[root@Normandy ~]# progress
No command currently running: cp, mv, dd, tar, cat, rsync, grep, fgrep, egrep, cut, sort, md5sum, sha1sum, sha224sum, sha256sum, sha384sum, sha512sum, adb, gzip, gunzip, bzip2, bunzip2, xz, unxz, lzma, unlzma, zcat, bzcat, lzcat, or wrong permissions.</code></pre>
<p>The same goes for <code>cv</code>:</p>
<pre><code>[root@Normandy ~]# cv
No command currently running: cp, mv, dd, tar, gzip, gunzip, cat, grep, cut, sort, exiting.</code></pre>
<p>As you can see, the <code>progress</code> is actually much more developed. The next example was made with rsync running on a different session.</p>
<pre><code>[Alex@SpaceShip tmp]$ progress
[26446] rsync /tmp_repos/6.10/x86_64/os-dupes/Packages/.PyQt4-devel-4.6.2-9.el6.x86_64.rpm.BzA8KB
    100.0% (6 MiB / 6 MiB)</code></pre>
<p>Another example with sha256sum.</p>
<pre><code>[Alex@SpaceShip tmp]$ sha256sum *iso &gt; sha256sum.txt &amp;
[1] 27824
[Alex@SpaceShip tmp]$ progress
[27824] sha256sum /home/Alex/workspace/tmp/EL-7.5-x86_64-pre-baked-beta.iso
    75.7% (686.0 MiB / 906 MiB)</code></pre>
<p>Some useful options/flags/switches (the descriptions are taken from <code>progress</code> manual pages):</p>
<ul>
<li><code>-m</code> or <code>--monitor</code> - loop while the monitored processes are still running</li>
<li><code>-c</code> or <code>--command</code> - monitor only this command name (e.g.: firefox). This option can be used multiple times.</li>
<li><code>-p</code> or <code>--pid</code> - monitor only this numeric process ID (e.g.: <code>pidof firefox</code>). This option can be used multiple times.</li>
</ul>
<p>To watch what files does Apache web server( httpd in Enterprise Linux) is accessing you can use:</p>
<pre><code>progress -mc httpd</code></pre>
<p>Monitor mode is quite similar to <code>watch</code> + <code>progress</code> like <code>watch progress -c httpd</code>.</p>
<h2 id="control-sound-system-from-cli">Control sound system from CLI</h2>
<p>To control the parts of the sound system from the command line, you can use <code>alsamixer</code> program. Because <code>alsamixer</code> likes to start with the “default” sound card, the first thing that I propose is selecting the proper sound card with <code>F6</code> key. The rest of the navigation is considerably easy - navigate and control the sound level with arrows. Because the <code>F1</code> key is likley bind to terminal emulator help, there is a secondary help key - the <code>h</code> key.</p>
<p>There is not much more to describe because everything is… self-descriptive! The program is also discoverable. But there is one thing I particularly like, and that is the ability to manage the sound level of the left/right channel. It is nothing special, but most GUI programs have it broken or even not implemented :).</p>
<h2 id="mailing-from-a-script">Mailing from a script</h2>
<p>SMTP is a simple protocol, so simple that it’s broken in multiple places. It’s regularly exploited by spammers. Wrongly configured mail server can allow getting mail from any (even unauthorized) domain. SMTP doesn’t require an authorization, but the e-mail will likely land in the spam folder ;). The most straightforward script for mailing is made of <code>cat</code> reading the file piped to the <code>mail</code> command. <code>mail</code> program is part of the <code>mailx</code> package that is available in the standard repository.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb294-1"><a href="#cb294-1"></a>$ <span class="fu">sudo</span> yum install -y mailx</span></code></pre></div>
<p>Sample mailing with subject “My Daemon Log” to “my.email@example.com”:</p>
<pre><code>$ cat /var/log/my_deamon.log | mail -s &quot;My Daemon Log.&quot; my.email@example.com</code></pre>
<p>For secure and reliable message delivery, you should use dedicated solutions, like the python script using the library that can safely connect to Gmail or different email provider or properly configured <code>mail</code> so it uses real account.</p>
<h2 id="generate-random-passwords-with-openssl">Generate random passwords with OpenSSL</h2>
<p>Generating a random password is quite easy - use a good random number generator (that part is hard!), then create a password. There is specialized program called <code>pwgen</code> that generate random passwords, but I prefer a more straightforward solution with that leverage standard <code>openssl</code>.</p>
<pre><code>openssl rand -base64 $NUMBER</code></pre>
<p>Where <code>$NUMBER</code> is the number of random bytes. Note that Base64 encoding breaks data into 6-bit segments, and SSL returns the 8-bit characters. Other rules can make the string a little bit longer. Finally, the password will be about one and one-third of the original number. Because Base 64 uses lowercase, uppercase, digits and special characters <code>+</code>, <code>/</code> and <code>=</code> that is also used as a pad. Pad is used when the last part (called segment) doesn’t contain all 6 bits.</p>
<h2 id="lsof">lsof</h2>
<p>lsof is an abbreviation of <code>LiSt Open Files</code>. This little program is frequently used when you want to know which process has an open descriptor to file. It’s handy when unmounting USB drives, other filesystems, or finding deleted files that take space even though they are deleted (Linux doesn’t free the space taken by a file as long as there is an open file descriptor to it). To list processes that have an open files in the filesystem, use:</p>
<pre><code>lsof /mount/point
# I have a separate filesystem on home
lsof /home</code></pre>
<p>To list processes that use the chosen file, for example,/dev/urandom - the kernel’s random number generator, use:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb298-1"><a href="#cb298-1"></a><span class="ex">lsof</span> /dev/urandom</span></code></pre></div>
<p>To list files opened by the selected user, you can add <code>-u</code> option with the username:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb299-1"><a href="#cb299-1"></a><span class="ex">lsof</span> -u Alex</span>
<span id="cb299-2"><a href="#cb299-2"></a><span class="ex">COMMAND</span>    PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span>
<span id="cb299-3"><a href="#cb299-3"></a><span class="ex">gnome-she</span> 3658 Alex   33r   CHR    1,9      0t0 7190 /dev/urandom</span>
<span id="cb299-4"><a href="#cb299-4"></a><span class="ex">gnome-she</span> 3658 Alex   35r   CHR    1,9      0t0 7190 /dev/urandom</span>
<span id="cb299-5"><a href="#cb299-5"></a><span class="co">#(output truncated)</span></span></code></pre></div>
<p>To list files opened by selected PID - use ’-p`. The example with current Bash PID:</p>
<pre><code>[Alex@SpaceShip BashBushido]$ lsof -p $$
COMMAND   PID USER   FD   TYPE DEVICE  SIZE/OFF      NODE NAME
bash    11102 Alex  cwd    DIR  253,2       181  67785600 /home/Alex/Documents/BashBushido
bash    11102 Alex  rtd    DIR  253,0      4096        64 /
bash    11102 Alex  txt    REG  253,0    960504    230827 /usr/bin/bash
...</code></pre>
<p>To list files opened by selected process name, use the <code>-c</code> option. The important note about the <code>-c</code> is that it looks for a process that <strong>starts</strong> with a given string. So, for example <code>-c b</code> might include <code>bash</code>, <code>bioset</code> and <code>bluetooth</code>.</p>
<p>Example with files opened by the <code>bluetooth</code> process:</p>
<pre><code>[root@SpaceShip ~]# lsof -c bluetooth
COMMAND    PID USER   FD      TYPE             DEVICE SIZE/OFF      NODE NAME
bluetooth 3678 root  cwd       DIR              253,0     4096        64 /
bluetooth 3678 root  rtd       DIR              253,0     4096        64 /
bluetooth 3678 root  txt       REG              253,0  1017064   1015090 /usr/libexec/bluetooth/bluetoothd
bluetooth 3678 root  mem       REG              253,0    91256 271371748 /usr/lib64/libudev.so.1.6.2
...</code></pre>
<p>To list Internet network files on your computer, use the <code>-i</code> option:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb302-1"><a href="#cb302-1"></a>[<span class="ex">root@SpaceShip</span> ~]# lsof -i</span>
<span id="cb302-2"><a href="#cb302-2"></a><span class="ex">COMMAND</span>     PID       USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span>
<span id="cb302-3"><a href="#cb302-3"></a><span class="ex">chronyd</span>    1009     chrony    1u  IPv4  22632      0t0  UDP localhost:323 </span>
<span id="cb302-4"><a href="#cb302-4"></a><span class="ex">chronyd</span>    1009     chrony    2u  IPv6  22633      0t0  UDP localhost:323</span>
<span id="cb302-5"><a href="#cb302-5"></a><span class="ex">...</span></span></code></pre></div>
<p>To see what processes use the selected port, you can use the <code>-i</code> option with <code>[protocol]:port_number</code> argument. Example with Nginx web server listening on 443:</p>
<pre><code>[root@wserv1 ~]# lsof -i :443
COMMAND  PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
nginx   2613 nginx    8u  IPv4  11767      0t0  TCP *:https (LISTEN)
nginx   2616 nginx    8u  IPv4  11767      0t0  TCP *:https (LISTEN)
...
...</code></pre>
<p>Note that multiple instances of Nginx can listen on of the same port due to SO_REUSEPORT capability that was introduced in Linux 3.9.</p>
<h2 id="yes">YES!</h2>
<p>Unix (and Unix-like OS - Linux) is a fascinating system. Nearly 20 years ago, Terry Lamber, one of FreeBSD developer, wrote the great truth about it:</p>
<pre><code>If you aim the gun at your foot and pull the trigger, it&#39;s UNIX&#39;s job to ensure
reliable delivery of the bullet to where you aimed the gun (in this case, Mr.
Foot).</code></pre>
<p>You can find it in the mailing.freebsd.hackers archive - https://groups.google.com/forum/#!forum/mailing.freebsd.hackers</p>
<p>So, following the third rule of sudo - “With great power comes great responsibility”, administrators intentionally read the configuration that set prompting before every file-destructive operation.</p>
<p>In Enterprise Linux distributions - you can find the following lines in <code>/root/.bashrc</code>.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb305-1"><a href="#cb305-1"></a><span class="bu">alias</span> rm=<span class="st">&#39;rm -i&#39;</span></span>
<span id="cb305-2"><a href="#cb305-2"></a><span class="bu">alias</span> cp=<span class="st">&#39;cp -i&#39;</span></span>
<span id="cb305-3"><a href="#cb305-3"></a><span class="bu">alias</span> mv=<span class="st">&#39;mv -i&#39;</span></span></code></pre></div>
<p>Fortunately, you can override any of this with <code>-f</code> or <code>--force</code> flag. But not all commands have this type of conveniences. In cases like that, you can use the <code>yes</code> command.</p>
<p>from coreutils info pages</p>
<pre><code>&#39;yes&#39; prints the command line arguments, separated by spaces and
followed by a newline, forever until it is killed.  If no arguments are
given, it prints &#39;y&#39; followed by a newline forever until killed.</code></pre>
<p>Example:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb307-1"><a href="#cb307-1"></a>[<span class="ex">Alex@SpaceShip</span> BashBushido]$ yes</span>
<span id="cb307-2"><a href="#cb307-2"></a><span class="ex">y</span></span>
<span id="cb307-3"><a href="#cb307-3"></a><span class="ex">y</span></span>
<span id="cb307-4"><a href="#cb307-4"></a><span class="ex">...</span> <span class="co"># Hundreds of y</span></span>
<span id="cb307-5"><a href="#cb307-5"></a><span class="ex">y</span></span>
<span id="cb307-6"><a href="#cb307-6"></a><span class="ex">y</span></span>
<span id="cb307-7"><a href="#cb307-7"></a>^<span class="ex">C</span> <span class="co"># here I killed it</span></span></code></pre></div>
<p>So for example, when using rm, instead of using <code>-f</code> flag, the following will produce the same result:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb308-1"><a href="#cb308-1"></a><span class="co"># Secret bitcoin mining script</span></span>
<span id="cb308-2"><a href="#cb308-2"></a><span class="fu">yes</span> <span class="kw">|</span> <span class="fu">rm</span> -r /*</span></code></pre></div>
<p>You can change user password with the following script:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb309-1"><a href="#cb309-1"></a><span class="va">my_pass=$(</span><span class="ex">pwgen</span> -s 20 1<span class="va">)</span></span>
<span id="cb309-2"><a href="#cb309-2"></a> <span class="fu">yes</span> <span class="va">$my_pass</span> <span class="kw">|</span> <span class="fu">passwd</span> user</span></code></pre></div>
<p>Note that there is a space character before <code>yes $my_pass</code>. It’s because we don’t want it to be saved to the history (<a href="##%20Controlling%20what%20the%20history%20should%20forget">Controlling what the history should forget</a>])</p>
<p>Lastly I would like to deal with some moronic information I found on the Internet during my “research” (“duckduckgoing” and “googling” is considered research nowadays). <code>yes</code> command is <strong>NOT</strong> the right way to benchmark a single thread of the processor, even if <code>yes &gt; /dev/null</code> can take up to 100% of a single core, it won’t measure anything useful.</p>
<h2 id="tee---split-the-output.">Tee - split the output.</h2>
<p>In many cases, when you invoke the command, you want to get an output of the invoked command and put that into the log at the same time. In cases like these, <code>tee</code> command is the answer to your thoughts and prayers.</p>
<p>From tee info pages:</p>
<pre><code>The &#39;tee&#39; command copies standard input to standard output and also to
any files given as arguments.  This is useful when you want not only to
send some data down a pipe, but also to save a copy.</code></pre>
<p>For example, to start the application server and have a log with a date, use:</p>
<pre><code>[Alex@SpaceShip bin]$ ./standalone.sh | tee log-$(date +%F-%T).log</code></pre>
<p>There is also a possibility to get quite the same result in a different way:</p>
<pre><code>my_log=log-$(date +%F-%T).log
./start_app_server.sh &amp;&gt; $my_log &amp;; tail -f $my_log</code></pre>
<p>This is an acceptable solution, of course there are slight differences - we put ./start_app_server.sh in the background and there is a slight possibility that tail won’t catch the very beginning of a log. The real power of <code>tee</code> is the ability to get sub results or put a copy of the output into multiple processes. Look into following example:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb313-1"><a href="#cb313-1"></a><span class="va">my_grep1=</span><span class="st">&#39;grep -v &quot;^#&quot;&#39;</span></span>
<span id="cb313-2"><a href="#cb313-2"></a><span class="va">my_grep2=</span><span class="st">&#39;grep -i &quot;IP:&quot;&#39;</span></span>
<span id="cb313-3"><a href="#cb313-3"></a><span class="va">my_grep3=</span><span class="st">&#39;grep &quot;8\.8\.8\.8&quot;&#39;</span></span>
<span id="cb313-4"><a href="#cb313-4"></a><span class="fu">cat</span> huge_logfile <span class="kw">|</span> <span class="va">$my_grep1</span> <span class="kw">|</span> <span class="fu">tee</span> grep1.log <span class="kw">|</span> <span class="va">$my_grep2</span> <span class="kw">|</span> <span class="fu">tee</span> grep2.log <span class="kw">|</span> <span class="va">$my_grep3</span> <span class="kw">|</span> <span class="fu">tee</span> -a final_ip </span></code></pre></div>
<p>These pipe commands can be optimized by removing the cat. As you can see, the <code>tee</code>s save subresults of the next grep in separate files. The final <code>tee</code> results is appended the to <code>final_ip</code> file.</p>
<p>The <code>info coreutils 'tee invocation'</code> gives us another great example:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb314-1"><a href="#cb314-1"></a>  <span class="fu">wget</span> -O - http://example.com/dvd.iso \</span>
<span id="cb314-2"><a href="#cb314-2"></a>       <span class="kw">|</span> <span class="fu">tee</span> <span class="op">&gt;(</span><span class="ex">sha1sum</span> <span class="op">&gt;</span> dvd.sha1<span class="op">)</span> <span class="op">&gt;(</span><span class="ex">md5sum</span> <span class="op">&gt;</span> dvd.md5<span class="op">)</span> <span class="op">&gt;</span> dvd.iso</span></code></pre></div>
<p>In that case, we put wget output to stdout with <code>-O -</code>, then pipe it to <code>tee</code> that split our output to new processes (process substitution) and finally saved it to the dvd.iso file. Note that this is parallel, so it’s faster than downloading and then computing sums.</p>
<p>The most useful option of <code>tee</code> is <code>-a</code> or <code>--append</code>. If the file exists, it’s not overwritten but appended. The last widespread usage of <code>tee</code> is combining it with sudo. Try the following example:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb315-1"><a href="#cb315-1"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo <span class="st">&quot;export EDITOR=vim&quot;</span> <span class="op">&gt;&gt;</span> /etc/bashrc</span>
<span id="cb315-2"><a href="#cb315-2"></a><span class="ex">bash</span>: /etc/bashrc: Permission denied</span>
<span id="cb315-3"><a href="#cb315-3"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ sudo echo <span class="st">&quot;export EDITOR=vim&quot;</span> <span class="op">&gt;&gt;</span> /etc/bashrc</span>
<span id="cb315-4"><a href="#cb315-4"></a><span class="ex">bash</span>: /etc/bashrc: Permission denied</span>
<span id="cb315-5"><a href="#cb315-5"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ echo <span class="st">&quot;export EDITOR=vim&quot;</span> <span class="kw">|</span> <span class="fu">sudo</span> tee -a /etc/bashrc</span>
<span id="cb315-6"><a href="#cb315-6"></a><span class="bu">export</span> <span class="va">EDITOR=</span>vim</span>
<span id="cb315-7"><a href="#cb315-7"></a>[<span class="ex">Alex@SpaceShip</span> ~]$ tail -1 /etc/bashrc</span>
<span id="cb315-8"><a href="#cb315-8"></a><span class="bu">export</span> <span class="va">EDITOR=</span>vim</span></code></pre></div>
<h2 id="script-save-the-output-of-the-terminal-session."><code>Script</code> save the output of the terminal session.</h2>
<p>Sometimes, I have to make a quick setup, that because of limited time, etc. is not saved to an automation platform (chef, puppet, ansible, salt). In cases like these, the <code>script</code> command is an invaluable help. The <code>script</code> makes <strong>typescript</strong> of the session that allows me to make some documentation after the installation/fix. Simple example below</p>
<pre><code>[root@SpaceShip ~]# script my_script
Script started, file is my_script
[root@SpaceShip ~]# echo &quot;this is inside script&quot;
this is inside script
[root@SpaceShip ~]# exit
Script done, file is my_script
[root@SpaceShip ~]# cat my_script
Script started on Fri 17 Aug 2018 01:06:24 PM CEST
[root@SpaceShip ~]# echo &quot;this is inside script&quot;
this is inside script
[root@SpaceShip ~]# exit
Script done on Fri 17 Aug 2018 01:06:31 PM CEST
[root@SpaceShip ~]#</code></pre>
<p>According to <code>man</code>, <code>script</code> might be useful for students (proof of assignment). As said before, documentation (typescript) can also be helpful when making some plays, cookbooks or dull bash script that allows automating the task and scale the previously invoked steps. The similar effect can be achieved with <code>Terminator</code> and starting logger - you can find more about the Terminator in the <a href="TERMINATOR%20make%20terminal%20grid%20again!">## TERMINATOR make terminal grid again!</a>.</p>
<h2 id="cat-as-a-simple-text-editor">Cat as a simple text editor?</h2>
<p>Not so many people know that cat is an abbreviation of concatenating, that is an operation of putting two or more strings together. It’s an essential operation in the formal language theory. Cat with redirection can also be used to write to file.</p>
<p>You can invoke the cat with an output redirect to file, then type the desired content, and finally, use <code>ctrl</code> + <code>d</code> (^d). That will send <code>End-of-file</code> (<code>EOF</code>):</p>
<pre><code>[Alex@SpaceShip BashBushido]$ cat &gt; x
This is Bash Bushido
This is BB
I will quit with CTRL+D
[Alex@SpaceShip BashBushido]$ cat x
This is Bash Bushido
This is BB
I will quit with CTRL+D
[Alex@SpaceShip BashBushido]$</code></pre>
<p>You can make some simple configuration scripts, that will use <code>cat</code> to write the desired files. Look at this example:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb318-1"><a href="#cb318-1"></a><span class="va">FULL_VER=$(</span><span class="fu">grep</span> -o <span class="st">&quot;[0-9].[0-9]*&quot;</span> /etc/system-release<span class="va">)</span></span>
<span id="cb318-2"><a href="#cb318-2"></a><span class="fu">cat</span> <span class="op">&lt;&lt; EOF</span> <span class="op">&gt;</span> <span class="ex">/etc/yum.repos.d/my_repo.repo</span></span>
<span id="cb318-3"><a href="#cb318-3"></a>[my_repo]</span>
<span id="cb318-4"><a href="#cb318-4"></a>name= My repo</span>
<span id="cb318-5"><a href="#cb318-5"></a>baseurl=http://0.0.0.0//<span class="va">${FULL_VER}</span>/x86_64/<span class="op">o</span><span class="ex">s/</span></span>
<span id="cb318-6"><a href="#cb318-6"></a>enabled=1</span>
<span id="cb318-7"><a href="#cb318-7"></a>gpgcheck=0</span>
<span id="cb318-8"><a href="#cb318-8"></a>EOF</span></code></pre></div>
<p>Important note - if you are using cat this way, you shouldn’t indent file code, in other case it will contain indentation characters.</p>
<h2 id="reset-your-terminal">Reset your terminal</h2>
<p>Sometimes after reading a binary file, your console or Bash might get devasted. Some characters will be missing, others will be printed in an unpredictable manner, etc. To get your session back on tracks, use a simple <code>reset</code>. According to The Internet “it’s not a miracle solution”, but it never failed me. The funny thing is that <code>reset</code> is a symbolic link to the <code>tset</code> program. But invoking <code>tset</code> without any argument won’t reset terminal. So, logical conclusion is that tset must check if it’s started/invoked as a <code>reset</code> command.</p>
<p>After checking sources of ncurses 5.9 (used in Enterprise Linux 7), there is this part of code in file <code>/progs/tset.c</code>.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb319-1"><a href="#cb319-1"></a><span class="co">// flag</span></span>
<span id="cb319-2"><a href="#cb319-2"></a><span class="dt">static</span> <span class="dt">bool</span> isreset = FALSE;    <span class="co">/* invoked as reset */</span></span>
<span id="cb319-3"><a href="#cb319-3"></a><span class="co">// More code</span></span>
<span id="cb319-4"><a href="#cb319-4"></a><span class="co">// in int main you can find following</span></span>
<span id="cb319-5"><a href="#cb319-5"></a>    <span class="cf">if</span> (same_program(_nc_progname, PROG_RESET)) {</span>
<span id="cb319-6"><a href="#cb319-6"></a>    isreset = TRUE;</span>
<span id="cb319-7"><a href="#cb319-7"></a>    reset_mode();</span>
<span id="cb319-8"><a href="#cb319-8"></a>    }</span></code></pre></div>
<h2 id="resolve-symbolic-links">Resolve symbolic links</h2>
<p>Sometimes you might want to get the real (physical) path that you are currently on. Unfortunately there is no option that will enable automatic symbolic links resolving in the Bash shell. As symbolic links are convenient, sometimes, they might be misleading, for example, a symbolic link that leads from one filesystem to another. It’s also possible to make a symbolic link loop, that makes the current working directory unnecessarily long, it also trivial to make the “loop” of symbolic links. Look at the following self-contain example.</p>
<pre><code>[Alex@Normandy tmp]$ mkdir -p d1/d2/d3
[Alex@Normandy tmp]$ cd d1
[Alex@Normandy d1]$ ln -s d2/d3 l3
[Alex@Normandy d1]$ cd d2/d3
[Alex@Normandy d3]$ ln -s .. l2
[Alex@Normandy d3]$ cd ../.
[Alex@Normandy d1]$ cd l3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/
[Alex@Normandy l2]$ pwd
/home/Alex/Documents/BashBushido/tmp/d1/l3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2
[Alex@Normandy l2]$ pwd -P
/home/Alex/Documents/BashBushido/tmp/d1/d2</code></pre>
<p>In this example, there is a trivial loop “l2-&gt;d3-&gt;l2-&gt;d3…”. Going back to the <strong>d1</strong> directory requires “unwarping” the loop. To make Bash resolve the symbolic links, the <code>PROMPT_COMMAND</code> introduced in <a href="Executing%20the%20chosen%20commands%20before%20the%20prompt.">## Executing the chosen commands before the prompt</a> might be used.</p>
<pre><code>export PROMPT_COMMAND=&#39;[ &quot;$(pwd)&quot; == &quot;$(pwd -P)&quot; ] || cd &quot;$(pwd -P)&quot;&#39;.</code></pre>
<p>This short code checks if the output of <code>pwd</code> and “-p”hysical <code>pwd</code> is the same, and if not (‘||’ - Bash OR operator) changes the directory to the physical one. Note that the command is put in <code>'</code> so it won’t expand when exporting the PROMPT_COMMAND variable.</p>
<p>After exporting, cd into the same loop will result in:</p>
<pre><code>[Alex@Normandy d1]$ cd l3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/
[Alex@Normandy d2]$ pwd
/home/Alex/Documents/BashBushido/tmp/d1/d2</code></pre>
<p>There is also the second <strong>easier</strong> solution! You can alias the <code>cd</code> to <code>cd -P</code>. The <code>-P</code> option lets you “use the physical directory structure without following symbolic links”.</p>
<pre><code>[Alex@Normandy d2]$ export PROMPT_COMMAND=&#39;&#39;
[Alex@Normandy d1]$ cd -P l3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/
[Alex@Normandy d2]$ pwd
/home/Alex/Documents/BashBushido/tmp/d1/d2
[Alex@Normandy d2]$ cd ..
[Alex@Normandy d1]$ cd  l3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/
[Alex@Normandy l2]$ pwd
/home/Alex/Documents/BashBushido/tmp/d1/l3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2
[Alex@Normandy d1]$ alias cd=&#39;cd -P&#39;
[Alex@Normandy d1]$ cd l3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/d3/l2/
[Alex@Normandy d2]$ </code></pre>
<p>Unfortunately there is no such option for <code>pushd</code>.</p>
<h2 id="batch">batch</h2>
<p>Batch is a little program similar to the previously introduced <code>at</code>. Batch executes a command when the system load is below a specific value. This value is set at the compilation, and in the most system, it’s <strong>0.8</strong>. To change this value, you have to set the default value at which atd (AT Daemon) starts. In Enterprise Linux Distributions the <code>/etc/sysconfig/atd</code> is read by <code>atd</code> daemon. With proper options set in the <code>OPTS</code> variable, you can get the desired effect. For example <code>OPTS="-l 3.2"</code> that sets the load average for the <code>batch</code> to 3.2.</p>
<p>Batch is used in a similar way as at, of course the time is skipped.</p>
<pre><code>[root@Normandy ~]# uptime
 00:59:39 up 4 days, 10:03, 11 users,  load average: 0.80, 0.87, 0.82
[root@Normandy ~]# batch 
at&gt; date &gt;&gt; /etc/created_by_batch
at&gt; uptime &gt;&gt; /etc/created_by_batch
at&gt; &lt;EOT&gt;
job 9 at Fri Jun 21 00:59:00 2019
[root@Normandy ~]# atq
9  Fri Jun 21 00:59:00 2019 b root
[root@Normandy ~]# cat /etc/created_by_batch
cat: /etc/created_by_batch: No such file or directory</code></pre>
<p>After some time, when the load average drops below 0.8, the script was executed.</p>
<pre><code>[root@Normandy ~]# cat /etc/created_by_batch 
Fri Jun 21 01:02:01 CEST 2019
 01:02:01 up 4 days, 10:05, 11 users,  load average: 0.40, 0.81, 0.81</code></pre>
<p>Some user might discover that atd has 1 minute time graduality and executes jobs at the beginning of the new minute.</p>
<h2 id="why-some-linuxunix-programs-have-strange-names">Why some Linux/UNIX programs have strange names?</h2>
<p>I know that in this chapter you won’t find exciting new command or any useful trick :). But… - Have you ever asked yourself why some basic Linux command/programs like <code>passwd</code> or <code>umount</code> have strange names? <code>umount</code> is the best example because there is an actual word - unmount! What is the reason for these peculiar names, that sometimes save only a single character?</p>
<p>Well, it came from version 1 of UNIX. This UNIX was written in assembly and supported B (the predecessor of C) programming language. It also had a rather primitive filesystem that supports only 8-character file names, so it have to support <code>umount</code> as the command but also its sources - <code>umount.s</code> (‘.s’ and ‘.S’ are file extension for assembly language). Other lead is that the old linkers support identifiers up to 6 characters only.</p>
<h1 id="terminals-emulator">Terminals emulator</h1>
<p>For starter, a meme about how different roles in software development team see each other.</p>
<figure>
<img src="images/16-terminals/how_see_meme.jpg" alt="" /><figcaption>Team Members meme</figcaption>
</figure>
<p>I personally started using Linux terminal with cheesy green on black Matrix-like colors. To this day, every sensible terminal emulator supports this type of “Matrix” like color scheme/profile. I know few skilled Linux admins that use the standard console (terminal emulator), provided with their environment/window manager like gnome-terminal or Konsole. As I respect their skills, I also believe that choosing the right emulator is actually essential to boosting productivity. Sysadmin/Developer/DevOps spends quite a lot of time literally working in it. For the sake of this chapter, I made some basic features that a good terminal emulator must have:</p>
<ul>
<li>Support for colors.</li>
<li>Possibility to choose different color profiles.</li>
<li>Possibility to make/import user-defined color profiles.</li>
<li>Support for mouse events (scrolling + clicking)</li>
<li>Text resizing/wrapping depending on current terminal width/size.</li>
<li>Possibility to make multiple tabs.</li>
</ul>
<p>Other features that good terminal should have:</p>
<ul>
<li>Possibility to set a background image.</li>
<li>The support for True Color.</li>
<li>Save output to file (logging).</li>
<li>“Infinite scrolling” or at least ability to store one thousand lines.</li>
<li>Windows split to make multiple terminals - both horizontal and vertical splitting should be possible.</li>
</ul>
<p>Lastly there are features that I tried but found useless:</p>
<ul>
<li>Displaying Images/Video in a terminal.</li>
</ul>
<p>In this chapter, I will show some terminal emulators that I personally used during my journey with Linux. First chapters are about dropdown terminals that are a handful when doing some quick editing/checking. Then, I will present, in my opinion, the best terminal emulator <code>Terminator</code>. Finally, I will give some necessary information about the <code>screen</code> and show some useless but excellent for presentation terminal emulator named <code>Cool Retro Term</code>. Before going further, I would like to stress that I recommend choosing the tool that will seamlessly integrate with your workflow.</p>
<h2 id="short-history-of-dropdown-terminals">Short history of dropdown terminals</h2>
<p>In the life of any superuser, there is a time when you want to invoke a command <strong>now</strong> without an additional fuss like switching to another workspace/window. In other cases, you might wish for the nice placeholder for invoking/observing the time-consuming processes. In the very same time, it’s always nice to have a terminal that you can get/check right away. Of course, you might make new windows/tabs of your current terminal or even switch between “real” terminals (TTY). But it’s ineffective. So, if you want a swift and convenient solution, you might try the other way - the dropdown terminal.</p>
<p>The whole idea of a dropdown terminal came from the video games (btw. shouldn’t they be called computer games already?)! Yeah, that little thing that according to the president of the United States, Donald Trump causes violence and mass shooting. Thank God even from such unspeakable/horrible blasphemy like the video games an excellent idea can arise. The dropdown terminals started with a Quake cheat console.</p>
<figure>
<img src="images/16-terminals/quake_console.png" alt="" /><figcaption>Quake Dropdown Cheat Console</figcaption>
</figure>
<p>As it’s easy to predict, the people that make free software <del>steal</del> adapt the idea of drop-down terminals and then perfect it. In Bash Bushido, we will discuss the two most popular dropdown terminals - Guake and Yakuake. Note that both have names that end with <strong>ake</strong> to honor the <strong>Quake</strong> game.</p>
<h2 id="guake---gnome-drop-down-terminal">Guake - Gnome Drop Down Terminal</h2>
<p>The development of guake, as many other free/open-source software, takes place on the GitHub platform https://github.com/Guake/guake . As multiple python based project guake changed version numbering from 0.83.13 to 3.0; the reason for this is simple - the support for python 2.7 was dropped and having the separate numbers for a new version makes sense. Guake installation in at Enterprise Linux distributions is as simple as installing the epel-release package then installing the Guake from the EPEL repository.</p>
<pre><code>sudo yum install -y epel-release
sudo yum install -y guake</code></pre>
<p>After installation, I recommend invoking <code>guake</code> that will ask about biding itself to the <code>F12</code> key. I highly recommend this because only a small percentage of applications actually uses <code>F12</code> and in most cases (like a web browser and developer tools), they are also bound to other keys combination (like <code>ctrl</code>+<code>shift</code>+<code>i</code> in Firefox). After configuration <code>guake</code> might be showed/hidden with <code>F12</code> or any other chosen key.</p>
<p>This paragraph is gnome 3 specific - to add guake to autostart in gnome you might use <code>gnome-tweak-tools</code> or <code>gnome-session-properties</code>. The <code>gnome-tweak-tools</code> uses <code>desktop</code> files from <code>/usr/share/applications</code> when <code>gnome-session-properties</code> allows to run any command.</p>
<p>Guake supports:</p>
<ul>
<li>Colors</li>
<li>Possibility to choose different color profiles.</li>
<li>Option to make/import user-defined color profiles.</li>
<li>Support for mouse events (scrolling + clicking)</li>
<li>Text resizing and wrapping depending on current terminal width/size.</li>
<li>Possibility to make multiple tabs.</li>
<li>Possibility to set a background image.</li>
<li>Support for True Color.</li>
<li>Ability to store more than one thousand of the output lines.</li>
</ul>
<p>Like any other sensible terminal emulator, Guake allows making a new tab with <code>ctrl</code>+<code>shift</code>+<code>t</code>. Terminal tabs switching are bound to <code>ctrl</code>+ <code>Page Up</code>/<code>Page Down</code>.</p>
<p>Below, resized (so it won’t crash the e-book readers) screenshot from my glorious 21:9 monitor. <img src="images/16-terminals/guake_21_9.png" alt="Guake" /></p>
<h2 id="yakuake---kde-dropdown-terminal">Yakuake - KDE Dropdown Terminal</h2>
<p>The main competitor of the Guake project is Yakuake, it’s part of never ending competition between Gnome and KDE. This competition makes me and any other Linux user happy because having a choice itself is great. Yakuake development is managed by KDE foundation on their Git. I must say that I like the fact that it is GitHub/GitLab independent, but I have no idea how contributing/issue reporting is managed.</p>
<p>Like Guake Yakuake is also available in the EPEL repository. Installation is as straightforward as:</p>
<pre><code>sudo yum install -y epel-release 
sudo yum install -y yakuake</code></pre>
<p>Like <code>guake</code>, <code>yakuake</code> also asks about setting the F12 as on/off key during first start. When it comes to the features Yakuake supports the following:</p>
<ul>
<li>Colors</li>
<li>Color profiles.</li>
<li>Create/import user-defined color profiles.</li>
<li>Support for mouse events (scrolling + clicking)</li>
<li>Text resizing and wrapping depending on the current terminal width/size.</li>
<li>Possibility to make multiple tabs.</li>
<li>Possibility to set a background image.</li>
<li>Support for True Color.</li>
<li>Ability to store the “infinite” number of output lines.</li>
<li>Vertical and horizontal splitting allows multiple terminals in one window.</li>
</ul>
<p>Older Yakuake version screenshot: <img src="images/16-terminals/yakuake.png" alt="Yakuake" /></p>
<p>The thing that I dislike about Yakuake are default key bindings. For example the full screen is <code>ctrl</code> + <code>shift</code> + <code>F11</code> instead of <code>F11</code>. The new tab is <code>ctrl</code>+<code>shift</code>+<code>t</code> but to change the tab you have to use <code>shift</code> + arrow instead of <code>Page Up\Page Down</code>. It’s tweakable and works well with other KDE apps, but it’s not to my taste. Generally speaking, the Yakuake is more powerful than Guake, but it also requires more effort to learn and develop different habits.</p>
<h2 id="terminator-make-terminal-grid-again">TERMINATOR make terminal grid again!</h2>
<p>The Terminator authors describe it as - “Multiple GNOME terminals in one window”. Terminators allow you to arrange terminals in grids or as not technical colleges says in “Matrix”. In contrast to <code>tmux</code> and <code>screen</code>, to leverage most of the Terminator features you don’t have to learn a lot of shortcuts or how to make a complicated configuration file. In other words, the Terminator is user-friendly, it’s a typical zero entry program that shines without any configuration. Most of the operations can be achieved with mouse, especially without learning <strong>any</strong> shortcut.</p>
<p>To install Terminator on Enterprise Linux Distributions invoke:</p>
<pre><code>sudo yum install -y epel-release 
sudo yum install -y terminator.</code></pre>
<p>I also made my build of the newer version that is available on OBS (Open Build Service) supported and maintained by one of my favourite company SUSE, https://build.opensuse.org/repositories/home:alex_baranowski/terminator-1.9-epel7).</p>
<p>After installing the Terminator, you can right-click and select horizontal or vertical split, that will split the current terminal window into two. Another important capability of Terminator is support for drag and drop, so you can easily arrange your terminal “matrix” with few clicks and impress less-skilled Linux users.</p>
<pre><code>Friend A: Have you ever heard the story about Alex the Wise that impress oposite/same sex/gender with his Terminator setup? 
Friend B: No.
Friend A: End.</code></pre>
<p>This is actual joke that my friend told me.</p>
<h3 id="most-important-terminator-shortcuts">Most important terminator shortcuts:</h3>
<ul>
<li><code>ctrl</code> + <code>shift</code> + <code>o</code> - open new terminal horizontally.</li>
<li><code>ctrl</code> + <code>shift</code> + <code>e</code> - open new terminal vertically.</li>
</ul>
<p>There is very simple mnemotechnique for it.</p>
<ul>
<li><code>ctrl</code> + <code>shift</code> + h<code>O</code>rizontally.</li>
<li><code>ctrl</code> + <code>shift</code> + v<code>E</code>rtically.</li>
</ul>
<p>Now when you have multiple terminals, you probably would like to navigate seamlessly (without using mouse):</p>
<ul>
<li><code>alt</code> + ↑ - Move to upper terminal.</li>
<li><code>alt</code> + ↓ - Move to lower terminal.</li>
<li><code>alt</code> + ← - Move to terminal on the left.</li>
<li><code>alt</code> + → - Move to terminal on the right.</li>
</ul>
<p>What you really have to remember is <code>alt</code> + <code>direction arrow</code>. It’s trivial and intuitive.</p>
<p>Another handy feature is the ability to maximize single terminal - I personally named it <strong>focus mode</strong>:</p>
<ul>
<li><code>ctrl</code> + <code>shift</code> + <code>x</code> - maximize the terminal you are currently working on. To undo this operation (“restore all terminals”) use same shortcut.</li>
</ul>
<h3 id="fan-with-tabs">Fan with tabs</h3>
<p>Terminator allows creating multiple tabs. Each tab can have multiple terminals:</p>
<ul>
<li><code>ctrl</code> + <code>t</code> - add new tab. Tab vanish when all terminals within are closed.</li>
<li><code>ctrl</code> + <code>Page UP</code> - move to the previous tab.</li>
<li><code>ctrl</code> + <code>Page DOWN</code> - move to the next tab.</li>
</ul>
<h3 id="broadcasting">Broadcasting</h3>
<p>Broadcasting multiply your input to other terminals, it’s handy when setting up with multiple systems.</p>
<ul>
<li><code>alt</code> + <code>a</code> - turn broadcast on to all terminals.</li>
<li><code>alt</code> + <code>o</code> - turn broadcast off.</li>
</ul>
<p>The terminal can also be assigned to custom named group. Each terminal might have only one group assigned, but group can have multiple terminals. To create a group, you click on the little icon in the left corner of the terminal. Then create a group or assign terminal to the existing group. Groups also support broadcasting, to broadcast to the group use:</p>
<ul>
<li><code>alt</code> + <code>g</code> - turn broadcast on to a group.</li>
<li><code>alt</code> + <code>o</code> - turn broadcast off.</li>
</ul>
<h3 id="resizing-and-creating-new-windows">Resizing and creating new windows</h3>
<p>To perfect your setup, you might resize the terminal, both mouse (drag the terminal “title” bar) and keyboard might be used to change the terminal size:</p>
<ul>
<li><code>ctrl</code> + <code>shift</code> + <code>arrow</code> - resize the current terminal by one character in the arrow direction. You can hold the combination until you get the intended size.</li>
</ul>
<p>To create a new window use:</p>
<ul>
<li><code>ctrl</code> + <code>shift</code> + <code>i</code></li>
</ul>
<h2 id="terminal-detaching-with-screen">Terminal detaching with screen</h2>
<p>I don’t use screen and tmux because the configuration of each of them is cumbersome. The only thing that I found unique in them is the ability to run on a server without X11 (or Wayland :)), and detach. To deatch your screen sesion use <code>ctrl</code> + <code>a</code> then <code>ctrl</code> + <code>d</code>.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb330-1"><a href="#cb330-1"></a><span class="fu">sudo</span> yum install -y screen</span>
<span id="cb330-2"><a href="#cb330-2"></a><span class="ex">screen</span></span>
<span id="cb330-3"><a href="#cb330-3"></a><span class="co"># Do you work - ex. setup IRC communicator</span></span>
<span id="cb330-4"><a href="#cb330-4"></a><span class="co"># Detach with `ctrl` + `a` then `ctrl` + `d`</span></span>
<span id="cb330-5"><a href="#cb330-5"></a><span class="ex">screen</span> -r <span class="co"># will resume your previous screen</span></span></code></pre></div>
<p>Mnemonics:</p>
<ul>
<li><code>ctlr</code> + <code>a</code>ctivate (extra options) then <code>ctrl</code> + <code>d</code>etach</li>
<li>screen -<code>r</code>eattach</li>
</ul>
<h2 id="cool-retro-term.">Cool-retro-term.</h2>
<p>There is a group of projects that I sometimes call “uncle projects” or “uncle software”. I really like being an uncle, especially at familly gatherings, when you can babysit the baby for a short time, but when you get tired of it, you just give him/her back to the parents. The “uncle software” is the same, it’s nice to play with it for a bit, but after a little while, you can just forget about it. Of course, these words and terms were forged by a single that will die alone.</p>
<p>You can install the <code>cool-retro-term</code> from nux repos (https://li.nux.ro/). Or compile it from the source. When compiling it from the source on an Enterprise Linux system, you should change qmltermwidget version. The following script worked for me:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb331-1"><a href="#cb331-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb331-2"><a href="#cb331-2"></a><span class="va">CRT_URL=</span>https://github.com/Swordfish90/cool-retro-term/archive/1.0.1.tar.gz</span>
<span id="cb331-3"><a href="#cb331-3"></a><span class="va">WIDGET_URL=</span>https://github.com/Swordfish90/qmltermwidget/archive/v0.1.0.tar.gz</span>
<span id="cb331-4"><a href="#cb331-4"></a></span>
<span id="cb331-5"><a href="#cb331-5"></a><span class="fu">sudo</span> yum -y install qt5-qtbase qt5-qtbase-devel qt5-qtdeclarative qt5-qtdeclarative-devel qt5-qtgraphicaleffects qt5-qtquickcontrols redhat-rpm-config</span>
<span id="cb331-6"><a href="#cb331-6"></a></span>
<span id="cb331-7"><a href="#cb331-7"></a><span class="fu">wget</span> <span class="st">&quot;</span><span class="va">$CRT_URL</span><span class="st">&quot;</span> -O cool-retro-term.tar.gz</span>
<span id="cb331-8"><a href="#cb331-8"></a><span class="fu">mkdir</span> cool-retro-term <span class="kw">&amp;&amp;</span> <span class="fu">tar</span> xvf cool-retro-term.tar.gz -C cool-retro-term --strip-components 1</span>
<span id="cb331-9"><a href="#cb331-9"></a><span class="bu">cd</span> cool-retro-term</span>
<span id="cb331-10"><a href="#cb331-10"></a><span class="fu">rm</span> -rf qmltermwidget</span>
<span id="cb331-11"><a href="#cb331-11"></a><span class="fu">wget</span> <span class="st">&quot;</span><span class="va">$WIDGET_URL</span><span class="st">&quot;</span> -O qmltermwidget.tar.gz</span>
<span id="cb331-12"><a href="#cb331-12"></a><span class="fu">mkdir</span> qmltermwidget <span class="kw">&amp;&amp;</span> <span class="fu">tar</span> xvf qmltermwidget.tar.gz -C qmltermwidget --strip-components 1</span>
<span id="cb331-13"><a href="#cb331-13"></a><span class="ex">qmake-qt5</span></span>
<span id="cb331-14"><a href="#cb331-14"></a><span class="fu">make</span></span>
<span id="cb331-15"><a href="#cb331-15"></a><span class="fu">sudo</span> make install STRIP=true</span></code></pre></div>
<p>But simpler method to use Cool Retor Term is AppImage. AppImage is a format that in theory should pack program and all necessary libraries in one file.</p>
<pre><code>wget https://github.com/Swordfish90/cool-retro-term/releases/download/1.1.1/Cool-Retro-Term-1.1.1-x86_64.AppImage
chmod 755 Cool-Retro-Term-1.1.1-x86_64.AppImage
./Cool-Retro-Term-1.1.1-x86_64.AppImage</code></pre>
<p>After starting the program you can make your own profiles or play with one of the presets. I recommend trying each of them, then decide which one you like the most. As I said before, I find this cool-retro-term fun, great for presentation, and even a little exciting but not suited for everyday work.</p>
<figure>
<img src="images/16-terminals/cool_retro_term.png" alt="" /><figcaption>Cool Retro Term - IBM DOS profile</figcaption>
</figure>
<figure>
<img src="images/16-terminals/cool_retro_term_2.png" alt="" /><figcaption>Cool Retro Term - IBM 3278 profile</figcaption>
</figure>
<h1 id="this-is-the-end">This is the end</h1>
<p>Dear Reader - I would like to simply say <strong>thank you</strong> for reading (and maybe even buying) this book. I put quite a lot into this publication and knowing that someone actually read it, makes me smile. I hope that you enjoyed it at least half as much as I did. If you liked this book, you could pass it to your friend, college or co-worker.</p>
<p>I’m quite sure that there will be a “free” version somewhere on the Internet (maybe even one that I personally published) if you read one of these “free” versions and liked it, you might consider buying it. If this book is too expensive for you to buy, please don’t feel bad about pirating it. I’m really okay with it.</p>
<p>I wish you the best on your SysAdmin, DevOps, NetOps, OpsOps, UPSWhatHappendOps, HelpMeIMStuckInThisJobOPs - Bushidō.</p>
<p>Sincerely yours,</p>
<p>Alex Baranowski</p>
<h2 id="errata">Errata</h2>
<p>Errata public repository can be found here https://github.com/AlexBaranowski/bash-bushido-errata</p>
</body>
</html>
